{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DanielGarc\\xEDaCarabelo\\\\Downloads\\\\pag web boda 2.0\\\\html\\\\webreact\\\\src\\\\components\\\\Game.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\n\n// Juego moderno: pareja camino a la iglesia, con narrativa cada 30s\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Game() {\n  _s();\n  const containerRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  // Estado principal\n  const [status, setStatus] = useState('menu'); // menu | intro | playing | paused | win | gameover\n  const [muted, setMuted] = useState(false);\n\n  // Configuración de juego\n  const GAME_DURATION = 300; // 5 min\n  const SCORE = useRef(0);\n  const TIMELEFT = useRef(GAME_DURATION);\n  const INTRO_SHOWN = useRef(false);\n\n  // Intro estilo Star Wars\n  const INTRO = useRef({\n    offset: 320,\n    speed: 40,\n    // más lento para una intro más larga\n    lines: ['En una galaxia muy, muy cercana...', 'Dos estrellas destinadas a unirse brillan con fuerza.', 'El gran día ha llegado y todos esperan en la iglesia.', 'Ayuda a la pareja a llegar a tiempo sorteando obstáculos...', 'Controles: ↑ o ESPACIO para saltar, ↓ para agacharte o caer rápido.', 'Pulsa P para pausar. R para reiniciar.', '¡Que la fuerza del amor te acompañe!']\n  });\n\n  // Momentos clave (cada 30s)\n  const STORY_MOMENTS = useRef([{\n    text: 'Ana y Dani en la Facultad de Derecho de la USC 🏛️',\n    timeStart: 0\n  }, {\n    text: 'Ana preparando las oposiciones para Jueza ⚖️',\n    timeStart: 30\n  }, {\n    text: 'Dani cursando el Máster de Abogacía 📖',\n    timeStart: 60\n  }, {\n    text: 'Dani empezando a trabajar como abogado 💼',\n    timeStart: 90\n  }, {\n    text: 'Dani trabajando en Porriño 🏢',\n    timeStart: 120\n  }, {\n    text: 'Dani mudándose a Carballiño 🏠',\n    timeStart: 150\n  }, {\n    text: 'Ana trabajando en Ponteareas 🏛️',\n    timeStart: 180\n  }, {\n    text: 'Ana aprobando la oposición en Pontevedra 🎉',\n    timeStart: 210\n  }, {\n    text: 'Ana y Dani viviendo juntos en Pontevedra 💕',\n    timeStart: 240\n  }, {\n    text: 'La pedida en la Torre de Hércules 💍',\n    timeStart: 270\n  }, {\n    text: '¡Y hoy... la boda! 👰💒🤵',\n    timeStart: 300\n  }]);\n\n  // Narrativa actual con banner animado\n  const STORY = useRef({\n    index: -1,\n    bannerText: '',\n    bannerAlpha: 0,\n    bannerTimer: 0\n  });\n  const [currentStoryMoment, setCurrentStoryMoment] = useState(null);\n  // Buffers para optimizar render de textos/gradientes\n  const BUFFERS = useRef({\n    width: 0,\n    height: 0,\n    text: '',\n    watermark: null,\n    banner: null\n  });\n\n  // Reconstruir buffers de watermark y banner cuando cambie el texto o el tamaño\n  const rebuildStoryBuffers = text => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const width = canvas.width,\n      height = canvas.height;\n    const sameSize = BUFFERS.current.width === width && BUFFERS.current.height === height;\n    const sameText = BUFFERS.current.text === text;\n    if (sameSize && sameText && BUFFERS.current.watermark && BUFFERS.current.banner) return;\n    BUFFERS.current.width = width;\n    BUFFERS.current.height = height;\n    BUFFERS.current.text = text;\n\n    // Watermark prerender\n    const wm = document.createElement('canvas');\n    wm.width = width;\n    wm.height = height;\n    const wctx = wm.getContext('2d');\n    wctx.globalAlpha = 0.12;\n    const gradient = wctx.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, width * 0.9);\n    gradient.addColorStop(0, '#fbbf24');\n    gradient.addColorStop(0.5, '#f59e0b');\n    gradient.addColorStop(1, 'transparent');\n    wctx.fillStyle = gradient;\n    wctx.fillRect(0, 0, width, height);\n    wctx.globalAlpha = 0.22;\n    wctx.fillStyle = '#92400e';\n    wctx.font = 'bold 34px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n    wctx.textAlign = 'center';\n    wctx.textBaseline = 'middle';\n    const lines = wrapText(wctx, text, width * 0.7);\n    const lh = 40;\n    const sy = height / 2 - (lines.length - 1) * lh / 2;\n    for (let i = 0; i < lines.length; i++) wctx.fillText(lines[i], width / 2, sy + i * lh);\n    BUFFERS.current.watermark = wm;\n\n    // Banner prerender\n    const pad = 12;\n    // usar el mismo contexto para medir con la misma fuente\n    wctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n    const fullText = '💕 ' + text + ' 💕';\n    const textW = wctx.measureText(fullText).width;\n    const boxW = Math.min(width - 24, textW + pad * 2 + 40);\n    const boxH = 42;\n    const bn = document.createElement('canvas');\n    bn.width = Math.ceil(boxW);\n    bn.height = boxH;\n    const bctx = bn.getContext('2d');\n    bctx.fillStyle = 'rgba(251, 191, 36, 0.95)';\n    roundRect(bctx, 0, 0, boxW, boxH, 10);\n    bctx.fill();\n    bctx.strokeStyle = '#d97706';\n    bctx.lineWidth = 2;\n    bctx.stroke();\n    bctx.fillStyle = '#92400e';\n    bctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n    bctx.textAlign = 'center';\n    bctx.textBaseline = 'middle';\n    bctx.fillText(fullText, boxW / 2, boxH / 2);\n    BUFFERS.current.banner = bn;\n  };\n\n  // Mundo y física\n  const WORLD = useRef({\n    speed: 240,\n    maxSpeed: 420,\n    gravity: 1700,\n    jumpV: 620,\n    fastFallBoost: 2200,\n    groundY: 220,\n    player: {\n      x: 100,\n      y: 0,\n      w: 70,\n      h: 48,\n      vy: 0,\n      onGround: true,\n      crouching: false\n    },\n    worldX: 0,\n    obstacles: [],\n    startTs: 0,\n    lastTs: 0,\n    spawnTimer: 0,\n    spawnInterval: 1.3,\n    // Parallax\n    parallax: {\n      skyShift: 0,\n      cityShift: 0,\n      hillShift: 0\n    }\n  });\n\n  // Reset limpio\n  const resetWorld = () => {\n    SCORE.current = 0;\n    TIMELEFT.current = GAME_DURATION;\n    STORY.current = {\n      index: -1,\n      bannerText: '',\n      bannerAlpha: 0,\n      bannerTimer: 0\n    };\n    setCurrentStoryMoment(null);\n    const w = WORLD.current;\n    w.worldX = 0;\n    w.lastTs = 0;\n    w.startTs = 0;\n    w.speed = 240;\n    w.spawnInterval = 1.3;\n    w.spawnTimer = 0.8;\n    w.obstacles = [];\n    w.parallax.skyShift = 0;\n    w.parallax.cityShift = 0;\n    w.parallax.hillShift = 0;\n    w.player = {\n      x: 100,\n      y: w.groundY - 48,\n      w: 70,\n      h: 48,\n      vy: 0,\n      onGround: true,\n      crouching: false\n    };\n  };\n  useEffect(() => {\n    resetWorld();\n    INTRO.current.offset = 320;\n  }, []);\n\n  // Bucle de juego\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    let rafId;\n    const loop = ts => {\n      const w = WORLD.current;\n      if (!w.lastTs) {\n        w.lastTs = ts;\n        if (!w.startTs && status === 'playing') w.startTs = ts;\n      }\n      const dt = Math.min(0.032, (ts - w.lastTs) / 1000);\n      w.lastTs = ts;\n      update(dt, ts);\n      render(ctx, canvas);\n      rafId = requestAnimationFrame(loop);\n    };\n    rafId = requestAnimationFrame(loop);\n    return () => cancelAnimationFrame(rafId);\n  }, [status]);\n\n  // Reiniciar intro al entrar\n  useEffect(() => {\n    if (status === 'intro') INTRO.current.offset = 320;\n  }, [status]);\n\n  // Entradas\n  useEffect(() => {\n    const onKeyDown = e => {\n      if (e.repeat) return;\n      if ((e.code === 'Space' || e.code === 'ArrowUp') && status === 'playing') jump();\n      if (e.code === 'ArrowDown' && status === 'playing') crouch(true);\n      if (e.code === 'KeyR' && (status === 'playing' || status === 'gameover' || status === 'win' || status === 'paused')) {\n        resetWorld();\n        setStatus('menu');\n      }\n      if (e.code === 'KeyP' && (status === 'playing' || status === 'paused')) togglePause();\n      if (e.code === 'Enter' && status === 'menu') handlePlayFullscreen();\n      if (e.code === 'Enter' && status === 'intro') startPlaying();\n    };\n    const onKeyUp = e => {\n      if (e.code === 'ArrowDown') crouch(false);\n    };\n    window.addEventListener('keydown', onKeyDown);\n    window.addEventListener('keyup', onKeyUp);\n    return () => {\n      window.removeEventListener('keydown', onKeyDown);\n      window.removeEventListener('keyup', onKeyUp);\n    };\n  }, [status]);\n  const togglePause = () => {\n    if (status === 'playing') setStatus('paused');else if (status === 'paused') setStatus('playing');\n  };\n  const jump = () => {\n    const p = WORLD.current.player;\n    if (p.onGround) {\n      p.vy = -WORLD.current.jumpV;\n      p.onGround = false;\n    }\n  };\n  const crouch = on => {\n    const p = WORLD.current.player;\n    if (on) {\n      if (!p.onGround) p.vy += WORLD.current.fastFallBoost * 0.04; // caída rápida\n      else if (!p.crouching) {\n        p.crouching = true;\n        const prevBottom = p.y + p.h;\n        p.h = 32; // reducir un poco la altura\n        p.y = prevBottom - p.h;\n      }\n    } else if (p.crouching) {\n      const prevBottom = p.y + p.h;\n      p.h = 48;\n      p.y = prevBottom - p.h;\n      p.crouching = false;\n    }\n  };\n  const handlePlayFullscreen = async () => {\n    try {\n      var _containerRef$current;\n      if ((_containerRef$current = containerRef.current) !== null && _containerRef$current !== void 0 && _containerRef$current.requestFullscreen) await containerRef.current.requestFullscreen();\n    } catch {}\n    resetWorld();\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) {\n      audioEl.currentTime = 0;\n      audioEl.play();\n      audioEl.muted = muted;\n    }\n    if (!INTRO_SHOWN.current) {\n      setStatus('intro');\n      INTRO_SHOWN.current = true;\n    } else {\n      startPlaying();\n    }\n  };\n  const startPlaying = () => {\n    const w = WORLD.current;\n    w.lastTs = 0;\n    w.startTs = 0;\n    // Mostrar primer momento inmediatamente\n    STORY.current.index = 0;\n    STORY.current.bannerText = STORY_MOMENTS.current[0].text;\n    STORY.current.bannerTimer = 4.2; // mostrar 4.2s\n    STORY.current.bannerAlpha = 0; // animar fade-in\n    setCurrentStoryMoment(STORY.current.bannerText);\n    // construir buffers para rendimiento\n    rebuildStoryBuffers(STORY.current.bannerText);\n    setStatus('playing');\n  };\n  const handleRetry = () => {\n    resetWorld();\n    setCurrentStoryMoment(null);\n    startPlaying();\n  };\n  const update = (dt, ts) => {\n    const w = WORLD.current;\n    if (status === 'menu') return;\n    if (status === 'intro') {\n      INTRO.current.offset -= INTRO.current.speed * dt;\n      if (INTRO.current.offset < -140) startPlaying();\n      return;\n    }\n    if (status === 'paused') return;\n    if (status !== 'playing') return;\n\n    // Tiempo de juego\n    if (w.startTs === 0) w.startTs = ts;\n    const elapsed = (ts - w.startTs) / 1000;\n    const remaining = Math.max(0, GAME_DURATION - elapsed);\n    TIMELEFT.current = remaining;\n\n    // Narrativa basada en tiempo -> índice\n    const maxIndex = STORY_MOMENTS.current.length - 1;\n    const idx = Math.min(Math.floor(elapsed / 30), maxIndex);\n    if (idx !== STORY.current.index) {\n      STORY.current.index = idx;\n      STORY.current.bannerText = STORY_MOMENTS.current[idx].text;\n      STORY.current.bannerTimer = 4.2;\n      setCurrentStoryMoment(STORY.current.bannerText);\n      // reconstruir buffers en cada cambio de momento\n      rebuildStoryBuffers(STORY.current.bannerText);\n    }\n\n    // Animación del banner (fade in/out)\n    if (STORY.current.bannerTimer > 0) {\n      STORY.current.bannerTimer -= dt;\n      STORY.current.bannerAlpha = Math.min(1, STORY.current.bannerAlpha + dt * 3);\n    } else {\n      STORY.current.bannerAlpha = Math.max(0, STORY.current.bannerAlpha - dt * 2);\n    }\n    if (remaining <= 0.01) {\n      setStatus('win');\n      return;\n    }\n\n    // Progresión de dificultad\n    const tFactor = Math.min(1, elapsed / GAME_DURATION);\n    w.speed = 240 + (w.maxSpeed - 240) * tFactor;\n    w.spawnInterval = 1.3 - 0.8 * tFactor;\n\n    // Parallax scrolling\n    w.parallax.skyShift += w.speed * 0.08 * dt;\n    w.parallax.cityShift += w.speed * 0.25 * dt;\n    w.parallax.hillShift += w.speed * 0.45 * dt;\n\n    // Avance mundo\n    w.worldX += w.speed * dt;\n\n    // Física jugador\n    const p = w.player;\n    p.vy += w.gravity * dt;\n    p.y += p.vy * dt;\n    const groundY = w.groundY - p.h;\n    if (p.y >= groundY) {\n      p.y = groundY;\n      p.vy = 0;\n      p.onGround = true;\n    } else {\n      p.onGround = false;\n    }\n\n    // Spawn obstáculos\n    w.spawnTimer -= dt;\n    if (w.spawnTimer <= 0) {\n      spawnObstacle(w);\n      w.spawnTimer = w.spawnInterval * (0.9 + Math.random() * 0.4);\n    }\n\n    // Colisiones + puntuación\n    for (const o of w.obstacles) {\n      const sx = o.x - w.worldX + p.x;\n      o.screenX = sx;\n      if (!o.scored && sx + o.w < p.x) {\n        o.scored = true;\n        SCORE.current += 100;\n      }\n      const collide = rectOverlap(p.x, p.y, p.w, p.h, sx, o.y, o.w, o.h);\n      if (collide) {\n        setStatus('gameover');\n        break;\n      }\n    }\n\n    // Limpiar\n    w.obstacles = w.obstacles.filter(o => o.screenX > -140);\n    SCORE.current += Math.floor(w.speed * dt * 0.6);\n  };\n  const render = (ctx, canvas) => {\n    const w = WORLD.current;\n    const p = w.player;\n\n    // Fondo\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    if (status === 'intro') {\n      drawIntroBackground(ctx, canvas);\n      drawIntro(ctx, canvas, INTRO.current.lines, INTRO.current.offset);\n      drawSkipHint(ctx, canvas, 'Pulsa Enter para saltar');\n      return;\n    }\n    drawSky(ctx, canvas, w.parallax.skyShift);\n    drawCity(ctx, canvas, w.parallax.cityShift);\n    drawHills(ctx, canvas, w.parallax.hillShift);\n\n    // Marca de agua narrativa sutil\n    const momentText = currentStoryMoment || STORY_MOMENTS.current[0].text;\n    // Dibujar watermark desde buffer si existe\n    if (BUFFERS.current.watermark) {\n      ctx.drawImage(BUFFERS.current.watermark, 0, 0);\n    } else {\n      // Fallback (primera vez muy puntual)\n      drawStoryWatermark(ctx, canvas, momentText);\n    }\n\n    // Suelo\n    ctx.fillStyle = '#bfe3ff';\n    ctx.fillRect(0, w.groundY + 12, canvas.width, 4);\n\n    // Obstáculos\n    for (const o of w.obstacles) {\n      if (o.screenX < -80 || o.screenX > canvas.width + 120) continue;\n      if (o.type === 'low') drawObstacleLow(ctx, o.screenX, o.y, o.w, o.h);else drawObstacleHigh(ctx, o.screenX, o.y, o.w, o.h);\n    }\n\n    // Pareja (sticker conjunto)\n    drawCouple(ctx, p.x, p.y, p.w, p.h, !p.onGround, p.crouching);\n\n    // HUD\n    drawHUD(ctx, canvas, {\n      score: SCORE.current,\n      time: TIMELEFT.current,\n      status\n    });\n\n    // Banner de momento especial (animado)\n    if (STORY.current.bannerAlpha > 0) {\n      if (BUFFERS.current.banner) {\n        ctx.save();\n        ctx.globalAlpha = STORY.current.bannerAlpha;\n        const bx = (canvas.width - BUFFERS.current.banner.width) / 2;\n        const by = 6;\n        ctx.drawImage(BUFFERS.current.banner, bx, by);\n        ctx.restore();\n      } else {\n        drawStoryBanner(ctx, canvas, momentText, STORY.current.bannerAlpha);\n      }\n    }\n    if (status === 'paused') {\n      drawOverlay(ctx, canvas, 'Pausa ⏸', 'Pulsa P para continuar');\n      return;\n    }\n    if (status === 'gameover') {\n      drawOverlay(ctx, canvas, '¡Ups! Te has tropezado', 'Pulsa R para volver al menú');\n    } else if (status === 'win') {\n      drawOverlay(ctx, canvas, '¡Llegaste a tiempo! 💒', `Puntuación: ${Math.floor(SCORE.current)} · Pulsa R para menú`);\n    }\n  };\n  const toggleMute = () => {\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) {\n      audioEl.muted = !audioEl.muted;\n      setMuted(audioEl.muted);\n    } else setMuted(m => !m);\n  };\n  useEffect(() => () => {\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) audioEl.pause();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    style: {\n      maxWidth: 980,\n      margin: '0 auto',\n      padding: '1rem',\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        textAlign: 'center',\n        marginBottom: '.5rem'\n      },\n      children: \"Camino a la iglesia\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 438,\n      columnNumber: 7\n    }, this), status === 'menu' && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        inset: 0,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        background: 'linear-gradient(135deg, rgba(255,255,255,.95), rgba(238,242,255,.95))',\n        zIndex: 5,\n        borderRadius: 12\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: 'min(92%, 620px)',\n          padding: '1.25rem',\n          borderRadius: 12,\n          boxShadow: '0 8px 28px rgba(0,0,0,.18)',\n          background: 'white'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            marginTop: 0,\n            textAlign: 'center'\n          },\n          children: \"\\xA1Acompa\\xF1a a Ana y Dani!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            textAlign: 'center',\n            color: '#64748b',\n            marginTop: 4\n          },\n          children: \"Esquiva obst\\xE1culos durante 5 minutos. La historia de la pareja aparecer\\xE1 como momentos especiales cada 30s.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 444,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '1rem',\n            justifyContent: 'center',\n            marginTop: '1rem'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handlePlayFullscreen,\n            style: primaryBtn,\n            children: \"\\u25B6 Jugar en pantalla completa\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              resetWorld();\n              startPlaying();\n            },\n            style: secondaryBtn,\n            children: \"\\u25B7 Jugar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 449,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 442,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 441,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        borderRadius: 12,\n        overflow: 'hidden',\n        boxShadow: '0 6px 24px rgba(0,0,0,.12)',\n        background: 'white',\n        position: 'relative'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n        id: \"bg-music\",\n        src: \"/musica-boda.mp3\",\n        loop: true,\n        autoPlay: false,\n        style: {\n          display: 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 456,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMute,\n        \"aria-label\": muted ? 'Activar sonido' : 'Silenciar sonido',\n        style: {\n          position: 'absolute',\n          right: 8,\n          top: 8,\n          zIndex: 8,\n          background: 'rgba(0,0,0,.55)',\n          color: '#fff',\n          border: 0,\n          borderRadius: 999,\n          width: 36,\n          height: 36,\n          cursor: 'pointer'\n        },\n        children: muted ? '🔇' : '🔊'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 457,\n        columnNumber: 9\n      }, this), (status === 'playing' || status === 'paused') && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: togglePause,\n        style: {\n          position: 'absolute',\n          right: 52,\n          top: 8,\n          zIndex: 8,\n          background: 'rgba(0,0,0,.55)',\n          color: '#fff',\n          border: 0,\n          borderRadius: 999,\n          width: 36,\n          height: 36,\n          cursor: 'pointer'\n        },\n        children: status === 'paused' ? '▶' : '⏸'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 459,\n        columnNumber: 11\n      }, this), status === 'intro' && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: startPlaying,\n        style: {\n          position: 'absolute',\n          right: 8,\n          bottom: 8,\n          zIndex: 8,\n          background: 'rgba(0,0,0,.55)',\n          color: '#fff',\n          border: 0,\n          borderRadius: 8,\n          padding: '.4rem .6rem',\n          cursor: 'pointer'\n        },\n        children: \"Saltar intro\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 900,\n        height: 280,\n        style: {\n          width: '100%',\n          display: 'block',\n          background: status === 'intro' ? '#000' : 'linear-gradient(#eef2ff, #fff)'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 9\n      }, this), status === 'playing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          inset: 'auto 0 0 0',\n          display: 'flex',\n          justifyContent: 'space-between',\n          padding: '8px 10px',\n          pointerEvents: 'none'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onMouseDown: jump,\n          onTouchStart: jump,\n          style: touchBtn,\n          children: \"\\u2B9D Saltar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 469,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onMouseDown: () => crouch(true),\n          onMouseUp: () => crouch(false),\n          onTouchStart: () => crouch(true),\n          onTouchEnd: () => crouch(false),\n          style: touchBtn,\n          children: \"\\u2B9F Agachar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 470,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 11\n      }, this), (status === 'gameover' || status === 'win') && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          inset: 0,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 7\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'rgba(17,24,39,.88)',\n            color: '#fff',\n            padding: '1rem 1.25rem',\n            borderRadius: 12,\n            boxShadow: '0 8px 28px rgba(0,0,0,.35)',\n            textAlign: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 700,\n              fontSize: 18,\n              marginBottom: 8\n            },\n            children: status === 'win' ? '¡Llegaste a tiempo! 💒' : '¡Ups! Te has tropezado'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 477,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 14,\n              opacity: .9,\n              marginBottom: 12\n            },\n            children: [\"Puntuaci\\xF3n: \", Math.floor(SCORE.current)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 480,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleRetry,\n            style: {\n              background: '#22c55e',\n              color: '#0b1a0f',\n              border: 0,\n              padding: '.5rem 1rem',\n              borderRadius: 10,\n              fontWeight: 700,\n              cursor: 'pointer'\n            },\n            children: \"\\u21BB Reintentar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 483,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 475,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 455,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 437,\n    columnNumber: 5\n  }, this);\n}\n\n// Estilos de botones\n_s(Game, \"zyHyxh7knLWFMZ9LXIGLJ4n1b8M=\");\n_c = Game;\nconst primaryBtn = {\n  background: 'linear-gradient(135deg, #6366f1, #8b5cf6)',\n  color: 'white',\n  border: 0,\n  padding: '.75rem 1.25rem',\n  borderRadius: 10,\n  fontWeight: 700,\n  cursor: 'pointer',\n  boxShadow: '0 6px 18px rgba(99,102,241,.35)'\n};\nconst secondaryBtn = {\n  background: '#111827',\n  color: 'white',\n  border: 0,\n  padding: '.75rem 1.25rem',\n  borderRadius: 10,\n  fontWeight: 700,\n  cursor: 'pointer'\n};\nconst touchBtn = {\n  pointerEvents: 'auto',\n  background: 'rgba(0,0,0,.55)',\n  color: '#fff',\n  border: 0,\n  borderRadius: 10,\n  padding: '.5rem .75rem',\n  fontWeight: 700\n};\n\n// Utilidades\nfunction rectOverlap(ax, ay, aw, ah, bx, by, bw, bh) {\n  return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;\n}\nfunction formatTime(t) {\n  const s = Math.max(0, Math.floor(t));\n  const mm = String(Math.floor(s / 60)).padStart(2, '0');\n  const ss = String(s % 60).padStart(2, '0');\n  return `${mm}:${ss}`;\n}\nfunction wrapText(ctx, text, maxWidth) {\n  const words = text.split(' ');\n  let lines = [],\n    current = '';\n  for (const w of words) {\n    const test = current ? current + ' ' + w : w;\n    if (ctx.measureText(test).width > maxWidth && current) {\n      lines.push(current);\n      current = w;\n    } else current = test;\n  }\n  if (current) lines.push(current);\n  return lines;\n}\nfunction spawnObstacle(w) {\n  const type = Math.random() < 0.55 ? 'low' : 'high';\n  if (type === 'low') {\n    const width = 28 + Math.random() * 18;\n    const height = 22 + Math.random() * 22;\n    const x = w.worldX + 900 + Math.random() * 120;\n    const y = w.groundY - height;\n    w.obstacles.push({\n      type,\n      x,\n      y,\n      w: width,\n      h: height,\n      scored: false,\n      screenX: 0\n    });\n  } else {\n    const width = 84 + Math.random() * 70;\n    const height = 18;\n    const x = w.worldX + 900 + Math.random() * 120;\n    const y = w.groundY - (48 + 12);\n    w.obstacles.push({\n      type,\n      x,\n      y,\n      w: width,\n      h: height,\n      scored: false,\n      screenX: 0\n    });\n  }\n}\n\n// Dibujo UI\nfunction drawHUD(ctx, canvas, {\n  score,\n  time,\n  status\n}) {\n  ctx.save();\n  // Barra superior\n  ctx.globalAlpha = 0.9;\n  ctx.fillStyle = 'rgba(255,255,255,0.9)';\n  roundRect(ctx, 8, 8, canvas.width - 16, 34, 8);\n  ctx.fill();\n\n  // Puntuación\n  ctx.fillStyle = '#334155';\n  ctx.font = 'bold 12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'left';\n  ctx.fillText(`Puntos: ${Math.floor(score)}`, 16, 30);\n\n  // Tiempo restante + barra\n  ctx.textAlign = 'right';\n  ctx.fillText(`Tiempo: ${formatTime(time)}`, canvas.width - 16, 30);\n  const pct = Math.max(0, Math.min(1, time / 300));\n  const barW = (canvas.width - 16) * pct;\n  ctx.globalAlpha = 1;\n  ctx.fillStyle = '#22c55e';\n  roundRect(ctx, 8, 46, barW, 6, 3);\n  ctx.fill();\n  ctx.restore();\n}\nfunction drawIntroBackground(ctx, canvas) {\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\n  g.addColorStop(0, '#000');\n  g.addColorStop(1, '#1f2937');\n  ctx.fillStyle = g;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n}\nfunction drawIntro(ctx, canvas, lines, offset) {\n  ctx.save();\n  ctx.fillStyle = '#10b981';\n  ctx.textAlign = 'center';\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  const centerX = canvas.width / 2;\n  let y = canvas.height + offset;\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const scale = 1 - i * 0.05;\n    ctx.save();\n    ctx.translate(centerX, y);\n    ctx.scale(scale, scale);\n    ctx.fillText(line, 0, 0);\n    ctx.restore();\n    y += 36;\n  }\n  ctx.restore();\n}\nfunction drawSkipHint(ctx, canvas, text) {\n  ctx.save();\n  ctx.fillStyle = 'rgba(255,255,255,0.2)';\n  roundRect(ctx, canvas.width - 165, canvas.height - 36, 156, 26, 8);\n  ctx.fill();\n  ctx.fillStyle = '#e5e7eb';\n  ctx.font = '12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'right';\n  ctx.fillText(text, canvas.width - 12, canvas.height - 18);\n  ctx.restore();\n}\nfunction drawSky(ctx, canvas, shift) {\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\n  g.addColorStop(0, '#e8f0ff');\n  g.addColorStop(1, '#ffffff');\n  ctx.fillStyle = g;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  // nubes suaves\n  ctx.save();\n  ctx.globalAlpha = 0.25;\n  ctx.fillStyle = '#ffffff';\n  for (let i = 0; i < 6; i++) {\n    const x = (i * 180 - shift * 0.3 % (canvas.width + 200) + canvas.width + 200) % (canvas.width + 200) - 100;\n    ctx.beginPath();\n    ctx.ellipse(x, 60 + i % 2 * 18, 70, 20, 0, 0, Math.PI * 2);\n    ctx.fill();\n  }\n  ctx.restore();\n}\nfunction drawCity(ctx, canvas, shift) {\n  ctx.save();\n  ctx.fillStyle = '#c7d2fe';\n  const baseY = 180;\n  for (let i = 0; i < 14; i++) {\n    const w = 40 + i % 3 * 10;\n    const h = 30 + i % 5 * 18;\n    const x = (i * 90 - shift % (canvas.width + 200) + canvas.width + 200) % (canvas.width + 200) - 100;\n    roundRect(ctx, x, baseY - h, w, h, 4);\n    ctx.fill();\n  }\n  ctx.restore();\n}\nfunction drawHills(ctx, canvas, shift) {\n  ctx.save();\n  ctx.fillStyle = '#93c5fd';\n  for (let i = 0; i < 4; i++) {\n    const x = (i * 260 - shift % (canvas.width + 300) + canvas.width + 300) % (canvas.width + 300) - 150;\n    ctx.beginPath();\n    ctx.ellipse(x, 220, 180, 36, 0, 0, Math.PI * 2);\n    ctx.fill();\n  }\n  ctx.restore();\n}\nfunction drawObstacleLow(ctx, x, y, w, h) {\n  ctx.save();\n  ctx.fillStyle = '#94a3b8';\n  ctx.strokeStyle = '#475569';\n  ctx.lineWidth = 2;\n  roundRect(ctx, x, y, w, h, 6);\n  ctx.fill();\n  ctx.stroke();\n  ctx.restore();\n}\nfunction drawObstacleHigh(ctx, x, y, w, h) {\n  ctx.save();\n  ctx.fillStyle = '#9ca3af';\n  roundRect(ctx, x, y + h - 30, 4, 30, 2);\n  roundRect(ctx, x + w - 4, y + h - 30, 4, 30, 2);\n  ctx.fill();\n  ctx.fillStyle = '#22c55e';\n  roundRect(ctx, x, y, w, h, 6);\n  ctx.fill();\n  ctx.restore();\n}\n\n// Sticker conjunto: novio + novia cogidos de la mano\nfunction drawCouple(ctx, x, y, w, h, jumping, crouching) {\n  ctx.save();\n  // Sombra\n  if (jumping) {\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#000';\n    ctx.beginPath();\n    ctx.ellipse(x + w * 0.5, y + h + 10, w * 0.7, 5, 0, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.globalAlpha = 1;\n  }\n\n  // Novia (izquierda)\n  const nx = x - 16;\n  const ny = y;\n  const nw = Math.floor(w * 0.48);\n  const nh = h;\n  ctx.fillStyle = '#f8fafc';\n  roundRect(ctx, nx - 2, ny + nh * 0.35, nw + 4, nh * 0.65, 10); // vestido\n  ctx.fill();\n  ctx.fillStyle = '#e5e7eb';\n  roundRect(ctx, nx, ny, nw, nh * 0.45, 8); // torso\n  ctx.fill();\n  ctx.fillStyle = '#fde68a';\n  ctx.beginPath();\n  ctx.arc(nx + nw / 2, crouching ? ny - 4 : ny - 6, 10, 0, Math.PI * 2); // cabeza\n  ctx.fill();\n  // velo\n  ctx.globalAlpha = 0.6;\n  ctx.fillStyle = '#e0f2fe';\n  roundRect(ctx, nx - 6, ny - 6, nw + 12, 16, 8);\n  ctx.fill();\n  ctx.globalAlpha = 1;\n\n  // Novio (derecha)\n  const gx = x + nw - 4;\n  const gy = y;\n  const gw = Math.floor(w * 0.52);\n  const gh = h;\n  ctx.fillStyle = '#1f2937';\n  roundRect(ctx, gx, gy, gw, gh, 8);\n  ctx.fill(); // traje\n  ctx.fillStyle = '#fde68a';\n  ctx.beginPath();\n  ctx.arc(gx + gw / 2, crouching ? gy - 4 : gy - 6, 10, 0, Math.PI * 2);\n  ctx.fill(); // cabeza\n  ctx.fillStyle = '#ef4444';\n  ctx.fillRect(gx + gw / 2 - 3, gy + 10, 6, 10); // corbata\n\n  // Manos unidas (corazón pequeño)\n  ctx.fillStyle = '#ef4444';\n  ctx.beginPath();\n  const mx = gx - 4;\n  const my = y + h * 0.48;\n  ctx.arc(mx - 3, my, 3, 0, Math.PI * 2);\n  ctx.arc(mx + 3, my, 3, 0, Math.PI * 2);\n  ctx.moveTo(mx - 6, my);\n  ctx.lineTo(mx, my + 6);\n  ctx.lineTo(mx + 6, my);\n  ctx.fill();\n  ctx.restore();\n}\nfunction drawStoryWatermark(ctx, canvas, momentText) {\n  ctx.save();\n  ctx.globalAlpha = 0.12;\n  const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width * 0.9);\n  gradient.addColorStop(0, '#fbbf24');\n  gradient.addColorStop(0.5, '#f59e0b');\n  gradient.addColorStop(1, 'transparent');\n  ctx.fillStyle = gradient;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  // Texto grande sutil\n  ctx.globalAlpha = 0.22;\n  ctx.fillStyle = '#92400e';\n  ctx.font = 'bold 34px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  const words = momentText.split(' ');\n  let lines = [];\n  let currentLine = '';\n  for (const word of words) {\n    const test = currentLine + (currentLine ? ' ' : '') + word;\n    if (ctx.measureText(test).width > canvas.width * 0.7 && currentLine) {\n      lines.push(currentLine);\n      currentLine = word;\n    } else currentLine = test;\n  }\n  if (currentLine) lines.push(currentLine);\n  const lineHeight = 40;\n  const startY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;\n  for (let i = 0; i < lines.length; i++) ctx.fillText(lines[i], canvas.width / 2, startY + i * lineHeight);\n  ctx.restore();\n}\nfunction drawStoryBanner(ctx, canvas, text, alpha) {\n  ctx.save();\n  ctx.globalAlpha = Math.max(0, Math.min(1, alpha));\n  ctx.fillStyle = 'rgba(251, 191, 36, 0.95)';\n  const padding = 12;\n  ctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  const textW = ctx.measureText(text).width;\n  const boxW = Math.min(canvas.width - 24, textW + padding * 2 + 40);\n  const boxH = 42;\n  const boxX = (canvas.width - boxW) / 2;\n  const boxY = 6; // elevado\n  roundRect(ctx, boxX, boxY, boxW, boxH, 10);\n  ctx.fill();\n  ctx.strokeStyle = '#d97706';\n  ctx.lineWidth = 2;\n  ctx.stroke();\n  ctx.fillStyle = '#92400e';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText('💕 ' + text + ' 💕', canvas.width / 2, boxY + boxH / 2);\n  ctx.restore();\n}\nfunction drawOverlay(ctx, canvas, title, subtitle) {\n  ctx.save();\n  ctx.fillStyle = 'rgba(0,0,0,0.45)';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  ctx.fillStyle = '#fff';\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.fillText(title, canvas.width / 2, canvas.height / 2 - 6);\n  ctx.font = '14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.fillText(subtitle, canvas.width / 2, canvas.height / 2 + 18);\n  ctx.restore();\n}\nfunction roundRect(ctx, x, y, w, h, r) {\n  ctx.beginPath();\n  ctx.moveTo(x + r, y);\n  ctx.arcTo(x + w, y, x + w, y + h, r);\n  ctx.arcTo(x + w, y + h, x, y + h, r);\n  ctx.arcTo(x, y + h, x, y, r);\n  ctx.arcTo(x, y, x + w, y, r);\n  ctx.closePath();\n}\nvar _c;\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","Game","_s","containerRef","canvasRef","status","setStatus","muted","setMuted","GAME_DURATION","SCORE","TIMELEFT","INTRO_SHOWN","INTRO","offset","speed","lines","STORY_MOMENTS","text","timeStart","STORY","index","bannerText","bannerAlpha","bannerTimer","currentStoryMoment","setCurrentStoryMoment","BUFFERS","width","height","watermark","banner","rebuildStoryBuffers","canvas","current","sameSize","sameText","wm","document","createElement","wctx","getContext","globalAlpha","gradient","createRadialGradient","addColorStop","fillStyle","fillRect","font","textAlign","textBaseline","wrapText","lh","sy","length","i","fillText","pad","fullText","textW","measureText","boxW","Math","min","boxH","bn","ceil","bctx","roundRect","fill","strokeStyle","lineWidth","stroke","WORLD","maxSpeed","gravity","jumpV","fastFallBoost","groundY","player","x","y","w","h","vy","onGround","crouching","worldX","obstacles","startTs","lastTs","spawnTimer","spawnInterval","parallax","skyShift","cityShift","hillShift","resetWorld","ctx","rafId","loop","ts","dt","update","render","requestAnimationFrame","cancelAnimationFrame","onKeyDown","e","repeat","code","jump","crouch","togglePause","handlePlayFullscreen","startPlaying","onKeyUp","window","addEventListener","removeEventListener","p","on","prevBottom","_containerRef$current","requestFullscreen","audioEl","getElementById","currentTime","play","handleRetry","elapsed","remaining","max","maxIndex","idx","floor","tFactor","spawnObstacle","random","o","sx","screenX","scored","collide","rectOverlap","filter","clearRect","drawIntroBackground","drawIntro","drawSkipHint","drawSky","drawCity","drawHills","momentText","drawImage","drawStoryWatermark","type","drawObstacleLow","drawObstacleHigh","drawCouple","drawHUD","score","time","save","bx","by","restore","drawStoryBanner","drawOverlay","toggleMute","m","pause","ref","style","maxWidth","margin","padding","position","children","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","inset","display","alignItems","justifyContent","background","zIndex","borderRadius","boxShadow","marginTop","color","gap","onClick","primaryBtn","secondaryBtn","overflow","id","src","autoPlay","right","top","border","cursor","bottom","pointerEvents","onMouseDown","onTouchStart","touchBtn","onMouseUp","onTouchEnd","fontWeight","fontSize","opacity","_c","ax","ay","aw","ah","bw","bh","formatTime","t","s","mm","String","padStart","ss","words","split","test","push","pct","barW","g","createLinearGradient","centerX","line","scale","translate","shift","beginPath","ellipse","PI","baseY","jumping","nx","ny","nw","nh","arc","gx","gy","gw","gh","mx","my","moveTo","lineTo","currentLine","word","lineHeight","startY","alpha","boxX","boxY","title","subtitle","r","arcTo","closePath","$RefreshReg$"],"sources":["C:/Users/DanielGarcíaCarabelo/Downloads/pag web boda 2.0/html/webreact/src/components/Game.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\n\r\n// Juego moderno: pareja camino a la iglesia, con narrativa cada 30s\r\nexport default function Game() {\r\n  const containerRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n\r\n  // Estado principal\r\n  const [status, setStatus] = useState('menu'); // menu | intro | playing | paused | win | gameover\r\n  const [muted, setMuted] = useState(false);\r\n\r\n  // Configuración de juego\r\n  const GAME_DURATION = 300; // 5 min\r\n  const SCORE = useRef(0);\r\n  const TIMELEFT = useRef(GAME_DURATION);\r\n  const INTRO_SHOWN = useRef(false);\r\n\r\n  // Intro estilo Star Wars\r\n  const INTRO = useRef({\r\n    offset: 320,\r\n    speed: 40, // más lento para una intro más larga\r\n    lines: [\r\n      'En una galaxia muy, muy cercana...',\r\n      'Dos estrellas destinadas a unirse brillan con fuerza.',\r\n      'El gran día ha llegado y todos esperan en la iglesia.',\r\n      'Ayuda a la pareja a llegar a tiempo sorteando obstáculos...',\r\n      'Controles: ↑ o ESPACIO para saltar, ↓ para agacharte o caer rápido.',\r\n      'Pulsa P para pausar. R para reiniciar.',\r\n      '¡Que la fuerza del amor te acompañe!'\r\n    ]\r\n  });\r\n\r\n  // Momentos clave (cada 30s)\r\n  const STORY_MOMENTS = useRef([\r\n    { text: 'Ana y Dani en la Facultad de Derecho de la USC 🏛️', timeStart: 0 },\r\n    { text: 'Ana preparando las oposiciones para Jueza ⚖️', timeStart: 30 },\r\n    { text: 'Dani cursando el Máster de Abogacía 📖', timeStart: 60 },\r\n    { text: 'Dani empezando a trabajar como abogado 💼', timeStart: 90 },\r\n    { text: 'Dani trabajando en Porriño 🏢', timeStart: 120 },\r\n    { text: 'Dani mudándose a Carballiño 🏠', timeStart: 150 },\r\n    { text: 'Ana trabajando en Ponteareas 🏛️', timeStart: 180 },\r\n    { text: 'Ana aprobando la oposición en Pontevedra 🎉', timeStart: 210 },\r\n    { text: 'Ana y Dani viviendo juntos en Pontevedra 💕', timeStart: 240 },\r\n    { text: 'La pedida en la Torre de Hércules 💍', timeStart: 270 },\r\n    { text: '¡Y hoy... la boda! 👰💒🤵', timeStart: 300 }\r\n  ]);\r\n\r\n  // Narrativa actual con banner animado\r\n  const STORY = useRef({ index: -1, bannerText: '', bannerAlpha: 0, bannerTimer: 0 });\r\n  const [currentStoryMoment, setCurrentStoryMoment] = useState(null);\r\n  // Buffers para optimizar render de textos/gradientes\r\n  const BUFFERS = useRef({ width: 0, height: 0, text: '', watermark: null, banner: null });\r\n\r\n  // Reconstruir buffers de watermark y banner cuando cambie el texto o el tamaño\r\n  const rebuildStoryBuffers = (text) => {\r\n    const canvas = canvasRef.current; if (!canvas) return;\r\n    const width = canvas.width, height = canvas.height;\r\n    const sameSize = BUFFERS.current.width === width && BUFFERS.current.height === height;\r\n    const sameText = BUFFERS.current.text === text;\r\n    if (sameSize && sameText && BUFFERS.current.watermark && BUFFERS.current.banner) return;\r\n\r\n    BUFFERS.current.width = width; BUFFERS.current.height = height; BUFFERS.current.text = text;\r\n\r\n    // Watermark prerender\r\n    const wm = document.createElement('canvas'); wm.width = width; wm.height = height;\r\n    const wctx = wm.getContext('2d');\r\n    wctx.globalAlpha = 0.12;\r\n    const gradient = wctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, width*0.9);\r\n    gradient.addColorStop(0, '#fbbf24'); gradient.addColorStop(0.5, '#f59e0b'); gradient.addColorStop(1, 'transparent');\r\n    wctx.fillStyle = gradient; wctx.fillRect(0,0,width,height);\r\n    wctx.globalAlpha = 0.22; wctx.fillStyle = '#92400e';\r\n    wctx.font = 'bold 34px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n    wctx.textAlign = 'center'; wctx.textBaseline = 'middle';\r\n    const lines = wrapText(wctx, text, width * 0.7);\r\n    const lh = 40; const sy = height/2 - (lines.length - 1) * lh / 2;\r\n    for (let i = 0; i < lines.length; i++) wctx.fillText(lines[i], width/2, sy + i * lh);\r\n    BUFFERS.current.watermark = wm;\r\n\r\n    // Banner prerender\r\n    const pad = 12;\r\n    // usar el mismo contexto para medir con la misma fuente\r\n    wctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n    const fullText = '💕 ' + text + ' 💕';\r\n    const textW = wctx.measureText(fullText).width;\r\n    const boxW = Math.min(width - 24, textW + pad * 2 + 40);\r\n    const boxH = 42;\r\n    const bn = document.createElement('canvas'); bn.width = Math.ceil(boxW); bn.height = boxH;\r\n    const bctx = bn.getContext('2d');\r\n    bctx.fillStyle = 'rgba(251, 191, 36, 0.95)';\r\n    roundRect(bctx, 0, 0, boxW, boxH, 10); bctx.fill();\r\n    bctx.strokeStyle = '#d97706'; bctx.lineWidth = 2; bctx.stroke();\r\n    bctx.fillStyle = '#92400e';\r\n    bctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n    bctx.textAlign = 'center'; bctx.textBaseline = 'middle';\r\n    bctx.fillText(fullText, boxW / 2, boxH / 2);\r\n    BUFFERS.current.banner = bn;\r\n  };\r\n\r\n  // Mundo y física\r\n  const WORLD = useRef({\r\n    speed: 240,\r\n    maxSpeed: 420,\r\n    gravity: 1700,\r\n    jumpV: 620,\r\n    fastFallBoost: 2200,\r\n    groundY: 220,\r\n    player: { x: 100, y: 0, w: 70, h: 48, vy: 0, onGround: true, crouching: false },\r\n    worldX: 0,\r\n    obstacles: [],\r\n    startTs: 0,\r\n    lastTs: 0,\r\n    spawnTimer: 0,\r\n    spawnInterval: 1.3,\r\n    // Parallax\r\n    parallax: {\r\n      skyShift: 0,\r\n      cityShift: 0,\r\n      hillShift: 0\r\n    }\r\n  });\r\n\r\n  // Reset limpio\r\n  const resetWorld = () => {\r\n    SCORE.current = 0;\r\n    TIMELEFT.current = GAME_DURATION;\r\n    STORY.current = { index: -1, bannerText: '', bannerAlpha: 0, bannerTimer: 0 };\r\n    setCurrentStoryMoment(null);\r\n\r\n    const w = WORLD.current;\r\n    w.worldX = 0;\r\n    w.lastTs = 0;\r\n    w.startTs = 0;\r\n    w.speed = 240;\r\n    w.spawnInterval = 1.3;\r\n    w.spawnTimer = 0.8;\r\n    w.obstacles = [];\r\n    w.parallax.skyShift = 0;\r\n    w.parallax.cityShift = 0;\r\n    w.parallax.hillShift = 0;\r\n    w.player = { x: 100, y: w.groundY - 48, w: 70, h: 48, vy: 0, onGround: true, crouching: false };\r\n  };\r\n\r\n  useEffect(() => {\r\n    resetWorld();\r\n    INTRO.current.offset = 320;\r\n  }, []);\r\n\r\n  // Bucle de juego\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    let rafId;\r\n    const loop = (ts) => {\r\n      const w = WORLD.current;\r\n      if (!w.lastTs) {\r\n        w.lastTs = ts;\r\n        if (!w.startTs && status === 'playing') w.startTs = ts;\r\n      }\r\n      const dt = Math.min(0.032, (ts - w.lastTs) / 1000);\r\n      w.lastTs = ts;\r\n\r\n      update(dt, ts);\r\n      render(ctx, canvas);\r\n      rafId = requestAnimationFrame(loop);\r\n    };\r\n\r\n    rafId = requestAnimationFrame(loop);\r\n    return () => cancelAnimationFrame(rafId);\r\n  }, [status]);\r\n\r\n  // Reiniciar intro al entrar\r\n  useEffect(() => {\r\n    if (status === 'intro') INTRO.current.offset = 320;\r\n  }, [status]);\r\n\r\n  // Entradas\r\n  useEffect(() => {\r\n    const onKeyDown = (e) => {\r\n      if (e.repeat) return;\r\n      if ((e.code === 'Space' || e.code === 'ArrowUp') && status === 'playing') jump();\r\n      if (e.code === 'ArrowDown' && status === 'playing') crouch(true);\r\n      if (e.code === 'KeyR' && (status === 'playing' || status === 'gameover' || status === 'win' || status === 'paused')) {\r\n        resetWorld();\r\n        setStatus('menu');\r\n      }\r\n      if (e.code === 'KeyP' && (status === 'playing' || status === 'paused')) togglePause();\r\n      if (e.code === 'Enter' && status === 'menu') handlePlayFullscreen();\r\n      if (e.code === 'Enter' && status === 'intro') startPlaying();\r\n    };\r\n    const onKeyUp = (e) => {\r\n      if (e.code === 'ArrowDown') crouch(false);\r\n    };\r\n\r\n    window.addEventListener('keydown', onKeyDown);\r\n    window.addEventListener('keyup', onKeyUp);\r\n    return () => {\r\n      window.removeEventListener('keydown', onKeyDown);\r\n      window.removeEventListener('keyup', onKeyUp);\r\n    };\r\n  }, [status]);\r\n\r\n  const togglePause = () => {\r\n    if (status === 'playing') setStatus('paused');\r\n    else if (status === 'paused') setStatus('playing');\r\n  };\r\n\r\n  const jump = () => {\r\n    const p = WORLD.current.player;\r\n    if (p.onGround) {\r\n      p.vy = -WORLD.current.jumpV;\r\n      p.onGround = false;\r\n    }\r\n  };\r\n\r\n  const crouch = (on) => {\r\n    const p = WORLD.current.player;\r\n    if (on) {\r\n      if (!p.onGround) p.vy += WORLD.current.fastFallBoost * 0.04; // caída rápida\r\n      else if (!p.crouching) {\r\n        p.crouching = true;\r\n        const prevBottom = p.y + p.h;\r\n        p.h = 32; // reducir un poco la altura\r\n        p.y = prevBottom - p.h;\r\n      }\r\n    } else if (p.crouching) {\r\n      const prevBottom = p.y + p.h;\r\n      p.h = 48;\r\n      p.y = prevBottom - p.h;\r\n      p.crouching = false;\r\n    }\r\n  };\r\n\r\n  const handlePlayFullscreen = async () => {\r\n    try { if (containerRef.current?.requestFullscreen) await containerRef.current.requestFullscreen(); } catch {}\r\n    resetWorld();\r\n\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) { audioEl.currentTime = 0; audioEl.play(); audioEl.muted = muted; }\r\n\r\n    if (!INTRO_SHOWN.current) { setStatus('intro'); INTRO_SHOWN.current = true; }\r\n    else { startPlaying(); }\r\n  };\r\n\r\n  const startPlaying = () => {\r\n    const w = WORLD.current;\r\n    w.lastTs = 0;\r\n    w.startTs = 0;\r\n    // Mostrar primer momento inmediatamente\r\n    STORY.current.index = 0;\r\n    STORY.current.bannerText = STORY_MOMENTS.current[0].text;\r\n    STORY.current.bannerTimer = 4.2; // mostrar 4.2s\r\n    STORY.current.bannerAlpha = 0; // animar fade-in\r\n    setCurrentStoryMoment(STORY.current.bannerText);\r\n    // construir buffers para rendimiento\r\n    rebuildStoryBuffers(STORY.current.bannerText);\r\n    setStatus('playing');\r\n  };\r\n\r\n  const handleRetry = () => {\r\n    resetWorld();\r\n    setCurrentStoryMoment(null);\r\n    startPlaying();\r\n  };\r\n\r\n  const update = (dt, ts) => {\r\n    const w = WORLD.current;\r\n\r\n    if (status === 'menu') return;\r\n\r\n    if (status === 'intro') {\r\n      INTRO.current.offset -= INTRO.current.speed * dt;\r\n      if (INTRO.current.offset < -140) startPlaying();\r\n      return;\r\n    }\r\n\r\n    if (status === 'paused') return;\r\n    if (status !== 'playing') return;\r\n\r\n    // Tiempo de juego\r\n    if (w.startTs === 0) w.startTs = ts;\r\n    const elapsed = (ts - w.startTs) / 1000;\r\n    const remaining = Math.max(0, GAME_DURATION - elapsed);\r\n    TIMELEFT.current = remaining;\r\n\r\n    // Narrativa basada en tiempo -> índice\r\n    const maxIndex = STORY_MOMENTS.current.length - 1;\r\n    const idx = Math.min(Math.floor(elapsed / 30), maxIndex);\r\n    if (idx !== STORY.current.index) {\r\n      STORY.current.index = idx;\r\n      STORY.current.bannerText = STORY_MOMENTS.current[idx].text;\r\n      STORY.current.bannerTimer = 4.2;\r\n      setCurrentStoryMoment(STORY.current.bannerText);\r\n      // reconstruir buffers en cada cambio de momento\r\n      rebuildStoryBuffers(STORY.current.bannerText);\r\n    }\r\n\r\n    // Animación del banner (fade in/out)\r\n    if (STORY.current.bannerTimer > 0) {\r\n      STORY.current.bannerTimer -= dt;\r\n      STORY.current.bannerAlpha = Math.min(1, STORY.current.bannerAlpha + dt * 3);\r\n    } else {\r\n      STORY.current.bannerAlpha = Math.max(0, STORY.current.bannerAlpha - dt * 2);\r\n    }\r\n\r\n    if (remaining <= 0.01) { setStatus('win'); return; }\r\n\r\n    // Progresión de dificultad\r\n    const tFactor = Math.min(1, elapsed / GAME_DURATION);\r\n    w.speed = 240 + (w.maxSpeed - 240) * tFactor;\r\n    w.spawnInterval = 1.3 - 0.8 * tFactor;\r\n\r\n    // Parallax scrolling\r\n    w.parallax.skyShift += w.speed * 0.08 * dt;\r\n    w.parallax.cityShift += w.speed * 0.25 * dt;\r\n    w.parallax.hillShift += w.speed * 0.45 * dt;\r\n\r\n    // Avance mundo\r\n    w.worldX += w.speed * dt;\r\n\r\n    // Física jugador\r\n    const p = w.player;\r\n    p.vy += w.gravity * dt;\r\n    p.y += p.vy * dt;\r\n    const groundY = w.groundY - p.h;\r\n    if (p.y >= groundY) { p.y = groundY; p.vy = 0; p.onGround = true; } else { p.onGround = false; }\r\n\r\n    // Spawn obstáculos\r\n    w.spawnTimer -= dt;\r\n    if (w.spawnTimer <= 0) {\r\n      spawnObstacle(w);\r\n      w.spawnTimer = w.spawnInterval * (0.9 + Math.random() * 0.4);\r\n    }\r\n\r\n    // Colisiones + puntuación\r\n    for (const o of w.obstacles) {\r\n      const sx = o.x - w.worldX + p.x;\r\n      o.screenX = sx;\r\n      if (!o.scored && sx + o.w < p.x) { o.scored = true; SCORE.current += 100; }\r\n      const collide = rectOverlap(p.x, p.y, p.w, p.h, sx, o.y, o.w, o.h);\r\n      if (collide) { setStatus('gameover'); break; }\r\n    }\r\n\r\n    // Limpiar\r\n    w.obstacles = w.obstacles.filter((o) => o.screenX > -140);\r\n    SCORE.current += Math.floor(w.speed * dt * 0.6);\r\n  };\r\n\r\n  const render = (ctx, canvas) => {\r\n    const w = WORLD.current;\r\n    const p = w.player;\r\n\r\n    // Fondo\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (status === 'intro') {\r\n      drawIntroBackground(ctx, canvas);\r\n      drawIntro(ctx, canvas, INTRO.current.lines, INTRO.current.offset);\r\n      drawSkipHint(ctx, canvas, 'Pulsa Enter para saltar');\r\n      return;\r\n    }\r\n\r\n    drawSky(ctx, canvas, w.parallax.skyShift);\r\n    drawCity(ctx, canvas, w.parallax.cityShift);\r\n    drawHills(ctx, canvas, w.parallax.hillShift);\r\n\r\n    // Marca de agua narrativa sutil\r\n    const momentText = currentStoryMoment || STORY_MOMENTS.current[0].text;\r\n    // Dibujar watermark desde buffer si existe\r\n    if (BUFFERS.current.watermark) {\r\n      ctx.drawImage(BUFFERS.current.watermark, 0, 0);\r\n    } else {\r\n      // Fallback (primera vez muy puntual)\r\n      drawStoryWatermark(ctx, canvas, momentText);\r\n    }\r\n\r\n    // Suelo\r\n    ctx.fillStyle = '#bfe3ff';\r\n    ctx.fillRect(0, w.groundY + 12, canvas.width, 4);\r\n\r\n    // Obstáculos\r\n    for (const o of w.obstacles) {\r\n      if (o.screenX < -80 || o.screenX > canvas.width + 120) continue;\r\n      if (o.type === 'low') drawObstacleLow(ctx, o.screenX, o.y, o.w, o.h);\r\n      else drawObstacleHigh(ctx, o.screenX, o.y, o.w, o.h);\r\n    }\r\n\r\n    // Pareja (sticker conjunto)\r\n    drawCouple(ctx, p.x, p.y, p.w, p.h, !p.onGround, p.crouching);\r\n\r\n    // HUD\r\n    drawHUD(ctx, canvas, {\r\n      score: SCORE.current,\r\n      time: TIMELEFT.current,\r\n      status\r\n    });\r\n\r\n    // Banner de momento especial (animado)\r\n    if (STORY.current.bannerAlpha > 0) {\r\n      if (BUFFERS.current.banner) {\r\n        ctx.save();\r\n        ctx.globalAlpha = STORY.current.bannerAlpha;\r\n        const bx = (canvas.width - BUFFERS.current.banner.width) / 2;\r\n        const by = 6;\r\n        ctx.drawImage(BUFFERS.current.banner, bx, by);\r\n        ctx.restore();\r\n      } else {\r\n        drawStoryBanner(ctx, canvas, momentText, STORY.current.bannerAlpha);\r\n      }\r\n    }\r\n\r\n    if (status === 'paused') {\r\n      drawOverlay(ctx, canvas, 'Pausa ⏸', 'Pulsa P para continuar');\r\n      return;\r\n    }\r\n\r\n    if (status === 'gameover') {\r\n      drawOverlay(ctx, canvas, '¡Ups! Te has tropezado', 'Pulsa R para volver al menú');\r\n    } else if (status === 'win') {\r\n      drawOverlay(ctx, canvas, '¡Llegaste a tiempo! 💒', `Puntuación: ${Math.floor(SCORE.current)} · Pulsa R para menú`);\r\n    }\r\n  };\r\n\r\n  const toggleMute = () => {\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) { audioEl.muted = !audioEl.muted; setMuted(audioEl.muted); }\r\n    else setMuted((m) => !m);\r\n  };\r\n\r\n  useEffect(() => () => {\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) audioEl.pause();\r\n  }, []);\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ maxWidth: 980, margin: '0 auto', padding: '1rem', position: 'relative' }}>\r\n      <h2 style={{ textAlign: 'center', marginBottom: '.5rem' }}>Camino a la iglesia</h2>\r\n\r\n      {status === 'menu' && (\r\n        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'linear-gradient(135deg, rgba(255,255,255,.95), rgba(238,242,255,.95))', zIndex: 5, borderRadius: 12 }}>\r\n          <div style={{ width: 'min(92%, 620px)', padding: '1.25rem', borderRadius: 12, boxShadow: '0 8px 28px rgba(0,0,0,.18)', background: 'white' }}>\r\n            <h3 style={{ marginTop: 0, textAlign: 'center' }}>¡Acompaña a Ana y Dani!</h3>\r\n            <p style={{ textAlign: 'center', color: '#64748b', marginTop: 4 }}>\r\n              Esquiva obstáculos durante 5 minutos. La historia de la pareja aparecerá como momentos especiales cada 30s.\r\n            </p>\r\n            <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', marginTop: '1rem' }}>\r\n              <button onClick={handlePlayFullscreen} style={primaryBtn}>▶ Jugar en pantalla completa</button>\r\n              <button onClick={() => { resetWorld(); startPlaying(); }} style={secondaryBtn}>▷ Jugar</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div style={{ borderRadius: 12, overflow: 'hidden', boxShadow: '0 6px 24px rgba(0,0,0,.12)', background: 'white', position: 'relative' }}>\r\n        <audio id=\"bg-music\" src=\"/musica-boda.mp3\" loop autoPlay={false} style={{ display: 'none' }} />\r\n        <button onClick={toggleMute} aria-label={muted ? 'Activar sonido' : 'Silenciar sonido'} style={{ position: 'absolute', right: 8, top: 8, zIndex: 8, background: 'rgba(0,0,0,.55)', color: '#fff', border: 0, borderRadius: 999, width: 36, height: 36, cursor: 'pointer' }}>{muted ? '🔇' : '🔊'}</button>\r\n        {(status === 'playing' || status === 'paused') && (\r\n          <button onClick={togglePause} style={{ position: 'absolute', right: 52, top: 8, zIndex: 8, background: 'rgba(0,0,0,.55)', color: '#fff', border: 0, borderRadius: 999, width: 36, height: 36, cursor: 'pointer' }}>{status === 'paused' ? '▶' : '⏸'}</button>\r\n        )}\r\n        {status === 'intro' && (\r\n          <button onClick={startPlaying} style={{ position: 'absolute', right: 8, bottom: 8, zIndex: 8, background: 'rgba(0,0,0,.55)', color: '#fff', border: 0, borderRadius: 8, padding: '.4rem .6rem', cursor: 'pointer' }}>Saltar intro</button>\r\n        )}\r\n        <canvas ref={canvasRef} width={900} height={280} style={{ width: '100%', display: 'block', background: status === 'intro' ? '#000' : 'linear-gradient(#eef2ff, #fff)' }} />\r\n\r\n        {/* Controles táctiles */}\r\n        {status === 'playing' && (\r\n          <div style={{ position: 'absolute', inset: 'auto 0 0 0', display: 'flex', justifyContent: 'space-between', padding: '8px 10px', pointerEvents: 'none' }}>\r\n            <button onMouseDown={jump} onTouchStart={jump} style={touchBtn}>⮝ Saltar</button>\r\n            <button onMouseDown={() => crouch(true)} onMouseUp={() => crouch(false)} onTouchStart={() => crouch(true)} onTouchEnd={() => crouch(false)} style={touchBtn}>⮟ Agachar</button>\r\n          </div>\r\n        )}\r\n\r\n        {(status === 'gameover' || status === 'win') && (\r\n          <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 7 }}>\r\n            <div style={{ background: 'rgba(17,24,39,.88)', color: '#fff', padding: '1rem 1.25rem', borderRadius: 12, boxShadow: '0 8px 28px rgba(0,0,0,.35)', textAlign: 'center' }}>\r\n              <div style={{ fontWeight: 700, fontSize: 18, marginBottom: 8 }}>\r\n                {status === 'win' ? '¡Llegaste a tiempo! 💒' : '¡Ups! Te has tropezado'}\r\n              </div>\r\n              <div style={{ fontSize: 14, opacity: .9, marginBottom: 12 }}>\r\n                Puntuación: {Math.floor(SCORE.current)}\r\n              </div>\r\n              <button onClick={handleRetry} style={{ background: '#22c55e', color: '#0b1a0f', border: 0, padding: '.5rem 1rem', borderRadius: 10, fontWeight: 700, cursor: 'pointer' }}>↻ Reintentar</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Estilos de botones\r\nconst primaryBtn = {\r\n  background: 'linear-gradient(135deg, #6366f1, #8b5cf6)',\r\n  color: 'white', border: 0, padding: '.75rem 1.25rem',\r\n  borderRadius: 10, fontWeight: 700, cursor: 'pointer',\r\n  boxShadow: '0 6px 18px rgba(99,102,241,.35)'\r\n};\r\nconst secondaryBtn = {\r\n  background: '#111827', color: 'white', border: 0,\r\n  padding: '.75rem 1.25rem', borderRadius: 10,\r\n  fontWeight: 700, cursor: 'pointer'\r\n};\r\nconst touchBtn = {\r\n  pointerEvents: 'auto',\r\n  background: 'rgba(0,0,0,.55)', color: '#fff', border: 0,\r\n  borderRadius: 10, padding: '.5rem .75rem', fontWeight: 700\r\n};\r\n\r\n// Utilidades\r\nfunction rectOverlap(ax, ay, aw, ah, bx, by, bw, bh) {\r\n  return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;\r\n}\r\nfunction formatTime(t) {\r\n  const s = Math.max(0, Math.floor(t));\r\n  const mm = String(Math.floor(s / 60)).padStart(2, '0');\r\n  const ss = String(s % 60).padStart(2, '0');\r\n  return `${mm}:${ss}`;\r\n}\r\nfunction wrapText(ctx, text, maxWidth) {\r\n  const words = text.split(' ');\r\n  let lines = [], current = '';\r\n  for (const w of words) {\r\n    const test = current ? current + ' ' + w : w;\r\n    if (ctx.measureText(test).width > maxWidth && current) { lines.push(current); current = w; }\r\n    else current = test;\r\n  }\r\n  if (current) lines.push(current);\r\n  return lines;\r\n}\r\n\r\nfunction spawnObstacle(w) {\r\n  const type = Math.random() < 0.55 ? 'low' : 'high';\r\n  if (type === 'low') {\r\n    const width = 28 + Math.random() * 18;\r\n    const height = 22 + Math.random() * 22;\r\n    const x = w.worldX + 900 + Math.random() * 120;\r\n    const y = w.groundY - height;\r\n    w.obstacles.push({ type, x, y, w: width, h: height, scored: false, screenX: 0 });\r\n  } else {\r\n    const width = 84 + Math.random() * 70;\r\n    const height = 18;\r\n    const x = w.worldX + 900 + Math.random() * 120;\r\n    const y = w.groundY - (48 + 12);\r\n    w.obstacles.push({ type, x, y, w: width, h: height, scored: false, screenX: 0 });\r\n  }\r\n}\r\n\r\n// Dibujo UI\r\nfunction drawHUD(ctx, canvas, { score, time, status }) {\r\n  ctx.save();\r\n  // Barra superior\r\n  ctx.globalAlpha = 0.9;\r\n  ctx.fillStyle = 'rgba(255,255,255,0.9)';\r\n  roundRect(ctx, 8, 8, canvas.width - 16, 34, 8);\r\n  ctx.fill();\r\n\r\n  // Puntuación\r\n  ctx.fillStyle = '#334155';\r\n  ctx.font = 'bold 12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'left';\r\n  ctx.fillText(`Puntos: ${Math.floor(score)}`, 16, 30);\r\n\r\n  // Tiempo restante + barra\r\n  ctx.textAlign = 'right';\r\n  ctx.fillText(`Tiempo: ${formatTime(time)}`, canvas.width - 16, 30);\r\n  const pct = Math.max(0, Math.min(1, time / 300));\r\n  const barW = (canvas.width - 16) * pct;\r\n  ctx.globalAlpha = 1;\r\n  ctx.fillStyle = '#22c55e';\r\n  roundRect(ctx, 8, 46, barW, 6, 3);\r\n  ctx.fill();\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawIntroBackground(ctx, canvas) {\r\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\r\n  g.addColorStop(0, '#000');\r\n  g.addColorStop(1, '#1f2937');\r\n  ctx.fillStyle = g;\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n}\r\n\r\nfunction drawIntro(ctx, canvas, lines, offset) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#10b981';\r\n  ctx.textAlign = 'center';\r\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  const centerX = canvas.width / 2;\r\n  let y = canvas.height + offset;\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const line = lines[i];\r\n    const scale = 1 - i * 0.05;\r\n    ctx.save();\r\n    ctx.translate(centerX, y);\r\n    ctx.scale(scale, scale);\r\n    ctx.fillText(line, 0, 0);\r\n    ctx.restore();\r\n    y += 36;\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawSkipHint(ctx, canvas, text) {\r\n  ctx.save();\r\n  ctx.fillStyle = 'rgba(255,255,255,0.2)';\r\n  roundRect(ctx, canvas.width - 165, canvas.height - 36, 156, 26, 8);\r\n  ctx.fill();\r\n  ctx.fillStyle = '#e5e7eb';\r\n  ctx.font = '12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'right';\r\n  ctx.fillText(text, canvas.width - 12, canvas.height - 18);\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawSky(ctx, canvas, shift) {\r\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\r\n  g.addColorStop(0, '#e8f0ff');\r\n  g.addColorStop(1, '#ffffff');\r\n  ctx.fillStyle = g;\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n  // nubes suaves\r\n  ctx.save();\r\n  ctx.globalAlpha = 0.25;\r\n  ctx.fillStyle = '#ffffff';\r\n  for (let i = 0; i < 6; i++) {\r\n    const x = ((i * 180 - (shift * 0.3) % (canvas.width + 200)) + canvas.width + 200) % (canvas.width + 200) - 100;\r\n    ctx.beginPath();\r\n    ctx.ellipse(x, 60 + (i % 2) * 18, 70, 20, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawCity(ctx, canvas, shift) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#c7d2fe';\r\n  const baseY = 180;\r\n  for (let i = 0; i < 14; i++) {\r\n    const w = 40 + (i % 3) * 10;\r\n    const h = 30 + (i % 5) * 18;\r\n    const x = ((i * 90 - (shift % (canvas.width + 200))) + canvas.width + 200) % (canvas.width + 200) - 100;\r\n    roundRect(ctx, x, baseY - h, w, h, 4);\r\n    ctx.fill();\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawHills(ctx, canvas, shift) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#93c5fd';\r\n  for (let i = 0; i < 4; i++) {\r\n    const x = ((i * 260 - (shift % (canvas.width + 300))) + canvas.width + 300) % (canvas.width + 300) - 150;\r\n    ctx.beginPath();\r\n    ctx.ellipse(x, 220, 180, 36, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawObstacleLow(ctx, x, y, w, h) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#94a3b8';\r\n  ctx.strokeStyle = '#475569';\r\n  ctx.lineWidth = 2;\r\n  roundRect(ctx, x, y, w, h, 6);\r\n  ctx.fill();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawObstacleHigh(ctx, x, y, w, h) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#9ca3af';\r\n  roundRect(ctx, x, y + h - 30, 4, 30, 2);\r\n  roundRect(ctx, x + w - 4, y + h - 30, 4, 30, 2);\r\n  ctx.fill();\r\n  ctx.fillStyle = '#22c55e';\r\n  roundRect(ctx, x, y, w, h, 6);\r\n  ctx.fill();\r\n  ctx.restore();\r\n}\r\n\r\n// Sticker conjunto: novio + novia cogidos de la mano\r\nfunction drawCouple(ctx, x, y, w, h, jumping, crouching) {\r\n  ctx.save();\r\n  // Sombra\r\n  if (jumping) {\r\n    ctx.globalAlpha = 0.2;\r\n    ctx.fillStyle = '#000';\r\n    ctx.beginPath();\r\n    ctx.ellipse(x + w * 0.5, y + h + 10, w * 0.7, 5, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.globalAlpha = 1;\r\n  }\r\n\r\n  // Novia (izquierda)\r\n  const nx = x - 16; const ny = y; const nw = Math.floor(w * 0.48); const nh = h;\r\n  ctx.fillStyle = '#f8fafc';\r\n  roundRect(ctx, nx - 2, ny + nh * 0.35, nw + 4, nh * 0.65, 10); // vestido\r\n  ctx.fill();\r\n  ctx.fillStyle = '#e5e7eb';\r\n  roundRect(ctx, nx, ny, nw, nh * 0.45, 8); // torso\r\n  ctx.fill();\r\n  ctx.fillStyle = '#fde68a';\r\n  ctx.beginPath();\r\n  ctx.arc(nx + nw / 2, crouching ? ny - 4 : ny - 6, 10, 0, Math.PI * 2); // cabeza\r\n  ctx.fill();\r\n  // velo\r\n  ctx.globalAlpha = 0.6; ctx.fillStyle = '#e0f2fe'; roundRect(ctx, nx - 6, ny - 6, nw + 12, 16, 8); ctx.fill(); ctx.globalAlpha = 1;\r\n\r\n  // Novio (derecha)\r\n  const gx = x + nw - 4; const gy = y; const gw = Math.floor(w * 0.52); const gh = h;\r\n  ctx.fillStyle = '#1f2937'; roundRect(ctx, gx, gy, gw, gh, 8); ctx.fill(); // traje\r\n  ctx.fillStyle = '#fde68a'; ctx.beginPath(); ctx.arc(gx + gw / 2, crouching ? gy - 4 : gy - 6, 10, 0, Math.PI * 2); ctx.fill(); // cabeza\r\n  ctx.fillStyle = '#ef4444'; ctx.fillRect(gx + gw / 2 - 3, gy + 10, 6, 10); // corbata\r\n\r\n  // Manos unidas (corazón pequeño)\r\n  ctx.fillStyle = '#ef4444';\r\n  ctx.beginPath();\r\n  const mx = gx - 4; const my = y + h * 0.48;\r\n  ctx.arc(mx - 3, my, 3, 0, Math.PI * 2);\r\n  ctx.arc(mx + 3, my, 3, 0, Math.PI * 2);\r\n  ctx.moveTo(mx - 6, my); ctx.lineTo(mx, my + 6); ctx.lineTo(mx + 6, my);\r\n  ctx.fill();\r\n\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawStoryWatermark(ctx, canvas, momentText) {\r\n  ctx.save();\r\n  ctx.globalAlpha = 0.12;\r\n  const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width * 0.9);\r\n  gradient.addColorStop(0, '#fbbf24');\r\n  gradient.addColorStop(0.5, '#f59e0b');\r\n  gradient.addColorStop(1, 'transparent');\r\n  ctx.fillStyle = gradient;\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n  // Texto grande sutil\r\n  ctx.globalAlpha = 0.22;\r\n  ctx.fillStyle = '#92400e';\r\n  ctx.font = 'bold 34px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n\r\n  const words = momentText.split(' ');\r\n  let lines = []; let currentLine = '';\r\n  for (const word of words) {\r\n    const test = currentLine + (currentLine ? ' ' : '') + word;\r\n    if (ctx.measureText(test).width > canvas.width * 0.7 && currentLine) { lines.push(currentLine); currentLine = word; }\r\n    else currentLine = test;\r\n  }\r\n  if (currentLine) lines.push(currentLine);\r\n\r\n  const lineHeight = 40;\r\n  const startY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;\r\n  for (let i = 0; i < lines.length; i++) ctx.fillText(lines[i], canvas.width / 2, startY + i * lineHeight);\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawStoryBanner(ctx, canvas, text, alpha) {\r\n  ctx.save();\r\n  ctx.globalAlpha = Math.max(0, Math.min(1, alpha));\r\n  ctx.fillStyle = 'rgba(251, 191, 36, 0.95)';\r\n  const padding = 12;\r\n  ctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  const textW = ctx.measureText(text).width;\r\n  const boxW = Math.min(canvas.width - 24, textW + padding * 2 + 40);\r\n  const boxH = 42;\r\n  const boxX = (canvas.width - boxW) / 2;\r\n  const boxY = 6; // elevado\r\n  roundRect(ctx, boxX, boxY, boxW, boxH, 10);\r\n  ctx.fill();\r\n  ctx.strokeStyle = '#d97706'; ctx.lineWidth = 2; ctx.stroke();\r\n  ctx.fillStyle = '#92400e';\r\n  ctx.textAlign = 'center'; ctx.textBaseline = 'middle';\r\n  ctx.fillText('💕 ' + text + ' 💕', canvas.width / 2, boxY + boxH / 2);\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawOverlay(ctx, canvas, title, subtitle) {\r\n  ctx.save();\r\n  ctx.fillStyle = 'rgba(0,0,0,0.45)';\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n  ctx.fillStyle = '#fff';\r\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText(title, canvas.width / 2, canvas.height / 2 - 6);\r\n  ctx.font = '14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.fillText(subtitle, canvas.width / 2, canvas.height / 2 + 18);\r\n  ctx.restore();\r\n}\r\n\r\nfunction roundRect(ctx, x, y, w, h, r) {\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + r, y);\r\n  ctx.arcTo(x + w, y, x + w, y + h, r);\r\n  ctx.arcTo(x + w, y + h, x, y + h, r);\r\n  ctx.arcTo(x, y + h, x, y, r);\r\n  ctx.arcTo(x, y, x + w, y, r);\r\n  ctx.closePath();\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}