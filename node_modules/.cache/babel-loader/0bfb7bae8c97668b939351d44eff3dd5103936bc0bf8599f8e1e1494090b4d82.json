{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DanielGarc\\xEDaCarabelo\\\\Downloads\\\\pag web boda 2.0\\\\html\\\\webreact\\\\src\\\\components\\\\Game.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\n\n// Minijuego 2D: El novio/la novia quiere llegar a la iglesia esquivando obst√°culos\n// Controles: Space o Flecha ‚Üë para saltar. Mant√©n Flecha ‚Üì para agacharte (en el aire: ca√≠da r√°pida). R para reiniciar.\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Game() {\n  _s();\n  const containerRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  // Estados de juego: menu | intro | playing | win | gameover\n  const [status, setStatus] = useState('menu');\n  const [skin, setSkin] = useState('novio'); // 'novio' | 'novia'\n  const [score, setScore] = useState(0);\n  const [timeLeft, setTimeLeft] = useState(300); // 5 minutos\n\n  const GAME_DURATION = 300; // 5 min gameplay (la intro no consume tiempo)\n\n  // NUEVO: refs para evitar valores congelados en el canvas\n  const SCORE = useRef(0);\n  const TIMELEFT = useRef(GAME_DURATION);\n  // NUEVO: mostrar la intro solo una vez\n  const INTRO_SHOWN = useRef(false);\n\n  // Estado de mute para el audio\n  const [muted, setMuted] = useState(false);\n\n  // Intro tipo \"Star Wars\"\n  const INTRO = useRef({\n    offset: 0,\n    speed: 60,\n    // px/s desplazamiento hacia arriba\n    lines: ['En una galaxia muy, muy cercana...', 'Dos estrellas destinadas a unirse brillan con fuerza.', 'El gran d√≠a ha llegado y todos esperan en la iglesia.', 'Ayuda a la pareja a llegar a tiempo sorteando obst√°culos...', 'Controles: ‚Üë o ESPACIO para saltar, ‚Üì para agacharte o caer r√°pido.', '¬°Que la fuerza del amor te acompa√±e!']\n  });\n\n  // Momentos clave de la pareja (cada 30 segundos)\n  const STORY_MOMENTS = useRef([{\n    text: \"Ana y Dani en la Facultad de Derecho de la USC üèõÔ∏è\",\n    icon: \"üìö\",\n    timeStart: 0\n  }, {\n    text: \"Ana preparando las oposiciones para Jueza ‚öñÔ∏è\",\n    icon: \"üë©‚Äç‚öñÔ∏è\",\n    timeStart: 30\n  }, {\n    text: \"Dani cursando el M√°ster de Abogac√≠a üìñ\",\n    icon: \"üéì\",\n    timeStart: 60\n  }, {\n    text: \"Dani empezando a trabajar como abogado üíº\",\n    icon: \"üë®‚Äçüíº\",\n    timeStart: 90\n  }, {\n    text: \"Dani trabajando en Porri√±o üè¢\",\n    icon: \"‚öñÔ∏è\",\n    timeStart: 120\n  }, {\n    text: \"Dani mud√°ndose a Carballi√±o üè†\",\n    icon: \"üì¶\",\n    timeStart: 150\n  }, {\n    text: \"Ana trabajando en Ponteareas üèõÔ∏è\",\n    icon: \"üë©‚Äçüíº\",\n    timeStart: 180\n  }, {\n    text: \"Ana aprobando la oposici√≥n en Pontevedra! üéâ\",\n    icon: \"üèÜ\",\n    timeStart: 210\n  }, {\n    text: \"Ana y Dani viviendo juntos en Pontevedra üíï\",\n    icon: \"üè°\",\n    timeStart: 240\n  }, {\n    text: \"La pedida de mano en la Torre de H√©rcules üíç\",\n    icon: \"üíí\",\n    timeStart: 270\n  }, {\n    text: \"¬°Y hoy... la boda! üë∞üííü§µ\",\n    icon: \"üíñ\",\n    timeStart: 300\n  }]);\n  const [currentStoryMoment, setCurrentStoryMoment] = useState(null);\n\n  // Estado del mundo\n  const WORLD = useRef({\n    speed: 220,\n    maxSpeed: 380,\n    gravity: 1700,\n    jumpV: 620,\n    fastFallBoost: 2200,\n    groundY: 220,\n    player: {\n      x: 80,\n      y: 0,\n      w: 32,\n      h: 42,\n      vy: 0,\n      onGround: true,\n      crouching: false\n    },\n    worldX: 0,\n    obstacles: [],\n    startTs: 0,\n    lastTs: 0,\n    spawnTimer: 0,\n    spawnInterval: 1.4\n  });\n\n  // Reset base (sin cambiar estado)\n  const resetWorld = () => {\n    setScore(0);\n    setTimeLeft(GAME_DURATION);\n    setCurrentStoryMoment(null); // resetear momento de la historia\n    WORLD.current.worldX = 0;\n    WORLD.current.lastTs = 0;\n    WORLD.current.startTs = 0;\n    WORLD.current.speed = 220;\n    WORLD.current.spawnInterval = 1.4;\n    WORLD.current.spawnTimer = 0.8;\n    WORLD.current.obstacles = [];\n    WORLD.current.player = {\n      x: 80,\n      y: WORLD.current.groundY - 42,\n      w: 32,\n      h: 42,\n      vy: 0,\n      onGround: true,\n      crouching: false\n    };\n    // NUEVO: sincronizar refs\n    SCORE.current = 0;\n    TIMELEFT.current = GAME_DURATION;\n  };\n  useEffect(() => {\n    // init: mostrar men√∫\n    resetWorld();\n    INTRO.current.offset = 320; // arranca fuera de la pantalla por abajo\n  }, []);\n\n  // Bucle de juego y render\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    let rafId;\n    const loop = ts => {\n      if (!WORLD.current.lastTs) {\n        WORLD.current.lastTs = ts;\n        if (!WORLD.current.startTs && status === 'playing') WORLD.current.startTs = ts;\n      }\n      const dt = Math.min(0.032, (ts - WORLD.current.lastTs) / 1000);\n      WORLD.current.lastTs = ts;\n      update(dt, ts);\n      render(ctx, canvas);\n      rafId = requestAnimationFrame(loop);\n    };\n    rafId = requestAnimationFrame(loop);\n    return () => cancelAnimationFrame(rafId);\n  }, [status]);\n\n  // NUEVO: cada vez que entramos en intro, reiniciar offset para que se vea siempre\n  useEffect(() => {\n    if (status === 'intro') {\n      INTRO.current.offset = 320;\n    }\n  }, [status]);\n\n  // Entradas\n  useEffect(() => {\n    const onKeyDown = e => {\n      if (e.repeat) return;\n      if ((e.code === 'Space' || e.code === 'ArrowUp') && status === 'playing') jump();\n      if (e.code === 'ArrowDown') {\n        if (status === 'playing') crouch(true);\n      }\n      if (e.code === 'KeyR') {\n        if (status === 'playing' || status === 'gameover' || status === 'win') {\n          resetWorld();\n          setStatus('menu');\n        }\n      }\n    };\n    const onKeyUp = e => {\n      if (e.code === 'ArrowDown') crouch(false);\n    };\n    const onClick = () => {\n      if (status === 'playing') jump();\n    };\n    window.addEventListener('keydown', onKeyDown);\n    window.addEventListener('keyup', onKeyUp);\n    window.addEventListener('touchstart', onClick, {\n      passive: true\n    });\n    window.addEventListener('mousedown', onClick);\n    return () => {\n      window.removeEventListener('keydown', onKeyDown);\n      window.removeEventListener('keyup', onKeyUp);\n      window.removeEventListener('touchstart', onClick);\n      window.removeEventListener('mousedown', onClick);\n    };\n  }, [status]);\n  const jump = () => {\n    const p = WORLD.current.player;\n    if (p.onGround) {\n      p.vy = -WORLD.current.jumpV;\n      p.onGround = false;\n    }\n  };\n  const crouch = on => {\n    const p = WORLD.current.player;\n    if (on) {\n      if (!p.onGround) {\n        p.vy += WORLD.current.fastFallBoost * 0.04; // ca√≠da r√°pida\n      } else if (!p.crouching) {\n        p.crouching = true;\n        const prevBottom = p.y + p.h;\n        p.h = 26;\n        p.y = prevBottom - p.h;\n      }\n    } else {\n      if (p.crouching) {\n        const prevBottom = p.y + p.h;\n        p.h = 42;\n        p.y = prevBottom - p.h;\n        p.crouching = false;\n      }\n    }\n  };\n\n  // Acciones de UI\n  const handlePlayFullscreen = async () => {\n    try {\n      var _containerRef$current;\n      if ((_containerRef$current = containerRef.current) !== null && _containerRef$current !== void 0 && _containerRef$current.requestFullscreen) {\n        await containerRef.current.requestFullscreen();\n      }\n    } catch (e) {/* noop */}\n    // Limpiar mundo antes de jugar\n    resetWorld();\n\n    // Iniciar m√∫sica en la interacci√≥n de usuario\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) {\n      audioEl.currentTime = 0;\n      audioEl.play();\n      audioEl.muted = muted;\n    }\n    if (!INTRO_SHOWN.current) {\n      INTRO.current.offset = 320; // preparar intro\n      setStatus('intro');\n      INTRO_SHOWN.current = true; // marcar intro mostrada\n    } else {\n      startPlaying();\n    }\n  };\n  const startPlaying = () => {\n    // Reset de marcas de tiempo para que el cron√≥metro cuente desde ahora\n    WORLD.current.lastTs = 0;\n    WORLD.current.startTs = 0;\n    setStatus('playing');\n  };\n\n  // NUEVO: reintentar sin repetir la intro\n  const handleRetry = () => {\n    resetWorld();\n    setCurrentStoryMoment(null); // resetear momento de la historia\n    startPlaying();\n  };\n  const update = (dt, ts) => {\n    if (status === 'menu') return; // nada\n\n    if (status === 'intro') {\n      INTRO.current.offset -= INTRO.current.speed * dt;\n      // tras ~7-8s o cuando el texto sale por arriba, comenzamos\n      if (INTRO.current.offset < -120) startPlaying();\n      return;\n    }\n    if (status !== 'playing') return;\n\n    // Tiempo de juego\n    if (WORLD.current.startTs === 0) WORLD.current.startTs = ts;\n    const elapsed = (ts - WORLD.current.startTs) / 1000;\n    const remaining = Math.max(0, GAME_DURATION - elapsed);\n    // setTimeLeft(remaining);\n    TIMELEFT.current = remaining; // usar ref para el HUD del canvas\n\n    // Actualizar momento de la historia cada 30 segundos\n    let currentMoment = null;\n\n    // Siempre mostrar el primer momento al inicio\n    if (elapsed >= 0) {\n      currentMoment = STORY_MOMENTS.current[0].text;\n\n      // Buscar si hay un momento m√°s espec√≠fico para este tiempo\n      for (let i = 1; i < STORY_MOMENTS.current.length; i++) {\n        const moment = STORY_MOMENTS.current[i];\n        if (elapsed >= moment.timeStart) {\n          currentMoment = moment.text;\n        } else {\n          break; // Ya encontramos el momento correcto\n        }\n      }\n    }\n    if (currentMoment !== currentStoryMoment) {\n      setCurrentStoryMoment(currentMoment);\n      console.log(`Momento actualizado: \"${currentMoment}\" en segundo ${Math.floor(elapsed)}`);\n    }\n    if (remaining <= 0.01) {\n      setStatus('win');\n      return;\n    }\n    const w = WORLD.current;\n    const p = w.player;\n\n    // Aceleraci√≥n progresiva (cada vez m√°s r√°pido)\n    const tFactor = Math.min(1, elapsed / GAME_DURATION);\n    w.speed = 220 + (w.maxSpeed - 220) * tFactor;\n    w.spawnInterval = 1.4 - 0.8 * tFactor;\n\n    // Avance del \"mundo\"\n    w.worldX += w.speed * dt;\n\n    // F√≠sica del jugador\n    p.vy += w.gravity * dt;\n    p.y += p.vy * dt;\n\n    // Suelo\n    const groundY = w.groundY - p.h;\n    if (p.y >= groundY) {\n      p.y = groundY;\n      p.vy = 0;\n      p.onGround = true;\n    } else {\n      p.onGround = false;\n    }\n\n    // Spawning de obst√°culos\n    w.spawnTimer -= dt;\n    if (w.spawnTimer <= 0) {\n      spawnObstacle(w);\n      w.spawnTimer = w.spawnInterval * (0.9 + Math.random() * 0.4);\n    }\n\n    // Colisiones + puntuaci√≥n\n    for (const o of w.obstacles) {\n      const sx = o.x - w.worldX + p.x;\n      o.screenX = sx;\n      if (!o.scored && sx + o.w < p.x) {\n        o.scored = true;\n        // setScore((s) => s + 100);\n        SCORE.current += 100;\n      }\n      const px1 = p.x,\n        px2 = p.x + p.w;\n      const py1 = p.y,\n        py2 = p.y + p.h;\n      const ox1 = sx,\n        ox2 = sx + o.w;\n      const oy1 = o.y,\n        oy2 = o.y + o.h;\n      const collide = px1 < ox2 && px2 > ox1 && py1 < oy2 && py2 > oy1;\n      if (collide) {\n        setStatus('gameover');\n        break;\n      }\n    }\n\n    // Limpiar obst√°culos fuera de pantalla\n    w.obstacles = w.obstacles.filter(o => o.screenX > -120);\n\n    // Puntuaci√≥n por distancia\n    // setScore((s) => s + Math.floor(w.speed * dt * 0.5));\n    SCORE.current += Math.floor(w.speed * dt * 0.5);\n  };\n  const render = (ctx, canvas) => {\n    const w = WORLD.current;\n    const p = w.player;\n\n    // FONDO base (cielo) o negro en intro\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    if (status === 'intro') {\n      ctx.fillStyle = '#000';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      drawIntro(ctx, canvas, INTRO.current.lines, INTRO.current.offset);\n      return;\n    }\n\n    // Fondo cielo\n    const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\n    g.addColorStop(0, '#e8f0ff');\n    g.addColorStop(1, '#ffffff');\n    ctx.fillStyle = g;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n    // Mostrar momento de la historia como elemento de fondo si est√° jugando\n    if (status === 'playing' && currentStoryMoment) {\n      drawStoryBackground(ctx, canvas, currentStoryMoment);\n    }\n\n    // Suelo\n    ctx.fillStyle = '#c7d2fe';\n    ctx.fillRect(0, w.groundY + 10, canvas.width, 4);\n\n    // Obst√°culos\n    for (const o of w.obstacles) {\n      if (o.screenX < -60 || o.screenX > canvas.width + 120) continue;\n      if (o.type === 'low') drawObstacleLow(ctx, o.screenX, o.y, o.w, o.h);else drawObstacleHigh(ctx, o.screenX, o.y, o.w, o.h);\n    }\n\n    // Jugador\n    drawGroom(ctx, p.x, p.y, p.w, p.h, !p.onGround, p.crouching, skin);\n\n    // HUD\n    if (status === 'playing') {\n      ctx.fillStyle = '#334155';\n      ctx.font = '12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n      ctx.fillText(`Puntos: ${Math.floor(SCORE.current)}`, 12, 18);\n      ctx.fillText(`Tiempo: ${formatTime(TIMELEFT.current)}`, 12, 32);\n\n      // Debug: mostrar tiempo transcurrido y momento actual\n      const elapsed = WORLD.current.startTs ? (WORLD.current.lastTs - WORLD.current.startTs) / 1000 : 0;\n      ctx.fillText(`Transcurrido: ${Math.floor(elapsed)}s`, 12, 46);\n      ctx.fillText(`currentStoryMoment: ${currentStoryMoment ? 'S√ç' : 'NO'}`, 12, 60);\n      ctx.fillText(`status: ${status}`, 12, 74);\n      ctx.fillText(`startTs: ${WORLD.current.startTs ? 'SET' : 'NO'}`, 12, 88);\n      if (currentStoryMoment) {\n        ctx.fillText(`Momento: ${currentStoryMoment.substring(0, 20)}...`, 12, 102);\n      }\n    }\n    if (status === 'gameover') {\n      drawOverlay(ctx, canvas, '¬°Ups! Te has tropezado', 'Pulsa R para volver al men√∫');\n    } else if (status === 'win') {\n      drawOverlay(ctx, canvas, `¬°Llegaste a tiempo! üíí`, `Puntuaci√≥n: ${Math.floor(SCORE.current)}. Pulsa R para volver al men√∫`);\n    }\n  };\n\n  // Bot√≥n mute para audio HTML5\n  const toggleMute = () => {\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) {\n      audioEl.muted = !audioEl.muted;\n      setMuted(audioEl.muted);\n    } else {\n      setMuted(m => !m);\n    }\n  };\n\n  // Limpieza: pausa m√∫sica al desmontar\n  useEffect(() => {\n    return () => {\n      const audioEl = document.getElementById('bg-music');\n      if (audioEl) audioEl.pause();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    style: {\n      maxWidth: 860,\n      margin: '0 auto',\n      padding: '1rem',\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        textAlign: 'center',\n        marginBottom: '.5rem'\n      },\n      children: \"Camino a la iglesia\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 7\n    }, this), status === 'menu' && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        inset: 0,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        background: 'linear-gradient(135deg, rgba(255,255,255,.95), rgba(238,242,255,.95))',\n        zIndex: 5,\n        borderRadius: 12\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: 'min(92%, 560px)',\n          padding: '1.25rem',\n          borderRadius: 12,\n          boxShadow: '0 8px 28px rgba(0,0,0,.18)',\n          background: 'white'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            marginTop: 0,\n            textAlign: 'center'\n          },\n          children: \"Elige tu personaje\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '1rem',\n            justifyContent: 'center',\n            marginBottom: '1rem'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setSkin('novio'),\n            className: skin === 'novio' ? 'active' : '',\n            style: skinBtnStyle(skin === 'novio'),\n            children: \"\\uD83E\\uDD35 Novio\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 436,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setSkin('novia'),\n            className: skin === 'novia' ? 'active' : '',\n            style: skinBtnStyle(skin === 'novia'),\n            children: \"\\uD83D\\uDC70 Novia\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 443,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 435,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            textAlign: 'center',\n            color: '#64748b',\n            marginTop: 0\n          },\n          children: \"Llega a la iglesia esquivando obst\\xE1culos en 5 minutos. El juego acelerar\\xE1 poco a poco.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 451,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'center'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handlePlayFullscreen,\n            style: {\n              background: 'linear-gradient(135deg, #6366f1, #8b5cf6)',\n              color: 'white',\n              border: 0,\n              padding: '.75rem 1.25rem',\n              borderRadius: 10,\n              fontWeight: 700,\n              cursor: 'pointer',\n              boxShadow: '0 6px 18px rgba(99,102,241,.35)'\n            },\n            children: \"\\u25B6 Jugar en pantalla completa\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 455,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        borderRadius: 12,\n        overflow: 'hidden',\n        boxShadow: '0 6px 24px rgba(0,0,0,.12)',\n        background: 'white',\n        position: 'relative'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n        id: \"bg-music\",\n        src: \"/musica-boda.mp3\",\n        loop: true,\n        autoPlay: false,\n        style: {\n          display: 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMute,\n        \"aria-label\": muted ? 'Activar sonido' : 'Silenciar sonido',\n        style: {\n          position: 'absolute',\n          right: 8,\n          top: 8,\n          zIndex: 8,\n          background: 'rgba(0,0,0,.55)',\n          color: '#fff',\n          border: 0,\n          borderRadius: 999,\n          width: 36,\n          height: 36,\n          cursor: 'pointer'\n        },\n        children: muted ? 'üîá' : 'üîä'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 474,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 800,\n        height: 260,\n        style: {\n          width: '100%',\n          display: 'block',\n          background: status === 'intro' ? '#000' : 'linear-gradient(#eef2ff, #fff)'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 9\n      }, this), (status === 'gameover' || status === 'win') && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          inset: 0,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 7\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'rgba(17,24,39,.88)',\n            color: '#fff',\n            padding: '1rem 1.25rem',\n            borderRadius: 12,\n            boxShadow: '0 8px 28px rgba(0,0,0,.35)',\n            textAlign: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 700,\n              fontSize: 18,\n              marginBottom: 8\n            },\n            children: status === 'win' ? '¬°Llegaste a tiempo! üíí' : '¬°Ups! Te has tropezado'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 14,\n              opacity: .9,\n              marginBottom: 12\n            },\n            children: [\"Puntuaci\\xF3n: \", Math.floor(SCORE.current)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 491,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleRetry,\n            style: {\n              background: '#22c55e',\n              color: '#0b1a0f',\n              border: 0,\n              padding: '.5rem 1rem',\n              borderRadius: 10,\n              fontWeight: 700,\n              cursor: 'pointer'\n            },\n            children: \"\\u21BB Reintentar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 494,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 487,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 424,\n    columnNumber: 5\n  }, this);\n}\n_s(Game, \"65C3vyvZX9fGklNC0LyioNCiFbQ=\");\n_c = Game;\nfunction skinBtnStyle(active) {\n  return {\n    background: active ? '#111827' : '#f3f4f6',\n    color: active ? 'white' : '#111827',\n    border: '1px solid ' + (active ? '#111827' : '#e5e7eb'),\n    padding: '.6rem 1rem',\n    borderRadius: 10,\n    cursor: 'pointer',\n    minWidth: 120,\n    fontWeight: 600\n  };\n}\nfunction spawnObstacle(w) {\n  // Dos tipos: low (bloque en el suelo) y high (barra elevada)\n  const type = Math.random() < 0.55 ? 'low' : 'high';\n  if (type === 'low') {\n    const width = 26 + Math.random() * 16;\n    const height = 22 + Math.random() * 20;\n    const x = w.worldX + 900 + Math.random() * 80;\n    const y = w.groundY - height;\n    w.obstacles.push({\n      type,\n      x,\n      y,\n      w: width,\n      h: height,\n      scored: false,\n      screenX: 0\n    });\n  } else {\n    const width = 80 + Math.random() * 60;\n    const height = 18;\n    const x = w.worldX + 900 + Math.random() * 80;\n    // altura que obliga a agacharse (por encima de altura de pie)\n    const y = w.groundY - (42 + 12);\n    w.obstacles.push({\n      type,\n      x,\n      y,\n      w: width,\n      h: height,\n      scored: false,\n      screenX: 0\n    });\n  }\n}\nfunction formatTime(t) {\n  const s = Math.max(0, Math.floor(t));\n  const mm = String(Math.floor(s / 60)).padStart(2, '0');\n  const ss = String(s % 60).padStart(2, '0');\n  return `${mm}:${ss}`;\n}\nfunction drawObstacleLow(ctx, x, y, w, h) {\n  ctx.save();\n  ctx.fillStyle = '#94a3b8';\n  ctx.strokeStyle = '#475569';\n  ctx.lineWidth = 2;\n  roundRect(ctx, x, y, w, h, 6);\n  ctx.fill();\n  ctx.stroke();\n  ctx.restore();\n}\nfunction drawObstacleHigh(ctx, x, y, w, h) {\n  ctx.save();\n  // postes laterales\n  ctx.fillStyle = '#9ca3af';\n  roundRect(ctx, x, y + h - 30, 4, 30, 2);\n  roundRect(ctx, x + w - 4, y + h - 30, 4, 30, 2);\n  ctx.fill();\n  // barra (verde tem√°tica)\n  ctx.fillStyle = '#22c55e';\n  roundRect(ctx, x, y, w, h, 6);\n  ctx.fill();\n  ctx.restore();\n}\nfunction drawGroom(ctx, x, y, w, h, jumping, crouching, skin) {\n  ctx.save();\n  if (skin === 'novia') {\n    // vestido\n    ctx.fillStyle = '#f8fafc';\n    roundRect(ctx, x - 2, y + h * 0.35, w + 4, h * 0.65, 10);\n    ctx.fill();\n    // torso\n    ctx.fillStyle = '#e5e7eb';\n    roundRect(ctx, x, y, w, h * 0.45, 8);\n    ctx.fill();\n    // cabeza\n    ctx.fillStyle = '#fde68a';\n    ctx.beginPath();\n    const headY = crouching ? y - 6 : y - 8;\n    ctx.arc(x + w / 2, headY, 10, 0, Math.PI * 2);\n    ctx.fill();\n    // velo\n    ctx.globalAlpha = 0.6;\n    ctx.fillStyle = '#e0f2fe';\n    roundRect(ctx, x - 6, y - 6, w + 12, 16, 8);\n    ctx.fill();\n    ctx.globalAlpha = 1;\n  } else {\n    // traje\n    ctx.fillStyle = '#1f2937';\n    roundRect(ctx, x, y, w, h, 8);\n    ctx.fill();\n    // cabeza\n    ctx.fillStyle = '#fde68a';\n    ctx.beginPath();\n    const headY = crouching ? y - 6 : y - 8;\n    ctx.arc(x + w / 2, headY, 10, 0, Math.PI * 2);\n    ctx.fill();\n    // corbata\n    ctx.fillStyle = '#ef4444';\n    ctx.fillRect(x + w / 2 - 3, y + 10, 6, 10);\n  }\n  // sombra al saltar\n  if (jumping) {\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#000';\n    ctx.beginPath();\n    ctx.ellipse(x + w / 2, y + h + 10, w * 0.6, 4, 0, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.globalAlpha = 1;\n  }\n  ctx.restore();\n}\nfunction drawStoryMoment(ctx, canvas, momentText) {\n  ctx.save();\n\n  // Fondo semitransparente para el texto\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.85)';\n  const textWidth = ctx.measureText(momentText).width + 40;\n  const boxHeight = 50;\n  const x = (canvas.width - textWidth) / 2;\n  const y = 20;\n  roundRect(ctx, x, y, textWidth, boxHeight, 12);\n  ctx.fill();\n\n  // Borde sutil\n  ctx.strokeStyle = 'rgba(99, 102, 241, 0.3)';\n  ctx.lineWidth = 2;\n  ctx.stroke();\n\n  // Texto del momento\n  ctx.fillStyle = '#1f2937';\n  ctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.fillText(momentText, canvas.width / 2, y + boxHeight / 2 + 5);\n  ctx.restore();\n}\nfunction drawStoryBackground(ctx, canvas, momentText) {\n  console.log('drawStoryBackground llamado con:', momentText);\n  ctx.save();\n\n  // Crear un efecto de fondo grande y sutil\n  ctx.globalAlpha = 0.15;\n\n  // Fondo degradado tem√°tico para el momento\n  const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width * 0.8);\n  gradient.addColorStop(0, '#fbbf24'); // dorado\n  gradient.addColorStop(0.5, '#f59e0b'); // oro m√°s intenso\n  gradient.addColorStop(1, 'transparent');\n  ctx.fillStyle = gradient;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  // Texto del momento como marca de agua en el fondo\n  ctx.globalAlpha = 0.25;\n  ctx.fillStyle = '#92400e';\n  ctx.font = 'bold 36px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n\n  // Dividir el texto en l√≠neas si es muy largo\n  const words = momentText.split(' ');\n  let lines = [];\n  let currentLine = '';\n  for (const word of words) {\n    const testLine = currentLine + (currentLine ? ' ' : '') + word;\n    const metrics = ctx.measureText(testLine);\n    if (metrics.width > canvas.width * 0.7 && currentLine) {\n      lines.push(currentLine);\n      currentLine = word;\n    } else {\n      currentLine = testLine;\n    }\n  }\n  if (currentLine) lines.push(currentLine);\n\n  // Dibujar l√≠neas centradas\n  const lineHeight = 40;\n  const startY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;\n  for (let i = 0; i < lines.length; i++) {\n    ctx.fillText(lines[i], canvas.width / 2, startY + i * lineHeight);\n  }\n\n  // Peque√±a caja informativa arriba\n  ctx.globalAlpha = 0.9;\n  ctx.fillStyle = 'rgba(251, 191, 36, 0.9)';\n  const boxWidth = 300;\n  const boxHeight = 35;\n  const boxX = (canvas.width - boxWidth) / 2;\n  const boxY = 15;\n  roundRect(ctx, boxX, boxY, boxWidth, boxHeight, 8);\n  ctx.fill();\n\n  // Texto de la caja\n  ctx.fillStyle = '#92400e';\n  ctx.font = 'bold 12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText('üíï Momento especial de Ana y Dani üíï', canvas.width / 2, boxY + boxHeight / 2);\n  ctx.restore();\n}\nfunction drawIntro(ctx, canvas, lines, offset) {\n  ctx.save();\n  ctx.fillStyle = '#10b981'; // verde\n  ctx.textAlign = 'center';\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  const centerX = canvas.width / 2;\n  let y = canvas.height + offset;\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const scale = 1 - i * 0.05; // ligera perspectiva\n    ctx.save();\n    ctx.translate(centerX, y);\n    ctx.scale(scale, scale);\n    ctx.fillText(line, 0, 0);\n    ctx.restore();\n    y += 36;\n  }\n  ctx.restore();\n}\nfunction drawOverlay(ctx, canvas, title, subtitle) {\n  ctx.save();\n  ctx.fillStyle = 'rgba(0,0,0,0.45)';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  ctx.fillStyle = '#fff';\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.fillText(title, canvas.width / 2, canvas.height / 2 - 6);\n  ctx.font = '14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.fillText(subtitle, canvas.width / 2, canvas.height / 2 + 18);\n  ctx.restore();\n}\nfunction roundRect(ctx, x, y, w, h, r) {\n  ctx.beginPath();\n  ctx.moveTo(x + r, y);\n  ctx.arcTo(x + w, y, x + w, y + h, r);\n  ctx.arcTo(x + w, y + h, x, y + h, r);\n  ctx.arcTo(x, y + h, x, y, r);\n  ctx.arcTo(x, y, x + w, y, r);\n  ctx.closePath();\n}\nvar _c;\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","Game","_s","containerRef","canvasRef","status","setStatus","skin","setSkin","score","setScore","timeLeft","setTimeLeft","GAME_DURATION","SCORE","TIMELEFT","INTRO_SHOWN","muted","setMuted","INTRO","offset","speed","lines","STORY_MOMENTS","text","icon","timeStart","currentStoryMoment","setCurrentStoryMoment","WORLD","maxSpeed","gravity","jumpV","fastFallBoost","groundY","player","x","y","w","h","vy","onGround","crouching","worldX","obstacles","startTs","lastTs","spawnTimer","spawnInterval","resetWorld","current","canvas","ctx","getContext","rafId","loop","ts","dt","Math","min","update","render","requestAnimationFrame","cancelAnimationFrame","onKeyDown","e","repeat","code","jump","crouch","onKeyUp","onClick","window","addEventListener","passive","removeEventListener","p","on","prevBottom","handlePlayFullscreen","_containerRef$current","requestFullscreen","audioEl","document","getElementById","currentTime","play","startPlaying","handleRetry","elapsed","remaining","max","currentMoment","i","length","moment","console","log","floor","tFactor","spawnObstacle","random","o","sx","screenX","scored","px1","px2","py1","py2","ox1","ox2","oy1","oy2","collide","filter","clearRect","width","height","fillStyle","fillRect","drawIntro","g","createLinearGradient","addColorStop","drawStoryBackground","type","drawObstacleLow","drawObstacleHigh","drawGroom","font","fillText","formatTime","substring","drawOverlay","toggleMute","m","pause","ref","style","maxWidth","margin","padding","position","children","textAlign","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","inset","display","alignItems","justifyContent","background","zIndex","borderRadius","boxShadow","marginTop","gap","className","skinBtnStyle","color","border","fontWeight","cursor","overflow","id","src","autoPlay","right","top","fontSize","opacity","_c","active","minWidth","push","t","s","mm","String","padStart","ss","save","strokeStyle","lineWidth","roundRect","fill","stroke","restore","jumping","beginPath","headY","arc","PI","globalAlpha","ellipse","drawStoryMoment","momentText","textWidth","measureText","boxHeight","gradient","createRadialGradient","textBaseline","words","split","currentLine","word","testLine","metrics","lineHeight","startY","boxWidth","boxX","boxY","centerX","line","scale","translate","title","subtitle","r","moveTo","arcTo","closePath","$RefreshReg$"],"sources":["C:/Users/DanielGarc√≠aCarabelo/Downloads/pag web boda 2.0/html/webreact/src/components/Game.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\n\r\n// Minijuego 2D: El novio/la novia quiere llegar a la iglesia esquivando obst√°culos\r\n// Controles: Space o Flecha ‚Üë para saltar. Mant√©n Flecha ‚Üì para agacharte (en el aire: ca√≠da r√°pida). R para reiniciar.\r\nexport default function Game() {\r\n  const containerRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n\r\n  // Estados de juego: menu | intro | playing | win | gameover\r\n  const [status, setStatus] = useState('menu');\r\n  const [skin, setSkin] = useState('novio'); // 'novio' | 'novia'\r\n  const [score, setScore] = useState(0);\r\n  const [timeLeft, setTimeLeft] = useState(300); // 5 minutos\r\n\r\n  const GAME_DURATION = 300; // 5 min gameplay (la intro no consume tiempo)\r\n\r\n  // NUEVO: refs para evitar valores congelados en el canvas\r\n  const SCORE = useRef(0);\r\n  const TIMELEFT = useRef(GAME_DURATION);\r\n  // NUEVO: mostrar la intro solo una vez\r\n  const INTRO_SHOWN = useRef(false);\r\n\r\n  // Estado de mute para el audio\r\n  const [muted, setMuted] = useState(false);\r\n\r\n  // Intro tipo \"Star Wars\"\r\n  const INTRO = useRef({\r\n    offset: 0,\r\n    speed: 60, // px/s desplazamiento hacia arriba\r\n    lines: [\r\n      'En una galaxia muy, muy cercana...',\r\n      'Dos estrellas destinadas a unirse brillan con fuerza.',\r\n      'El gran d√≠a ha llegado y todos esperan en la iglesia.',\r\n      'Ayuda a la pareja a llegar a tiempo sorteando obst√°culos...',\r\n      'Controles: ‚Üë o ESPACIO para saltar, ‚Üì para agacharte o caer r√°pido.',\r\n      '¬°Que la fuerza del amor te acompa√±e!'\r\n    ],\r\n  });\r\n\r\n  // Momentos clave de la pareja (cada 30 segundos)\r\n  const STORY_MOMENTS = useRef([\r\n    { text: \"Ana y Dani en la Facultad de Derecho de la USC üèõÔ∏è\", icon: \"üìö\", timeStart: 0 },\r\n    { text: \"Ana preparando las oposiciones para Jueza ‚öñÔ∏è\", icon: \"üë©‚Äç‚öñÔ∏è\", timeStart: 30 },\r\n    { text: \"Dani cursando el M√°ster de Abogac√≠a üìñ\", icon: \"üéì\", timeStart: 60 },\r\n    { text: \"Dani empezando a trabajar como abogado üíº\", icon: \"üë®‚Äçüíº\", timeStart: 90 },\r\n    { text: \"Dani trabajando en Porri√±o üè¢\", icon: \"‚öñÔ∏è\", timeStart: 120 },\r\n    { text: \"Dani mud√°ndose a Carballi√±o üè†\", icon: \"üì¶\", timeStart: 150 },\r\n    { text: \"Ana trabajando en Ponteareas üèõÔ∏è\", icon: \"üë©‚Äçüíº\", timeStart: 180 },\r\n    { text: \"Ana aprobando la oposici√≥n en Pontevedra! üéâ\", icon: \"üèÜ\", timeStart: 210 },\r\n    { text: \"Ana y Dani viviendo juntos en Pontevedra üíï\", icon: \"üè°\", timeStart: 240 },\r\n    { text: \"La pedida de mano en la Torre de H√©rcules üíç\", icon: \"üíí\", timeStart: 270 },\r\n    { text: \"¬°Y hoy... la boda! üë∞üííü§µ\", icon: \"üíñ\", timeStart: 300 }\r\n  ]);\r\n\r\n  const [currentStoryMoment, setCurrentStoryMoment] = useState(null);\r\n\r\n  // Estado del mundo\r\n  const WORLD = useRef({\r\n    speed: 220,\r\n    maxSpeed: 380,\r\n    gravity: 1700,\r\n    jumpV: 620,\r\n    fastFallBoost: 2200,\r\n    groundY: 220,\r\n    player: { x: 80, y: 0, w: 32, h: 42, vy: 0, onGround: true, crouching: false },\r\n    worldX: 0,\r\n    obstacles: [],\r\n    startTs: 0,\r\n    lastTs: 0,\r\n    spawnTimer: 0,\r\n    spawnInterval: 1.4,\r\n  });\r\n\r\n  // Reset base (sin cambiar estado)\r\n  const resetWorld = () => {\r\n    setScore(0);\r\n    setTimeLeft(GAME_DURATION);\r\n    setCurrentStoryMoment(null); // resetear momento de la historia\r\n    WORLD.current.worldX = 0;\r\n    WORLD.current.lastTs = 0;\r\n    WORLD.current.startTs = 0;\r\n    WORLD.current.speed = 220;\r\n    WORLD.current.spawnInterval = 1.4;\r\n    WORLD.current.spawnTimer = 0.8;\r\n    WORLD.current.obstacles = [];\r\n    WORLD.current.player = { x: 80, y: WORLD.current.groundY - 42, w: 32, h: 42, vy: 0, onGround: true, crouching: false };\r\n    // NUEVO: sincronizar refs\r\n    SCORE.current = 0;\r\n    TIMELEFT.current = GAME_DURATION;\r\n  };\r\n\r\n  useEffect(() => {\r\n    // init: mostrar men√∫\r\n    resetWorld();\r\n    INTRO.current.offset = 320; // arranca fuera de la pantalla por abajo\r\n  }, []);\r\n\r\n  // Bucle de juego y render\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    let rafId;\r\n    const loop = (ts) => {\r\n      if (!WORLD.current.lastTs) {\r\n        WORLD.current.lastTs = ts;\r\n        if (!WORLD.current.startTs && status === 'playing') WORLD.current.startTs = ts;\r\n      }\r\n      const dt = Math.min(0.032, (ts - WORLD.current.lastTs) / 1000);\r\n      WORLD.current.lastTs = ts;\r\n\r\n      update(dt, ts);\r\n      render(ctx, canvas);\r\n      rafId = requestAnimationFrame(loop);\r\n    };\r\n\r\n    rafId = requestAnimationFrame(loop);\r\n    return () => cancelAnimationFrame(rafId);\r\n  }, [status]);\r\n\r\n  // NUEVO: cada vez que entramos en intro, reiniciar offset para que se vea siempre\r\n  useEffect(() => {\r\n    if (status === 'intro') {\r\n      INTRO.current.offset = 320;\r\n    }\r\n  }, [status]);\r\n\r\n  // Entradas\r\n  useEffect(() => {\r\n    const onKeyDown = (e) => {\r\n      if (e.repeat) return;\r\n      if ((e.code === 'Space' || e.code === 'ArrowUp') && status === 'playing') jump();\r\n      if (e.code === 'ArrowDown') {\r\n        if (status === 'playing') crouch(true);\r\n      }\r\n      if (e.code === 'KeyR') {\r\n        if (status === 'playing' || status === 'gameover' || status === 'win') {\r\n          resetWorld();\r\n          setStatus('menu');\r\n        }\r\n      }\r\n    };\r\n    const onKeyUp = (e) => {\r\n      if (e.code === 'ArrowDown') crouch(false);\r\n    };\r\n    const onClick = () => { if (status === 'playing') jump(); };\r\n\r\n    window.addEventListener('keydown', onKeyDown);\r\n    window.addEventListener('keyup', onKeyUp);\r\n    window.addEventListener('touchstart', onClick, { passive: true });\r\n    window.addEventListener('mousedown', onClick);\r\n    return () => {\r\n      window.removeEventListener('keydown', onKeyDown);\r\n      window.removeEventListener('keyup', onKeyUp);\r\n      window.removeEventListener('touchstart', onClick);\r\n      window.removeEventListener('mousedown', onClick);\r\n    };\r\n  }, [status]);\r\n\r\n  const jump = () => {\r\n    const p = WORLD.current.player;\r\n    if (p.onGround) {\r\n      p.vy = -WORLD.current.jumpV;\r\n      p.onGround = false;\r\n    }\r\n  };\r\n\r\n  const crouch = (on) => {\r\n    const p = WORLD.current.player;\r\n    if (on) {\r\n      if (!p.onGround) {\r\n        p.vy += WORLD.current.fastFallBoost * 0.04; // ca√≠da r√°pida\r\n      } else if (!p.crouching) {\r\n        p.crouching = true;\r\n        const prevBottom = p.y + p.h;\r\n        p.h = 26;\r\n        p.y = prevBottom - p.h;\r\n      }\r\n    } else {\r\n      if (p.crouching) {\r\n        const prevBottom = p.y + p.h;\r\n        p.h = 42;\r\n        p.y = prevBottom - p.h;\r\n        p.crouching = false;\r\n      }\r\n    }\r\n  };\r\n\r\n  // Acciones de UI\r\n  const handlePlayFullscreen = async () => {\r\n    try {\r\n      if (containerRef.current?.requestFullscreen) {\r\n        await containerRef.current.requestFullscreen();\r\n      }\r\n    } catch (e) { /* noop */ }\r\n    // Limpiar mundo antes de jugar\r\n    resetWorld();\r\n\r\n    // Iniciar m√∫sica en la interacci√≥n de usuario\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) {\r\n      audioEl.currentTime = 0;\r\n      audioEl.play();\r\n      audioEl.muted = muted;\r\n    }\r\n\r\n    if (!INTRO_SHOWN.current) {\r\n      INTRO.current.offset = 320; // preparar intro\r\n      setStatus('intro');\r\n      INTRO_SHOWN.current = true; // marcar intro mostrada\r\n    } else {\r\n      startPlaying();\r\n    }\r\n  };\r\n\r\n  const startPlaying = () => {\r\n    // Reset de marcas de tiempo para que el cron√≥metro cuente desde ahora\r\n    WORLD.current.lastTs = 0;\r\n    WORLD.current.startTs = 0;\r\n    setStatus('playing');\r\n  };\r\n\r\n  // NUEVO: reintentar sin repetir la intro\r\n  const handleRetry = () => {\r\n    resetWorld();\r\n    setCurrentStoryMoment(null); // resetear momento de la historia\r\n    startPlaying();\r\n  };\r\n\r\n  const update = (dt, ts) => {\r\n    if (status === 'menu') return; // nada\r\n\r\n    if (status === 'intro') {\r\n      INTRO.current.offset -= INTRO.current.speed * dt;\r\n      // tras ~7-8s o cuando el texto sale por arriba, comenzamos\r\n      if (INTRO.current.offset < -120) startPlaying();\r\n      return;\r\n    }\r\n\r\n    if (status !== 'playing') return;\r\n\r\n    // Tiempo de juego\r\n    if (WORLD.current.startTs === 0) WORLD.current.startTs = ts;\r\n    const elapsed = (ts - WORLD.current.startTs) / 1000;\r\n    const remaining = Math.max(0, GAME_DURATION - elapsed);\r\n    // setTimeLeft(remaining);\r\n    TIMELEFT.current = remaining; // usar ref para el HUD del canvas\r\n    \r\n    // Actualizar momento de la historia cada 30 segundos\r\n    let currentMoment = null;\r\n    \r\n    // Siempre mostrar el primer momento al inicio\r\n    if (elapsed >= 0) {\r\n      currentMoment = STORY_MOMENTS.current[0].text;\r\n      \r\n      // Buscar si hay un momento m√°s espec√≠fico para este tiempo\r\n      for (let i = 1; i < STORY_MOMENTS.current.length; i++) {\r\n        const moment = STORY_MOMENTS.current[i];\r\n        if (elapsed >= moment.timeStart) {\r\n          currentMoment = moment.text;\r\n        } else {\r\n          break; // Ya encontramos el momento correcto\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (currentMoment !== currentStoryMoment) {\r\n      setCurrentStoryMoment(currentMoment);\r\n      console.log(`Momento actualizado: \"${currentMoment}\" en segundo ${Math.floor(elapsed)}`);\r\n    }\r\n    \r\n    if (remaining <= 0.01) {\r\n      setStatus('win');\r\n      return;\r\n    }\r\n\r\n    const w = WORLD.current;\r\n    const p = w.player;\r\n\r\n    // Aceleraci√≥n progresiva (cada vez m√°s r√°pido)\r\n    const tFactor = Math.min(1, elapsed / GAME_DURATION);\r\n    w.speed = 220 + (w.maxSpeed - 220) * tFactor;\r\n    w.spawnInterval = 1.4 - 0.8 * tFactor;\r\n\r\n    // Avance del \"mundo\"\r\n    w.worldX += w.speed * dt;\r\n\r\n    // F√≠sica del jugador\r\n    p.vy += w.gravity * dt;\r\n    p.y += p.vy * dt;\r\n\r\n    // Suelo\r\n    const groundY = w.groundY - p.h;\r\n    if (p.y >= groundY) {\r\n      p.y = groundY;\r\n      p.vy = 0;\r\n      p.onGround = true;\r\n    } else {\r\n      p.onGround = false;\r\n    }\r\n\r\n    // Spawning de obst√°culos\r\n    w.spawnTimer -= dt;\r\n    if (w.spawnTimer <= 0) {\r\n      spawnObstacle(w);\r\n      w.spawnTimer = w.spawnInterval * (0.9 + Math.random() * 0.4);\r\n    }\r\n\r\n    // Colisiones + puntuaci√≥n\r\n    for (const o of w.obstacles) {\r\n      const sx = o.x - w.worldX + p.x;\r\n      o.screenX = sx;\r\n\r\n      if (!o.scored && sx + o.w < p.x) {\r\n        o.scored = true;\r\n        // setScore((s) => s + 100);\r\n        SCORE.current += 100;\r\n      }\r\n\r\n      const px1 = p.x, px2 = p.x + p.w;\r\n      const py1 = p.y, py2 = p.y + p.h;\r\n      const ox1 = sx, ox2 = sx + o.w;\r\n      const oy1 = o.y, oy2 = o.y + o.h;\r\n      const collide = px1 < ox2 && px2 > ox1 && py1 < oy2 && py2 > oy1;\r\n      if (collide) {\r\n        setStatus('gameover');\r\n        break;\r\n      }\r\n    }\r\n\r\n    // Limpiar obst√°culos fuera de pantalla\r\n    w.obstacles = w.obstacles.filter((o) => o.screenX > -120);\r\n\r\n    // Puntuaci√≥n por distancia\r\n    // setScore((s) => s + Math.floor(w.speed * dt * 0.5));\r\n    SCORE.current += Math.floor(w.speed * dt * 0.5);\r\n  };\r\n\r\n  const render = (ctx, canvas) => {\r\n    const w = WORLD.current;\r\n    const p = w.player;\r\n\r\n    // FONDO base (cielo) o negro en intro\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    if (status === 'intro') {\r\n      ctx.fillStyle = '#000';\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      drawIntro(ctx, canvas, INTRO.current.lines, INTRO.current.offset);\r\n      return;\r\n    }\r\n\r\n    // Fondo cielo\r\n    const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\r\n    g.addColorStop(0, '#e8f0ff');\r\n    g.addColorStop(1, '#ffffff');\r\n    ctx.fillStyle = g;\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // Mostrar momento de la historia como elemento de fondo si est√° jugando\r\n    if (status === 'playing' && currentStoryMoment) {\r\n      drawStoryBackground(ctx, canvas, currentStoryMoment);\r\n    }\r\n\r\n    // Suelo\r\n    ctx.fillStyle = '#c7d2fe';\r\n    ctx.fillRect(0, w.groundY + 10, canvas.width, 4);\r\n\r\n    // Obst√°culos\r\n    for (const o of w.obstacles) {\r\n      if (o.screenX < -60 || o.screenX > canvas.width + 120) continue;\r\n      if (o.type === 'low') drawObstacleLow(ctx, o.screenX, o.y, o.w, o.h);\r\n      else drawObstacleHigh(ctx, o.screenX, o.y, o.w, o.h);\r\n    }\r\n\r\n    // Jugador\r\n    drawGroom(ctx, p.x, p.y, p.w, p.h, !p.onGround, p.crouching, skin);\r\n\r\n    // HUD\r\n    if (status === 'playing') {\r\n      ctx.fillStyle = '#334155';\r\n      ctx.font = '12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n      ctx.fillText(`Puntos: ${Math.floor(SCORE.current)}`, 12, 18);\r\n      ctx.fillText(`Tiempo: ${formatTime(TIMELEFT.current)}`, 12, 32);\r\n      \r\n      // Debug: mostrar tiempo transcurrido y momento actual\r\n      const elapsed = WORLD.current.startTs ? (WORLD.current.lastTs - WORLD.current.startTs) / 1000 : 0;\r\n      ctx.fillText(`Transcurrido: ${Math.floor(elapsed)}s`, 12, 46);\r\n      ctx.fillText(`currentStoryMoment: ${currentStoryMoment ? 'S√ç' : 'NO'}`, 12, 60);\r\n      ctx.fillText(`status: ${status}`, 12, 74);\r\n      ctx.fillText(`startTs: ${WORLD.current.startTs ? 'SET' : 'NO'}`, 12, 88);\r\n      if (currentStoryMoment) {\r\n        ctx.fillText(`Momento: ${currentStoryMoment.substring(0, 20)}...`, 12, 102);\r\n      }\r\n    }\r\n\r\n    if (status === 'gameover') {\r\n      drawOverlay(ctx, canvas, '¬°Ups! Te has tropezado', 'Pulsa R para volver al men√∫');\r\n    } else if (status === 'win') {\r\n      drawOverlay(ctx, canvas, `¬°Llegaste a tiempo! üíí`, `Puntuaci√≥n: ${Math.floor(SCORE.current)}. Pulsa R para volver al men√∫`);\r\n    }\r\n  };\r\n\r\n  // Bot√≥n mute para audio HTML5\r\n  const toggleMute = () => {\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) {\r\n      audioEl.muted = !audioEl.muted;\r\n      setMuted(audioEl.muted);\r\n    } else {\r\n      setMuted((m) => !m);\r\n    }\r\n  };\r\n\r\n  // Limpieza: pausa m√∫sica al desmontar\r\n  useEffect(() => {\r\n    return () => {\r\n      const audioEl = document.getElementById('bg-music');\r\n      if (audioEl) audioEl.pause();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ maxWidth: 860, margin: '0 auto', padding: '1rem', position: 'relative' }}>\r\n      <h2 style={{ textAlign: 'center', marginBottom: '.5rem' }}>Camino a la iglesia</h2>\r\n      {/* Panel de control/men√∫ */}\r\n      {status === 'menu' && (\r\n        <div style={{\r\n          position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n          background: 'linear-gradient(135deg, rgba(255,255,255,.95), rgba(238,242,255,.95))',\r\n          zIndex: 5, borderRadius: 12\r\n        }}>\r\n          <div style={{ width: 'min(92%, 560px)', padding: '1.25rem', borderRadius: 12, boxShadow: '0 8px 28px rgba(0,0,0,.18)', background: 'white' }}>\r\n            <h3 style={{ marginTop: 0, textAlign: 'center' }}>Elige tu personaje</h3>\r\n            <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', marginBottom: '1rem' }}>\r\n              <button\r\n                onClick={() => setSkin('novio')}\r\n                className={skin === 'novio' ? 'active' : ''}\r\n                style={skinBtnStyle(skin === 'novio')}\r\n              >\r\n                ü§µ Novio\r\n              </button>\r\n              <button\r\n                onClick={() => setSkin('novia')}\r\n                className={skin === 'novia' ? 'active' : ''}\r\n                style={skinBtnStyle(skin === 'novia')}\r\n              >\r\n                üë∞ Novia\r\n              </button>\r\n            </div>\r\n            <p style={{ textAlign: 'center', color: '#64748b', marginTop: 0 }}>\r\n              Llega a la iglesia esquivando obst√°culos en 5 minutos. El juego acelerar√° poco a poco.\r\n            </p>\r\n            <div style={{ display: 'flex', justifyContent: 'center' }}>\r\n              <button onClick={handlePlayFullscreen} style={{\r\n                background: 'linear-gradient(135deg, #6366f1, #8b5cf6)', color: 'white', border: 0, padding: '.75rem 1.25rem',\r\n                borderRadius: 10, fontWeight: 700, cursor: 'pointer', boxShadow: '0 6px 18px rgba(99,102,241,.35)'\r\n              }}>‚ñ∂ Jugar en pantalla completa</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div style={{ borderRadius: 12, overflow: 'hidden', boxShadow: '0 6px 24px rgba(0,0,0,.12)', background: 'white', position: 'relative' }}>\r\n        {/* Audio de fondo personalizado */}\r\n        <audio\r\n          id=\"bg-music\"\r\n          src=\"/musica-boda.mp3\"\r\n          loop\r\n          autoPlay={false}\r\n          style={{ display: 'none' }}\r\n        />\r\n        {/* Bot√≥n de Mute */}\r\n        <button onClick={toggleMute} aria-label={muted ? 'Activar sonido' : 'Silenciar sonido'}\r\n          style={{ position: 'absolute', right: 8, top: 8, zIndex: 8, background: 'rgba(0,0,0,.55)', color: '#fff', border: 0, borderRadius: 999, width: 36, height: 36, cursor: 'pointer' }}>\r\n          {muted ? 'üîá' : 'üîä'}\r\n        </button>\r\n        <canvas\r\n          ref={canvasRef}\r\n          width={800}\r\n          height={260}\r\n          style={{ width: '100%', display: 'block', background: status === 'intro' ? '#000' : 'linear-gradient(#eef2ff, #fff)' }}\r\n        />\r\n        {/* NUEVO: overlay con bot√≥n Reintentar al terminar */}\r\n        {(status === 'gameover' || status === 'win') && (\r\n          <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 7 }}>\r\n            <div style={{ background: 'rgba(17,24,39,.88)', color: '#fff', padding: '1rem 1.25rem', borderRadius: 12, boxShadow: '0 8px 28px rgba(0,0,0,.35)', textAlign: 'center' }}>\r\n              <div style={{ fontWeight: 700, fontSize: 18, marginBottom: 8 }}>\r\n                {status === 'win' ? '¬°Llegaste a tiempo! üíí' : '¬°Ups! Te has tropezado'}\r\n              </div>\r\n              <div style={{ fontSize: 14, opacity: .9, marginBottom: 12 }}>\r\n                Puntuaci√≥n: {Math.floor(SCORE.current)}\r\n              </div>\r\n              <button onClick={handleRetry} style={{ background: '#22c55e', color: '#0b1a0f', border: 0, padding: '.5rem 1rem', borderRadius: 10, fontWeight: 700, cursor: 'pointer' }}>‚Üª Reintentar</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction skinBtnStyle(active) {\r\n  return {\r\n    background: active ? '#111827' : '#f3f4f6',\r\n    color: active ? 'white' : '#111827',\r\n    border: '1px solid ' + (active ? '#111827' : '#e5e7eb'),\r\n    padding: '.6rem 1rem',\r\n    borderRadius: 10,\r\n    cursor: 'pointer',\r\n    minWidth: 120,\r\n    fontWeight: 600,\r\n  };\r\n}\r\n\r\nfunction spawnObstacle(w) {\r\n  // Dos tipos: low (bloque en el suelo) y high (barra elevada)\r\n  const type = Math.random() < 0.55 ? 'low' : 'high';\r\n  if (type === 'low') {\r\n    const width = 26 + Math.random() * 16;\r\n    const height = 22 + Math.random() * 20;\r\n    const x = w.worldX + 900 + Math.random() * 80;\r\n    const y = w.groundY - height;\r\n    w.obstacles.push({ type, x, y, w: width, h: height, scored: false, screenX: 0 });\r\n  } else {\r\n    const width = 80 + Math.random() * 60;\r\n    const height = 18;\r\n    const x = w.worldX + 900 + Math.random() * 80;\r\n    // altura que obliga a agacharse (por encima de altura de pie)\r\n    const y = w.groundY - (42 + 12);\r\n    w.obstacles.push({ type, x, y, w: width, h: height, scored: false, screenX: 0 });\r\n  }\r\n}\r\n\r\nfunction formatTime(t) {\r\n  const s = Math.max(0, Math.floor(t));\r\n  const mm = String(Math.floor(s / 60)).padStart(2, '0');\r\n  const ss = String(s % 60).padStart(2, '0');\r\n  return `${mm}:${ss}`;\r\n}\r\n\r\nfunction drawObstacleLow(ctx, x, y, w, h) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#94a3b8';\r\n  ctx.strokeStyle = '#475569';\r\n  ctx.lineWidth = 2;\r\n  roundRect(ctx, x, y, w, h, 6);\r\n  ctx.fill();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawObstacleHigh(ctx, x, y, w, h) {\r\n  ctx.save();\r\n  // postes laterales\r\n  ctx.fillStyle = '#9ca3af';\r\n  roundRect(ctx, x, y + h - 30, 4, 30, 2);\r\n  roundRect(ctx, x + w - 4, y + h - 30, 4, 30, 2);\r\n  ctx.fill();\r\n  // barra (verde tem√°tica)\r\n  ctx.fillStyle = '#22c55e';\r\n  roundRect(ctx, x, y, w, h, 6);\r\n  ctx.fill();\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawGroom(ctx, x, y, w, h, jumping, crouching, skin) {\r\n  ctx.save();\r\n  if (skin === 'novia') {\r\n    // vestido\r\n    ctx.fillStyle = '#f8fafc';\r\n    roundRect(ctx, x - 2, y + h * 0.35, w + 4, h * 0.65, 10);\r\n    ctx.fill();\r\n    // torso\r\n    ctx.fillStyle = '#e5e7eb';\r\n    roundRect(ctx, x, y, w, h * 0.45, 8);\r\n    ctx.fill();\r\n    // cabeza\r\n    ctx.fillStyle = '#fde68a';\r\n    ctx.beginPath();\r\n    const headY = crouching ? y - 6 : y - 8;\r\n    ctx.arc(x + w / 2, headY, 10, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    // velo\r\n    ctx.globalAlpha = 0.6;\r\n    ctx.fillStyle = '#e0f2fe';\r\n    roundRect(ctx, x - 6, y - 6, w + 12, 16, 8);\r\n    ctx.fill();\r\n    ctx.globalAlpha = 1;\r\n  } else {\r\n    // traje\r\n    ctx.fillStyle = '#1f2937';\r\n    roundRect(ctx, x, y, w, h, 8);\r\n    ctx.fill();\r\n    // cabeza\r\n    ctx.fillStyle = '#fde68a';\r\n    ctx.beginPath();\r\n    const headY = crouching ? y - 6 : y - 8;\r\n    ctx.arc(x + w / 2, headY, 10, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    // corbata\r\n    ctx.fillStyle = '#ef4444';\r\n    ctx.fillRect(x + w / 2 - 3, y + 10, 6, 10);\r\n  }\r\n  // sombra al saltar\r\n  if (jumping) {\r\n    ctx.globalAlpha = 0.2;\r\n    ctx.fillStyle = '#000';\r\n    ctx.beginPath();\r\n    ctx.ellipse(x + w / 2, y + h + 10, w * 0.6, 4, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.globalAlpha = 1;\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawStoryMoment(ctx, canvas, momentText) {\r\n  ctx.save();\r\n  \r\n  // Fondo semitransparente para el texto\r\n  ctx.fillStyle = 'rgba(255, 255, 255, 0.85)';\r\n  const textWidth = ctx.measureText(momentText).width + 40;\r\n  const boxHeight = 50;\r\n  const x = (canvas.width - textWidth) / 2;\r\n  const y = 20;\r\n  \r\n  roundRect(ctx, x, y, textWidth, boxHeight, 12);\r\n  ctx.fill();\r\n  \r\n  // Borde sutil\r\n  ctx.strokeStyle = 'rgba(99, 102, 241, 0.3)';\r\n  ctx.lineWidth = 2;\r\n  ctx.stroke();\r\n  \r\n  // Texto del momento\r\n  ctx.fillStyle = '#1f2937';\r\n  ctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText(momentText, canvas.width / 2, y + boxHeight / 2 + 5);\r\n  \r\n  ctx.restore();\r\n}\r\n\r\nfunction drawStoryBackground(ctx, canvas, momentText) {\r\n  console.log('drawStoryBackground llamado con:', momentText);\r\n  ctx.save();\r\n  \r\n  // Crear un efecto de fondo grande y sutil\r\n  ctx.globalAlpha = 0.15;\r\n  \r\n  // Fondo degradado tem√°tico para el momento\r\n  const gradient = ctx.createRadialGradient(\r\n    canvas.width / 2, canvas.height / 2, 0,\r\n    canvas.width / 2, canvas.height / 2, canvas.width * 0.8\r\n  );\r\n  gradient.addColorStop(0, '#fbbf24'); // dorado\r\n  gradient.addColorStop(0.5, '#f59e0b'); // oro m√°s intenso\r\n  gradient.addColorStop(1, 'transparent');\r\n  \r\n  ctx.fillStyle = gradient;\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n  \r\n  // Texto del momento como marca de agua en el fondo\r\n  ctx.globalAlpha = 0.25;\r\n  ctx.fillStyle = '#92400e';\r\n  ctx.font = 'bold 36px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n  \r\n  // Dividir el texto en l√≠neas si es muy largo\r\n  const words = momentText.split(' ');\r\n  let lines = [];\r\n  let currentLine = '';\r\n  \r\n  for (const word of words) {\r\n    const testLine = currentLine + (currentLine ? ' ' : '') + word;\r\n    const metrics = ctx.measureText(testLine);\r\n    \r\n    if (metrics.width > canvas.width * 0.7 && currentLine) {\r\n      lines.push(currentLine);\r\n      currentLine = word;\r\n    } else {\r\n      currentLine = testLine;\r\n    }\r\n  }\r\n  if (currentLine) lines.push(currentLine);\r\n  \r\n  // Dibujar l√≠neas centradas\r\n  const lineHeight = 40;\r\n  const startY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;\r\n  \r\n  for (let i = 0; i < lines.length; i++) {\r\n    ctx.fillText(lines[i], canvas.width / 2, startY + i * lineHeight);\r\n  }\r\n  \r\n  // Peque√±a caja informativa arriba\r\n  ctx.globalAlpha = 0.9;\r\n  ctx.fillStyle = 'rgba(251, 191, 36, 0.9)';\r\n  const boxWidth = 300;\r\n  const boxHeight = 35;\r\n  const boxX = (canvas.width - boxWidth) / 2;\r\n  const boxY = 15;\r\n  \r\n  roundRect(ctx, boxX, boxY, boxWidth, boxHeight, 8);\r\n  ctx.fill();\r\n  \r\n  // Texto de la caja\r\n  ctx.fillStyle = '#92400e';\r\n  ctx.font = 'bold 12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n  ctx.fillText('üíï Momento especial de Ana y Dani üíï', canvas.width / 2, boxY + boxHeight / 2);\r\n  \r\n  ctx.restore();\r\n}\r\n\r\nfunction drawIntro(ctx, canvas, lines, offset) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#10b981'; // verde\r\n  ctx.textAlign = 'center';\r\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  const centerX = canvas.width / 2;\r\n  let y = canvas.height + offset;\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const line = lines[i];\r\n    const scale = 1 - i * 0.05; // ligera perspectiva\r\n    ctx.save();\r\n    ctx.translate(centerX, y);\r\n    ctx.scale(scale, scale);\r\n    ctx.fillText(line, 0, 0);\r\n    ctx.restore();\r\n    y += 36;\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawOverlay(ctx, canvas, title, subtitle) {\r\n  ctx.save();\r\n  ctx.fillStyle = 'rgba(0,0,0,0.45)';\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n  ctx.fillStyle = '#fff';\r\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText(title, canvas.width / 2, canvas.height / 2 - 6);\r\n  ctx.font = '14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.fillText(subtitle, canvas.width / 2, canvas.height / 2 + 18);\r\n  ctx.restore();\r\n}\r\n\r\nfunction roundRect(ctx, x, y, w, h, r) {\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + r, y);\r\n  ctx.arcTo(x + w, y, x + w, y + h, r);\r\n  ctx.arcTo(x + w, y + h, x, y + h, r);\r\n  ctx.arcTo(x, y + h, x, y, r);\r\n  ctx.arcTo(x, y, x + w, y, r);\r\n  ctx.closePath();\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}