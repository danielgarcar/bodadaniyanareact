{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DanielGarc\\xEDaCarabelo\\\\Downloads\\\\pag web boda 2.0\\\\html\\\\webreact\\\\src\\\\components\\\\Game.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\n\n// Juego moderno: pareja camino a la iglesia, con narrativa cada 30s\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Game() {\n  _s();\n  const containerRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  // Estado principal\n  const [status, setStatus] = useState('menu'); // menu | intro | playing | paused | win | gameover\n  const [muted, setMuted] = useState(false);\n\n  // Configuración de juego\n  const GAME_DURATION = 300; // 5 min\n  const SCORE = useRef(0);\n  const TIMELEFT = useRef(GAME_DURATION);\n  const INTRO_SHOWN = useRef(false);\n\n  // Intro estilo Star Wars\n  const INTRO = useRef({\n    offset: 320,\n    speed: 40,\n    // más lento para una intro más larga\n    lines: ['En una galaxia muy, muy cercana...', 'Dos estrellas destinadas a unirse brillan con fuerza.', 'El gran día ha llegado y todos esperan en la iglesia.', 'Ayuda a la pareja a llegar a tiempo sorteando obstáculos...', 'Controles: ↑ o ESPACIO para saltar, ↓ para agacharte o caer rápido.', 'Pulsa P para pausar. R para reiniciar.', '¡Que la fuerza del amor te acompañe!']\n  });\n\n  // Momentos clave (cada 30s)\n  const STORY_MOMENTS = useRef([{\n    text: 'Ana y Dani en la Facultad de Derecho de la USC 🏛️',\n    timeStart: 0\n  }, {\n    text: 'Ana preparando las oposiciones para Jueza ⚖️',\n    timeStart: 30\n  }, {\n    text: 'Dani cursando el Máster de Abogacía 📖',\n    timeStart: 60\n  }, {\n    text: 'Dani empezando a trabajar como abogado 💼',\n    timeStart: 90\n  }, {\n    text: 'Dani trabajando en Porriño 🏢',\n    timeStart: 120\n  }, {\n    text: 'Dani mudándose a Carballiño 🏠',\n    timeStart: 150\n  }, {\n    text: 'Ana trabajando en Ponteareas 🏛️',\n    timeStart: 180\n  }, {\n    text: 'Ana aprobando la oposición en Pontevedra 🎉',\n    timeStart: 210\n  }, {\n    text: 'Ana y Dani viviendo juntos en Pontevedra 💕',\n    timeStart: 240\n  }, {\n    text: 'La pedida en la Torre de Hércules 💍',\n    timeStart: 270\n  }, {\n    text: '¡Y hoy... la boda! 👰💒🤵',\n    timeStart: 300\n  }]);\n\n  // Narrativa actual con banner animado\n  const STORY = useRef({\n    index: -1,\n    bannerText: '',\n    bannerAlpha: 0,\n    bannerTimer: 0\n  });\n  const [currentStoryMoment, setCurrentStoryMoment] = useState(null);\n\n  // Mundo y física\n  const WORLD = useRef({\n    speed: 240,\n    maxSpeed: 420,\n    gravity: 1700,\n    jumpV: 620,\n    fastFallBoost: 2200,\n    groundY: 220,\n    player: {\n      x: 100,\n      y: 0,\n      w: 70,\n      h: 48,\n      vy: 0,\n      onGround: true,\n      crouching: false\n    },\n    worldX: 0,\n    obstacles: [],\n    startTs: 0,\n    lastTs: 0,\n    spawnTimer: 0,\n    spawnInterval: 1.3,\n    // Parallax\n    parallax: {\n      skyShift: 0,\n      cityShift: 0,\n      hillShift: 0\n    }\n  });\n\n  // Reset limpio\n  const resetWorld = () => {\n    SCORE.current = 0;\n    TIMELEFT.current = GAME_DURATION;\n    STORY.current = {\n      index: -1,\n      bannerText: '',\n      bannerAlpha: 0,\n      bannerTimer: 0\n    };\n    setCurrentStoryMoment(null);\n    const w = WORLD.current;\n    w.worldX = 0;\n    w.lastTs = 0;\n    w.startTs = 0;\n    w.speed = 240;\n    w.spawnInterval = 1.3;\n    w.spawnTimer = 0.8;\n    w.obstacles = [];\n    w.parallax.skyShift = 0;\n    w.parallax.cityShift = 0;\n    w.parallax.hillShift = 0;\n    w.player = {\n      x: 100,\n      y: w.groundY - 48,\n      w: 70,\n      h: 48,\n      vy: 0,\n      onGround: true,\n      crouching: false\n    };\n  };\n  useEffect(() => {\n    let cancelled = false;\n    const tryInit = () => {\n      try {\n        // WORLD debería existir tras la renderización del componente\n        if (typeof WORLD !== 'undefined' && WORLD !== null && WORLD !== void 0 && WORLD.current) {\n          resetWorld();\n          INTRO.current.offset = 320;\n          return;\n        }\n      } catch {}\n      if (!cancelled) requestAnimationFrame(tryInit);\n    };\n    tryInit();\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  // Bucle de juego\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    let rafId;\n    const loop = ts => {\n      const w = WORLD.current;\n      if (!w.lastTs) {\n        w.lastTs = ts;\n        if (!w.startTs && status === 'playing') w.startTs = ts;\n      }\n      const dt = Math.min(0.032, (ts - w.lastTs) / 1000);\n      w.lastTs = ts;\n      update(dt, ts);\n      render(ctx, canvas);\n      rafId = requestAnimationFrame(loop);\n    };\n    rafId = requestAnimationFrame(loop);\n    return () => cancelAnimationFrame(rafId);\n  }, [status]);\n\n  // Reiniciar intro al entrar\n  useEffect(() => {\n    if (status === 'intro') INTRO.current.offset = 320;\n  }, [status]);\n\n  // Entradas\n  useEffect(() => {\n    const onKeyDown = e => {\n      if (e.repeat) return;\n      if ((e.code === 'Space' || e.code === 'ArrowUp') && status === 'playing') jump();\n      if (e.code === 'ArrowDown' && status === 'playing') crouch(true);\n      if (e.code === 'KeyR' && (status === 'playing' || status === 'gameover' || status === 'win' || status === 'paused')) {\n        resetWorld();\n        setStatus('menu');\n      }\n      if (e.code === 'KeyP' && (status === 'playing' || status === 'paused')) togglePause();\n      if (e.code === 'Enter' && status === 'menu') handlePlayFullscreen();\n      if (e.code === 'Enter' && status === 'intro') startPlaying();\n    };\n    const onKeyUp = e => {\n      if (e.code === 'ArrowDown') crouch(false);\n    };\n    window.addEventListener('keydown', onKeyDown);\n    window.addEventListener('keyup', onKeyUp);\n    return () => {\n      window.removeEventListener('keydown', onKeyDown);\n      window.removeEventListener('keyup', onKeyUp);\n    };\n  }, [status]);\n  const togglePause = () => {\n    if (status === 'playing') setStatus('paused');else if (status === 'paused') setStatus('playing');\n  };\n  const jump = () => {\n    const p = WORLD.current.player;\n    if (p.onGround) {\n      p.vy = -WORLD.current.jumpV;\n      p.onGround = false;\n    }\n  };\n  const crouch = on => {\n    const p = WORLD.current.player;\n    if (on) {\n      if (!p.onGround) p.vy += WORLD.current.fastFallBoost * 0.04; // caída rápida\n      else if (!p.crouching) {\n        p.crouching = true;\n        const prevBottom = p.y + p.h;\n        p.h = 32; // reducir un poco la altura\n        p.y = prevBottom - p.h;\n      }\n    } else if (p.crouching) {\n      const prevBottom = p.y + p.h;\n      p.h = 48;\n      p.y = prevBottom - p.h;\n      p.crouching = false;\n    }\n  };\n  const handlePlayFullscreen = async () => {\n    try {\n      var _containerRef$current;\n      if ((_containerRef$current = containerRef.current) !== null && _containerRef$current !== void 0 && _containerRef$current.requestFullscreen) await containerRef.current.requestFullscreen();\n    } catch {}\n    resetWorld();\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) {\n      audioEl.currentTime = 0;\n      audioEl.play();\n      audioEl.muted = muted;\n    }\n    if (!INTRO_SHOWN.current) {\n      setStatus('intro');\n      INTRO_SHOWN.current = true;\n    } else {\n      startPlaying();\n    }\n  };\n  const startPlaying = () => {\n    const w = WORLD.current;\n    w.lastTs = 0;\n    w.startTs = 0;\n    // Mostrar primer momento inmediatamente\n    STORY.current.index = 0;\n    STORY.current.bannerText = STORY_MOMENTS.current[0].text;\n    STORY.current.bannerTimer = 4.2; // mostrar 4.2s\n    STORY.current.bannerAlpha = 0; // animar fade-in\n    setCurrentStoryMoment(STORY.current.bannerText);\n    setStatus('playing');\n  };\n  const handleRetry = () => {\n    resetWorld();\n    setCurrentStoryMoment(null);\n    startPlaying();\n  };\n  const update = (dt, ts) => {\n    const w = WORLD.current;\n    if (status === 'menu') return;\n    if (status === 'intro') {\n      INTRO.current.offset -= INTRO.current.speed * dt;\n      if (INTRO.current.offset < -140) startPlaying();\n      return;\n    }\n    if (status === 'paused') return;\n    if (status !== 'playing') return;\n\n    // Tiempo de juego\n    if (w.startTs === 0) w.startTs = ts;\n    const elapsed = (ts - w.startTs) / 1000;\n    const remaining = Math.max(0, GAME_DURATION - elapsed);\n    TIMELEFT.current = remaining;\n\n    // Narrativa basada en tiempo -> índice\n    const maxIndex = STORY_MOMENTS.current.length - 1;\n    const idx = Math.min(Math.floor(elapsed / 30), maxIndex);\n    if (idx !== STORY.current.index) {\n      STORY.current.index = idx;\n      STORY.current.bannerText = STORY_MOMENTS.current[idx].text;\n      STORY.current.bannerTimer = 4.2;\n      setCurrentStoryMoment(STORY.current.bannerText);\n    }\n\n    // Animación del banner (fade in/out)\n    if (STORY.current.bannerTimer > 0) {\n      STORY.current.bannerTimer -= dt;\n      STORY.current.bannerAlpha = Math.min(1, STORY.current.bannerAlpha + dt * 3);\n    } else {\n      STORY.current.bannerAlpha = Math.max(0, STORY.current.bannerAlpha - dt * 2);\n    }\n    if (remaining <= 0.01) {\n      setStatus('win');\n      return;\n    }\n\n    // Progresión de dificultad\n    const tFactor = Math.min(1, elapsed / GAME_DURATION);\n    w.speed = 240 + (w.maxSpeed - 240) * tFactor;\n    w.spawnInterval = 1.3 - 0.8 * tFactor;\n\n    // Parallax scrolling\n    w.parallax.skyShift += w.speed * 0.08 * dt;\n    w.parallax.cityShift += w.speed * 0.25 * dt;\n    w.parallax.hillShift += w.speed * 0.45 * dt;\n\n    // Avance mundo\n    w.worldX += w.speed * dt;\n\n    // Física jugador\n    const p = w.player;\n    p.vy += w.gravity * dt;\n    p.y += p.vy * dt;\n    const groundY = w.groundY - p.h;\n    if (p.y >= groundY) {\n      p.y = groundY;\n      p.vy = 0;\n      p.onGround = true;\n    } else {\n      p.onGround = false;\n    }\n\n    // Spawn obstáculos\n    w.spawnTimer -= dt;\n    if (w.spawnTimer <= 0) {\n      spawnObstacle(w);\n      w.spawnTimer = w.spawnInterval * (0.9 + Math.random() * 0.4);\n    }\n\n    // Colisiones + puntuación\n    for (const o of w.obstacles) {\n      const sx = o.x - w.worldX + p.x;\n      o.screenX = sx;\n      if (!o.scored && sx + o.w < p.x) {\n        o.scored = true;\n        SCORE.current += 100;\n      }\n      const collide = rectOverlap(p.x, p.y, p.w, p.h, sx, o.y, o.w, o.h);\n      if (collide) {\n        setStatus('gameover');\n        break;\n      }\n    }\n\n    // Limpiar\n    w.obstacles = w.obstacles.filter(o => o.screenX > -140);\n    SCORE.current += Math.floor(w.speed * dt * 0.6);\n  };\n  const render = (ctx, canvas) => {\n    const w = WORLD.current;\n    const p = w.player;\n\n    // Fondo\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    if (status === 'intro') {\n      drawIntroBackground(ctx, canvas);\n      drawIntro(ctx, canvas, INTRO.current.lines, INTRO.current.offset);\n      drawSkipHint(ctx, canvas, 'Pulsa Enter para saltar');\n      return;\n    }\n    drawSky(ctx, canvas, w.parallax.skyShift);\n    drawCity(ctx, canvas, w.parallax.cityShift);\n    drawHills(ctx, canvas, w.parallax.hillShift);\n\n    // Marca de agua narrativa sutil\n    const momentText = currentStoryMoment || STORY_MOMENTS.current[0].text;\n    drawStoryWatermark(ctx, canvas, momentText);\n\n    // Suelo\n    ctx.fillStyle = '#bfe3ff';\n    ctx.fillRect(0, w.groundY + 12, canvas.width, 4);\n\n    // Obstáculos\n    for (const o of w.obstacles) {\n      if (o.screenX < -80 || o.screenX > canvas.width + 120) continue;\n      if (o.type === 'low') drawObstacleLow(ctx, o.screenX, o.y, o.w, o.h);else drawObstacleHigh(ctx, o.screenX, o.y, o.w, o.h);\n    }\n\n    // Pareja (sticker conjunto)\n    drawCouple(ctx, p.x, p.y, p.w, p.h, !p.onGround, p.crouching);\n\n    // HUD\n    drawHUD(ctx, canvas, {\n      score: SCORE.current,\n      time: TIMELEFT.current,\n      status\n    });\n\n    // Banner de momento especial (animado)\n    if (STORY.current.bannerAlpha > 0) {\n      drawStoryBanner(ctx, canvas, momentText, STORY.current.bannerAlpha);\n    }\n    if (status === 'paused') {\n      drawOverlay(ctx, canvas, 'Pausa ⏸', 'Pulsa P para continuar');\n      return;\n    }\n    if (status === 'gameover') {\n      drawOverlay(ctx, canvas, '¡Ups! Te has tropezado', 'Pulsa R para volver al menú');\n    } else if (status === 'win') {\n      drawOverlay(ctx, canvas, '¡Llegaste a tiempo! 💒', `Puntuación: ${Math.floor(SCORE.current)} · Pulsa R para menú`);\n    }\n  };\n  const toggleMute = () => {\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) {\n      audioEl.muted = !audioEl.muted;\n      setMuted(audioEl.muted);\n    } else setMuted(m => !m);\n  };\n  useEffect(() => () => {\n    const audioEl = document.getElementById('bg-music');\n    if (audioEl) audioEl.pause();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    style: {\n      maxWidth: 980,\n      margin: '0 auto',\n      padding: '1rem',\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        textAlign: 'center',\n        marginBottom: '.5rem'\n      },\n      children: \"Camino a la iglesia\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 7\n    }, this), status === 'menu' && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        inset: 0,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        background: 'linear-gradient(135deg, rgba(255,255,255,.95), rgba(238,242,255,.95))',\n        zIndex: 5,\n        borderRadius: 12\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: 'min(92%, 620px)',\n          padding: '1.25rem',\n          borderRadius: 12,\n          boxShadow: '0 8px 28px rgba(0,0,0,.18)',\n          background: 'white'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            marginTop: 0,\n            textAlign: 'center'\n          },\n          children: \"\\xA1Acompa\\xF1a a Ana y Dani!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 389,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            textAlign: 'center',\n            color: '#64748b',\n            marginTop: 4\n          },\n          children: \"Esquiva obst\\xE1culos durante 5 minutos. La historia de la pareja aparecer\\xE1 como momentos especiales cada 30s.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '1rem',\n            justifyContent: 'center',\n            marginTop: '1rem'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handlePlayFullscreen,\n            style: primaryBtn,\n            children: \"\\u25B6 Jugar en pantalla completa\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              resetWorld();\n              startPlaying();\n            },\n            style: secondaryBtn,\n            children: \"\\u25B7 Jugar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        borderRadius: 12,\n        overflow: 'hidden',\n        boxShadow: '0 6px 24px rgba(0,0,0,.12)',\n        background: 'white',\n        position: 'relative'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n        id: \"bg-music\",\n        src: \"/musica-boda.mp3\",\n        loop: true,\n        autoPlay: false,\n        style: {\n          display: 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMute,\n        \"aria-label\": muted ? 'Activar sonido' : 'Silenciar sonido',\n        style: {\n          position: 'absolute',\n          right: 8,\n          top: 8,\n          zIndex: 8,\n          background: 'rgba(0,0,0,.55)',\n          color: '#fff',\n          border: 0,\n          borderRadius: 999,\n          width: 36,\n          height: 36,\n          cursor: 'pointer'\n        },\n        children: muted ? '🔇' : '🔊'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 9\n      }, this), (status === 'playing' || status === 'paused') && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: togglePause,\n        style: {\n          position: 'absolute',\n          right: 52,\n          top: 8,\n          zIndex: 8,\n          background: 'rgba(0,0,0,.55)',\n          color: '#fff',\n          border: 0,\n          borderRadius: 999,\n          width: 36,\n          height: 36,\n          cursor: 'pointer'\n        },\n        children: status === 'paused' ? '▶' : '⏸'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 11\n      }, this), status === 'intro' && /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: startPlaying,\n        style: {\n          position: 'absolute',\n          right: 8,\n          bottom: 8,\n          zIndex: 8,\n          background: 'rgba(0,0,0,.55)',\n          color: '#fff',\n          border: 0,\n          borderRadius: 8,\n          padding: '.4rem .6rem',\n          cursor: 'pointer'\n        },\n        children: \"Saltar intro\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 900,\n        height: 280,\n        style: {\n          width: '100%',\n          display: 'block',\n          background: status === 'intro' ? '#000' : 'linear-gradient(#eef2ff, #fff)'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 9\n      }, this), status === 'playing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          inset: 'auto 0 0 0',\n          display: 'flex',\n          justifyContent: 'space-between',\n          padding: '8px 10px',\n          pointerEvents: 'none'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onMouseDown: jump,\n          onTouchStart: jump,\n          style: touchBtn,\n          children: \"\\u2B9D Saltar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onMouseDown: () => crouch(true),\n          onMouseUp: () => crouch(false),\n          onTouchStart: () => crouch(true),\n          onTouchEnd: () => crouch(false),\n          style: touchBtn,\n          children: \"\\u2B9F Agachar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 11\n      }, this), (status === 'gameover' || status === 'win') && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: 'absolute',\n          inset: 0,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 7\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            background: 'rgba(17,24,39,.88)',\n            color: '#fff',\n            padding: '1rem 1.25rem',\n            borderRadius: 12,\n            boxShadow: '0 8px 28px rgba(0,0,0,.35)',\n            textAlign: 'center'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 700,\n              fontSize: 18,\n              marginBottom: 8\n            },\n            children: status === 'win' ? '¡Llegaste a tiempo! 💒' : '¡Ups! Te has tropezado'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 14,\n              opacity: .9,\n              marginBottom: 12\n            },\n            children: [\"Puntuaci\\xF3n: \", Math.floor(SCORE.current)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleRetry,\n            style: {\n              background: '#22c55e',\n              color: '#0b1a0f',\n              border: 0,\n              padding: '.5rem 1rem',\n              borderRadius: 10,\n              fontWeight: 700,\n              cursor: 'pointer'\n            },\n            children: \"\\u21BB Reintentar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 383,\n    columnNumber: 5\n  }, this);\n}\n\n// Estilos de botones\n_s(Game, \"gfsyPeMKdkiTHNMQwGueSmhMC7Q=\");\n_c = Game;\nconst primaryBtn = {\n  background: 'linear-gradient(135deg, #6366f1, #8b5cf6)',\n  color: 'white',\n  border: 0,\n  padding: '.75rem 1.25rem',\n  borderRadius: 10,\n  fontWeight: 700,\n  cursor: 'pointer',\n  boxShadow: '0 6px 18px rgba(99,102,241,.35)'\n};\nconst secondaryBtn = {\n  background: '#111827',\n  color: 'white',\n  border: 0,\n  padding: '.75rem 1.25rem',\n  borderRadius: 10,\n  fontWeight: 700,\n  cursor: 'pointer'\n};\nconst touchBtn = {\n  pointerEvents: 'auto',\n  background: 'rgba(0,0,0,.55)',\n  color: '#fff',\n  border: 0,\n  borderRadius: 10,\n  padding: '.5rem .75rem',\n  fontWeight: 700\n};\n\n// Utilidades\nfunction rectOverlap(ax, ay, aw, ah, bx, by, bw, bh) {\n  return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;\n}\nfunction formatTime(t) {\n  const s = Math.max(0, Math.floor(t));\n  const mm = String(Math.floor(s / 60)).padStart(2, '0');\n  const ss = String(s % 60).padStart(2, '0');\n  return `${mm}:${ss}`;\n}\nfunction spawnObstacle(w) {\n  const type = Math.random() < 0.55 ? 'low' : 'high';\n  if (type === 'low') {\n    const width = 28 + Math.random() * 18;\n    const height = 22 + Math.random() * 22;\n    const x = w.worldX + 900 + Math.random() * 120;\n    const y = w.groundY - height;\n    w.obstacles.push({\n      type,\n      x,\n      y,\n      w: width,\n      h: height,\n      scored: false,\n      screenX: 0\n    });\n  } else {\n    const width = 84 + Math.random() * 70;\n    const height = 18;\n    const x = w.worldX + 900 + Math.random() * 120;\n    const y = w.groundY - (48 + 12);\n    w.obstacles.push({\n      type,\n      x,\n      y,\n      w: width,\n      h: height,\n      scored: false,\n      screenX: 0\n    });\n  }\n}\n\n// Dibujo UI\nfunction drawHUD(ctx, canvas, {\n  score,\n  time,\n  status\n}) {\n  ctx.save();\n  // Barra superior\n  ctx.globalAlpha = 0.9;\n  ctx.fillStyle = 'rgba(255,255,255,0.9)';\n  roundRect(ctx, 8, 8, canvas.width - 16, 34, 8);\n  ctx.fill();\n\n  // Puntuación\n  ctx.fillStyle = '#334155';\n  ctx.font = 'bold 12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'left';\n  ctx.fillText(`Puntos: ${Math.floor(score)}`, 16, 30);\n\n  // Tiempo restante + barra\n  ctx.textAlign = 'right';\n  ctx.fillText(`Tiempo: ${formatTime(time)}`, canvas.width - 16, 30);\n  const pct = Math.max(0, Math.min(1, time / 300));\n  const barW = (canvas.width - 16) * pct;\n  ctx.globalAlpha = 1;\n  ctx.fillStyle = '#22c55e';\n  roundRect(ctx, 8, 46, barW, 6, 3);\n  ctx.fill();\n  ctx.restore();\n}\nfunction drawIntroBackground(ctx, canvas) {\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\n  g.addColorStop(0, '#000');\n  g.addColorStop(1, '#1f2937');\n  ctx.fillStyle = g;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n}\nfunction drawIntro(ctx, canvas, lines, offset) {\n  ctx.save();\n  ctx.fillStyle = '#10b981';\n  ctx.textAlign = 'center';\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  const centerX = canvas.width / 2;\n  let y = canvas.height + offset;\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const scale = 1 - i * 0.05;\n    ctx.save();\n    ctx.translate(centerX, y);\n    ctx.scale(scale, scale);\n    ctx.fillText(line, 0, 0);\n    ctx.restore();\n    y += 36;\n  }\n  ctx.restore();\n}\nfunction drawSkipHint(ctx, canvas, text) {\n  ctx.save();\n  ctx.fillStyle = 'rgba(255,255,255,0.2)';\n  roundRect(ctx, canvas.width - 165, canvas.height - 36, 156, 26, 8);\n  ctx.fill();\n  ctx.fillStyle = '#e5e7eb';\n  ctx.font = '12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'right';\n  ctx.fillText(text, canvas.width - 12, canvas.height - 18);\n  ctx.restore();\n}\nfunction drawSky(ctx, canvas, shift) {\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\n  g.addColorStop(0, '#e8f0ff');\n  g.addColorStop(1, '#ffffff');\n  ctx.fillStyle = g;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  // nubes suaves\n  ctx.save();\n  ctx.globalAlpha = 0.25;\n  ctx.fillStyle = '#ffffff';\n  for (let i = 0; i < 6; i++) {\n    const x = (i * 180 - shift * 0.3 % (canvas.width + 200) + canvas.width + 200) % (canvas.width + 200) - 100;\n    ctx.beginPath();\n    ctx.ellipse(x, 60 + i % 2 * 18, 70, 20, 0, 0, Math.PI * 2);\n    ctx.fill();\n  }\n  ctx.restore();\n}\nfunction drawCity(ctx, canvas, shift) {\n  ctx.save();\n  ctx.fillStyle = '#c7d2fe';\n  const baseY = 180;\n  for (let i = 0; i < 14; i++) {\n    const w = 40 + i % 3 * 10;\n    const h = 30 + i % 5 * 18;\n    const x = (i * 90 - shift % (canvas.width + 200) + canvas.width + 200) % (canvas.width + 200) - 100;\n    roundRect(ctx, x, baseY - h, w, h, 4);\n    ctx.fill();\n  }\n  ctx.restore();\n}\nfunction drawHills(ctx, canvas, shift) {\n  ctx.save();\n  ctx.fillStyle = '#93c5fd';\n  for (let i = 0; i < 4; i++) {\n    const x = (i * 260 - shift % (canvas.width + 300) + canvas.width + 300) % (canvas.width + 300) - 150;\n    ctx.beginPath();\n    ctx.ellipse(x, 220, 180, 36, 0, 0, Math.PI * 2);\n    ctx.fill();\n  }\n  ctx.restore();\n}\nfunction drawObstacleLow(ctx, x, y, w, h) {\n  ctx.save();\n  ctx.fillStyle = '#94a3b8';\n  ctx.strokeStyle = '#475569';\n  ctx.lineWidth = 2;\n  roundRect(ctx, x, y, w, h, 6);\n  ctx.fill();\n  ctx.stroke();\n  ctx.restore();\n}\nfunction drawObstacleHigh(ctx, x, y, w, h) {\n  ctx.save();\n  ctx.fillStyle = '#9ca3af';\n  roundRect(ctx, x, y + h - 30, 4, 30, 2);\n  roundRect(ctx, x + w - 4, y + h - 30, 4, 30, 2);\n  ctx.fill();\n  ctx.fillStyle = '#22c55e';\n  roundRect(ctx, x, y, w, h, 6);\n  ctx.fill();\n  ctx.restore();\n}\n\n// Sticker conjunto: novio + novia cogidos de la mano\nfunction drawCouple(ctx, x, y, w, h, jumping, crouching) {\n  ctx.save();\n  // Sombra\n  if (jumping) {\n    ctx.globalAlpha = 0.2;\n    ctx.fillStyle = '#000';\n    ctx.beginPath();\n    ctx.ellipse(x + w * 0.5, y + h + 10, w * 0.7, 5, 0, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.globalAlpha = 1;\n  }\n\n  // Novia (izquierda)\n  const nx = x - 16;\n  const ny = y;\n  const nw = Math.floor(w * 0.48);\n  const nh = h;\n  ctx.fillStyle = '#f8fafc';\n  roundRect(ctx, nx - 2, ny + nh * 0.35, nw + 4, nh * 0.65, 10); // vestido\n  ctx.fill();\n  ctx.fillStyle = '#e5e7eb';\n  roundRect(ctx, nx, ny, nw, nh * 0.45, 8); // torso\n  ctx.fill();\n  ctx.fillStyle = '#fde68a';\n  ctx.beginPath();\n  ctx.arc(nx + nw / 2, crouching ? ny - 4 : ny - 6, 10, 0, Math.PI * 2); // cabeza\n  ctx.fill();\n  // velo\n  ctx.globalAlpha = 0.6;\n  ctx.fillStyle = '#e0f2fe';\n  roundRect(ctx, nx - 6, ny - 6, nw + 12, 16, 8);\n  ctx.fill();\n  ctx.globalAlpha = 1;\n\n  // Novio (derecha)\n  const gx = x + nw - 4;\n  const gy = y;\n  const gw = Math.floor(w * 0.52);\n  const gh = h;\n  ctx.fillStyle = '#1f2937';\n  roundRect(ctx, gx, gy, gw, gh, 8);\n  ctx.fill(); // traje\n  ctx.fillStyle = '#fde68a';\n  ctx.beginPath();\n  ctx.arc(gx + gw / 2, crouching ? gy - 4 : gy - 6, 10, 0, Math.PI * 2);\n  ctx.fill(); // cabeza\n  ctx.fillStyle = '#ef4444';\n  ctx.fillRect(gx + gw / 2 - 3, gy + 10, 6, 10); // corbata\n\n  // Manos unidas (corazón pequeño)\n  ctx.fillStyle = '#ef4444';\n  ctx.beginPath();\n  const mx = gx - 4;\n  const my = y + h * 0.48;\n  ctx.arc(mx - 3, my, 3, 0, Math.PI * 2);\n  ctx.arc(mx + 3, my, 3, 0, Math.PI * 2);\n  ctx.moveTo(mx - 6, my);\n  ctx.lineTo(mx, my + 6);\n  ctx.lineTo(mx + 6, my);\n  ctx.fill();\n  ctx.restore();\n}\nfunction drawStoryWatermark(ctx, canvas, momentText) {\n  ctx.save();\n  ctx.globalAlpha = 0.12;\n  const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width * 0.9);\n  gradient.addColorStop(0, '#fbbf24');\n  gradient.addColorStop(0.5, '#f59e0b');\n  gradient.addColorStop(1, 'transparent');\n  ctx.fillStyle = gradient;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  // Texto grande sutil\n  ctx.globalAlpha = 0.22;\n  ctx.fillStyle = '#92400e';\n  ctx.font = 'bold 34px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  const words = momentText.split(' ');\n  let lines = [];\n  let currentLine = '';\n  for (const word of words) {\n    const test = currentLine + (currentLine ? ' ' : '') + word;\n    if (ctx.measureText(test).width > canvas.width * 0.7 && currentLine) {\n      lines.push(currentLine);\n      currentLine = word;\n    } else currentLine = test;\n  }\n  if (currentLine) lines.push(currentLine);\n  const lineHeight = 40;\n  const startY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;\n  for (let i = 0; i < lines.length; i++) ctx.fillText(lines[i], canvas.width / 2, startY + i * lineHeight);\n  ctx.restore();\n}\nfunction drawStoryBanner(ctx, canvas, text, alpha) {\n  ctx.save();\n  ctx.globalAlpha = Math.max(0, Math.min(1, alpha));\n  ctx.fillStyle = 'rgba(251, 191, 36, 0.95)';\n  const padding = 12;\n  ctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  const textW = ctx.measureText(text).width;\n  const boxW = Math.min(canvas.width - 24, textW + padding * 2 + 40);\n  const boxH = 42;\n  const boxX = (canvas.width - boxW) / 2;\n  const boxY = 6; // elevado\n  roundRect(ctx, boxX, boxY, boxW, boxH, 10);\n  ctx.fill();\n  ctx.strokeStyle = '#d97706';\n  ctx.lineWidth = 2;\n  ctx.stroke();\n  ctx.fillStyle = '#92400e';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText('💕 ' + text + ' 💕', canvas.width / 2, boxY + boxH / 2);\n  ctx.restore();\n}\nfunction drawOverlay(ctx, canvas, title, subtitle) {\n  ctx.save();\n  ctx.fillStyle = 'rgba(0,0,0,0.45)';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  ctx.fillStyle = '#fff';\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.textAlign = 'center';\n  ctx.fillText(title, canvas.width / 2, canvas.height / 2 - 6);\n  ctx.font = '14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\n  ctx.fillText(subtitle, canvas.width / 2, canvas.height / 2 + 18);\n  ctx.restore();\n}\nfunction roundRect(ctx, x, y, w, h, r) {\n  ctx.beginPath();\n  ctx.moveTo(x + r, y);\n  ctx.arcTo(x + w, y, x + w, y + h, r);\n  ctx.arcTo(x + w, y + h, x, y + h, r);\n  ctx.arcTo(x, y + h, x, y, r);\n  ctx.arcTo(x, y, x + w, y, r);\n  ctx.closePath();\n}\nvar _c;\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","Game","_s","containerRef","canvasRef","status","setStatus","muted","setMuted","GAME_DURATION","SCORE","TIMELEFT","INTRO_SHOWN","INTRO","offset","speed","lines","STORY_MOMENTS","text","timeStart","STORY","index","bannerText","bannerAlpha","bannerTimer","currentStoryMoment","setCurrentStoryMoment","WORLD","maxSpeed","gravity","jumpV","fastFallBoost","groundY","player","x","y","w","h","vy","onGround","crouching","worldX","obstacles","startTs","lastTs","spawnTimer","spawnInterval","parallax","skyShift","cityShift","hillShift","resetWorld","current","cancelled","tryInit","requestAnimationFrame","canvas","ctx","getContext","rafId","loop","ts","dt","Math","min","update","render","cancelAnimationFrame","onKeyDown","e","repeat","code","jump","crouch","togglePause","handlePlayFullscreen","startPlaying","onKeyUp","window","addEventListener","removeEventListener","p","on","prevBottom","_containerRef$current","requestFullscreen","audioEl","document","getElementById","currentTime","play","handleRetry","elapsed","remaining","max","maxIndex","length","idx","floor","tFactor","spawnObstacle","random","o","sx","screenX","scored","collide","rectOverlap","filter","clearRect","width","height","drawIntroBackground","drawIntro","drawSkipHint","drawSky","drawCity","drawHills","momentText","drawStoryWatermark","fillStyle","fillRect","type","drawObstacleLow","drawObstacleHigh","drawCouple","drawHUD","score","time","drawStoryBanner","drawOverlay","toggleMute","m","pause","ref","style","maxWidth","margin","padding","position","children","textAlign","marginBottom","fileName","_jsxFileName","lineNumber","columnNumber","inset","display","alignItems","justifyContent","background","zIndex","borderRadius","boxShadow","marginTop","color","gap","onClick","primaryBtn","secondaryBtn","overflow","id","src","autoPlay","right","top","border","cursor","bottom","pointerEvents","onMouseDown","onTouchStart","touchBtn","onMouseUp","onTouchEnd","fontWeight","fontSize","opacity","_c","ax","ay","aw","ah","bx","by","bw","bh","formatTime","t","s","mm","String","padStart","ss","push","save","globalAlpha","roundRect","fill","font","fillText","pct","barW","restore","g","createLinearGradient","addColorStop","centerX","i","line","scale","translate","shift","beginPath","ellipse","PI","baseY","strokeStyle","lineWidth","stroke","jumping","nx","ny","nw","nh","arc","gx","gy","gw","gh","mx","my","moveTo","lineTo","gradient","createRadialGradient","textBaseline","words","split","currentLine","word","test","measureText","lineHeight","startY","alpha","textW","boxW","boxH","boxX","boxY","title","subtitle","r","arcTo","closePath","$RefreshReg$"],"sources":["C:/Users/DanielGarcíaCarabelo/Downloads/pag web boda 2.0/html/webreact/src/components/Game.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\n\r\n// Juego moderno: pareja camino a la iglesia, con narrativa cada 30s\r\nexport default function Game() {\r\n  const containerRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n\r\n  // Estado principal\r\n  const [status, setStatus] = useState('menu'); // menu | intro | playing | paused | win | gameover\r\n  const [muted, setMuted] = useState(false);\r\n\r\n  // Configuración de juego\r\n  const GAME_DURATION = 300; // 5 min\r\n  const SCORE = useRef(0);\r\n  const TIMELEFT = useRef(GAME_DURATION);\r\n  const INTRO_SHOWN = useRef(false);\r\n\r\n  // Intro estilo Star Wars\r\n  const INTRO = useRef({\r\n    offset: 320,\r\n    speed: 40, // más lento para una intro más larga\r\n    lines: [\r\n      'En una galaxia muy, muy cercana...',\r\n      'Dos estrellas destinadas a unirse brillan con fuerza.',\r\n      'El gran día ha llegado y todos esperan en la iglesia.',\r\n      'Ayuda a la pareja a llegar a tiempo sorteando obstáculos...',\r\n      'Controles: ↑ o ESPACIO para saltar, ↓ para agacharte o caer rápido.',\r\n      'Pulsa P para pausar. R para reiniciar.',\r\n      '¡Que la fuerza del amor te acompañe!'\r\n    ]\r\n  });\r\n\r\n  // Momentos clave (cada 30s)\r\n  const STORY_MOMENTS = useRef([\r\n    { text: 'Ana y Dani en la Facultad de Derecho de la USC 🏛️', timeStart: 0 },\r\n    { text: 'Ana preparando las oposiciones para Jueza ⚖️', timeStart: 30 },\r\n    { text: 'Dani cursando el Máster de Abogacía 📖', timeStart: 60 },\r\n    { text: 'Dani empezando a trabajar como abogado 💼', timeStart: 90 },\r\n    { text: 'Dani trabajando en Porriño 🏢', timeStart: 120 },\r\n    { text: 'Dani mudándose a Carballiño 🏠', timeStart: 150 },\r\n    { text: 'Ana trabajando en Ponteareas 🏛️', timeStart: 180 },\r\n    { text: 'Ana aprobando la oposición en Pontevedra 🎉', timeStart: 210 },\r\n    { text: 'Ana y Dani viviendo juntos en Pontevedra 💕', timeStart: 240 },\r\n    { text: 'La pedida en la Torre de Hércules 💍', timeStart: 270 },\r\n    { text: '¡Y hoy... la boda! 👰💒🤵', timeStart: 300 }\r\n  ]);\r\n\r\n  // Narrativa actual con banner animado\r\n  const STORY = useRef({ index: -1, bannerText: '', bannerAlpha: 0, bannerTimer: 0 });\r\n  const [currentStoryMoment, setCurrentStoryMoment] = useState(null);\r\n\r\n  // Mundo y física\r\n  const WORLD = useRef({\r\n    speed: 240,\r\n    maxSpeed: 420,\r\n    gravity: 1700,\r\n    jumpV: 620,\r\n    fastFallBoost: 2200,\r\n    groundY: 220,\r\n    player: { x: 100, y: 0, w: 70, h: 48, vy: 0, onGround: true, crouching: false },\r\n    worldX: 0,\r\n    obstacles: [],\r\n    startTs: 0,\r\n    lastTs: 0,\r\n    spawnTimer: 0,\r\n    spawnInterval: 1.3,\r\n    // Parallax\r\n    parallax: {\r\n      skyShift: 0,\r\n      cityShift: 0,\r\n      hillShift: 0\r\n    }\r\n  });\r\n\r\n  // Reset limpio\r\n  const resetWorld = () => {\r\n    SCORE.current = 0;\r\n    TIMELEFT.current = GAME_DURATION;\r\n    STORY.current = { index: -1, bannerText: '', bannerAlpha: 0, bannerTimer: 0 };\r\n    setCurrentStoryMoment(null);\r\n\r\n    const w = WORLD.current;\r\n    w.worldX = 0;\r\n    w.lastTs = 0;\r\n    w.startTs = 0;\r\n    w.speed = 240;\r\n    w.spawnInterval = 1.3;\r\n    w.spawnTimer = 0.8;\r\n    w.obstacles = [];\r\n    w.parallax.skyShift = 0;\r\n    w.parallax.cityShift = 0;\r\n    w.parallax.hillShift = 0;\r\n    w.player = { x: 100, y: w.groundY - 48, w: 70, h: 48, vy: 0, onGround: true, crouching: false };\r\n  };\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    const tryInit = () => {\r\n      try {\r\n        // WORLD debería existir tras la renderización del componente\r\n        if (typeof WORLD !== 'undefined' && WORLD?.current) {\r\n          resetWorld();\r\n          INTRO.current.offset = 320;\r\n          return;\r\n        }\r\n      } catch {}\r\n      if (!cancelled) requestAnimationFrame(tryInit);\r\n    };\r\n    tryInit();\r\n    return () => { cancelled = true; };\r\n  }, []);\r\n\r\n  // Bucle de juego\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    let rafId;\r\n    const loop = (ts) => {\r\n      const w = WORLD.current;\r\n      if (!w.lastTs) {\r\n        w.lastTs = ts;\r\n        if (!w.startTs && status === 'playing') w.startTs = ts;\r\n      }\r\n      const dt = Math.min(0.032, (ts - w.lastTs) / 1000);\r\n      w.lastTs = ts;\r\n\r\n      update(dt, ts);\r\n      render(ctx, canvas);\r\n      rafId = requestAnimationFrame(loop);\r\n    };\r\n\r\n    rafId = requestAnimationFrame(loop);\r\n    return () => cancelAnimationFrame(rafId);\r\n  }, [status]);\r\n\r\n  // Reiniciar intro al entrar\r\n  useEffect(() => {\r\n    if (status === 'intro') INTRO.current.offset = 320;\r\n  }, [status]);\r\n\r\n  // Entradas\r\n  useEffect(() => {\r\n    const onKeyDown = (e) => {\r\n      if (e.repeat) return;\r\n      if ((e.code === 'Space' || e.code === 'ArrowUp') && status === 'playing') jump();\r\n      if (e.code === 'ArrowDown' && status === 'playing') crouch(true);\r\n      if (e.code === 'KeyR' && (status === 'playing' || status === 'gameover' || status === 'win' || status === 'paused')) {\r\n        resetWorld();\r\n        setStatus('menu');\r\n      }\r\n      if (e.code === 'KeyP' && (status === 'playing' || status === 'paused')) togglePause();\r\n      if (e.code === 'Enter' && status === 'menu') handlePlayFullscreen();\r\n      if (e.code === 'Enter' && status === 'intro') startPlaying();\r\n    };\r\n    const onKeyUp = (e) => {\r\n      if (e.code === 'ArrowDown') crouch(false);\r\n    };\r\n\r\n    window.addEventListener('keydown', onKeyDown);\r\n    window.addEventListener('keyup', onKeyUp);\r\n    return () => {\r\n      window.removeEventListener('keydown', onKeyDown);\r\n      window.removeEventListener('keyup', onKeyUp);\r\n    };\r\n  }, [status]);\r\n\r\n  const togglePause = () => {\r\n    if (status === 'playing') setStatus('paused');\r\n    else if (status === 'paused') setStatus('playing');\r\n  };\r\n\r\n  const jump = () => {\r\n    const p = WORLD.current.player;\r\n    if (p.onGround) {\r\n      p.vy = -WORLD.current.jumpV;\r\n      p.onGround = false;\r\n    }\r\n  };\r\n\r\n  const crouch = (on) => {\r\n    const p = WORLD.current.player;\r\n    if (on) {\r\n      if (!p.onGround) p.vy += WORLD.current.fastFallBoost * 0.04; // caída rápida\r\n      else if (!p.crouching) {\r\n        p.crouching = true;\r\n        const prevBottom = p.y + p.h;\r\n        p.h = 32; // reducir un poco la altura\r\n        p.y = prevBottom - p.h;\r\n      }\r\n    } else if (p.crouching) {\r\n      const prevBottom = p.y + p.h;\r\n      p.h = 48;\r\n      p.y = prevBottom - p.h;\r\n      p.crouching = false;\r\n    }\r\n  };\r\n\r\n  const handlePlayFullscreen = async () => {\r\n    try { if (containerRef.current?.requestFullscreen) await containerRef.current.requestFullscreen(); } catch {}\r\n    resetWorld();\r\n\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) { audioEl.currentTime = 0; audioEl.play(); audioEl.muted = muted; }\r\n\r\n    if (!INTRO_SHOWN.current) { setStatus('intro'); INTRO_SHOWN.current = true; }\r\n    else { startPlaying(); }\r\n  };\r\n\r\n  const startPlaying = () => {\r\n    const w = WORLD.current;\r\n    w.lastTs = 0;\r\n    w.startTs = 0;\r\n    // Mostrar primer momento inmediatamente\r\n    STORY.current.index = 0;\r\n    STORY.current.bannerText = STORY_MOMENTS.current[0].text;\r\n    STORY.current.bannerTimer = 4.2; // mostrar 4.2s\r\n    STORY.current.bannerAlpha = 0; // animar fade-in\r\n    setCurrentStoryMoment(STORY.current.bannerText);\r\n    setStatus('playing');\r\n  };\r\n\r\n  const handleRetry = () => {\r\n    resetWorld();\r\n    setCurrentStoryMoment(null);\r\n    startPlaying();\r\n  };\r\n\r\n  const update = (dt, ts) => {\r\n    const w = WORLD.current;\r\n\r\n    if (status === 'menu') return;\r\n\r\n    if (status === 'intro') {\r\n      INTRO.current.offset -= INTRO.current.speed * dt;\r\n      if (INTRO.current.offset < -140) startPlaying();\r\n      return;\r\n    }\r\n\r\n    if (status === 'paused') return;\r\n    if (status !== 'playing') return;\r\n\r\n    // Tiempo de juego\r\n    if (w.startTs === 0) w.startTs = ts;\r\n    const elapsed = (ts - w.startTs) / 1000;\r\n    const remaining = Math.max(0, GAME_DURATION - elapsed);\r\n    TIMELEFT.current = remaining;\r\n\r\n    // Narrativa basada en tiempo -> índice\r\n    const maxIndex = STORY_MOMENTS.current.length - 1;\r\n    const idx = Math.min(Math.floor(elapsed / 30), maxIndex);\r\n    if (idx !== STORY.current.index) {\r\n      STORY.current.index = idx;\r\n      STORY.current.bannerText = STORY_MOMENTS.current[idx].text;\r\n      STORY.current.bannerTimer = 4.2;\r\n      setCurrentStoryMoment(STORY.current.bannerText);\r\n    }\r\n\r\n    // Animación del banner (fade in/out)\r\n    if (STORY.current.bannerTimer > 0) {\r\n      STORY.current.bannerTimer -= dt;\r\n      STORY.current.bannerAlpha = Math.min(1, STORY.current.bannerAlpha + dt * 3);\r\n    } else {\r\n      STORY.current.bannerAlpha = Math.max(0, STORY.current.bannerAlpha - dt * 2);\r\n    }\r\n\r\n    if (remaining <= 0.01) { setStatus('win'); return; }\r\n\r\n    // Progresión de dificultad\r\n    const tFactor = Math.min(1, elapsed / GAME_DURATION);\r\n    w.speed = 240 + (w.maxSpeed - 240) * tFactor;\r\n    w.spawnInterval = 1.3 - 0.8 * tFactor;\r\n\r\n    // Parallax scrolling\r\n    w.parallax.skyShift += w.speed * 0.08 * dt;\r\n    w.parallax.cityShift += w.speed * 0.25 * dt;\r\n    w.parallax.hillShift += w.speed * 0.45 * dt;\r\n\r\n    // Avance mundo\r\n    w.worldX += w.speed * dt;\r\n\r\n    // Física jugador\r\n    const p = w.player;\r\n    p.vy += w.gravity * dt;\r\n    p.y += p.vy * dt;\r\n    const groundY = w.groundY - p.h;\r\n    if (p.y >= groundY) { p.y = groundY; p.vy = 0; p.onGround = true; } else { p.onGround = false; }\r\n\r\n    // Spawn obstáculos\r\n    w.spawnTimer -= dt;\r\n    if (w.spawnTimer <= 0) {\r\n      spawnObstacle(w);\r\n      w.spawnTimer = w.spawnInterval * (0.9 + Math.random() * 0.4);\r\n    }\r\n\r\n    // Colisiones + puntuación\r\n    for (const o of w.obstacles) {\r\n      const sx = o.x - w.worldX + p.x;\r\n      o.screenX = sx;\r\n      if (!o.scored && sx + o.w < p.x) { o.scored = true; SCORE.current += 100; }\r\n      const collide = rectOverlap(p.x, p.y, p.w, p.h, sx, o.y, o.w, o.h);\r\n      if (collide) { setStatus('gameover'); break; }\r\n    }\r\n\r\n    // Limpiar\r\n    w.obstacles = w.obstacles.filter((o) => o.screenX > -140);\r\n    SCORE.current += Math.floor(w.speed * dt * 0.6);\r\n  };\r\n\r\n  const render = (ctx, canvas) => {\r\n    const w = WORLD.current;\r\n    const p = w.player;\r\n\r\n    // Fondo\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    if (status === 'intro') {\r\n      drawIntroBackground(ctx, canvas);\r\n      drawIntro(ctx, canvas, INTRO.current.lines, INTRO.current.offset);\r\n      drawSkipHint(ctx, canvas, 'Pulsa Enter para saltar');\r\n      return;\r\n    }\r\n\r\n    drawSky(ctx, canvas, w.parallax.skyShift);\r\n    drawCity(ctx, canvas, w.parallax.cityShift);\r\n    drawHills(ctx, canvas, w.parallax.hillShift);\r\n\r\n    // Marca de agua narrativa sutil\r\n    const momentText = currentStoryMoment || STORY_MOMENTS.current[0].text;\r\n    drawStoryWatermark(ctx, canvas, momentText);\r\n\r\n    // Suelo\r\n    ctx.fillStyle = '#bfe3ff';\r\n    ctx.fillRect(0, w.groundY + 12, canvas.width, 4);\r\n\r\n    // Obstáculos\r\n    for (const o of w.obstacles) {\r\n      if (o.screenX < -80 || o.screenX > canvas.width + 120) continue;\r\n      if (o.type === 'low') drawObstacleLow(ctx, o.screenX, o.y, o.w, o.h);\r\n      else drawObstacleHigh(ctx, o.screenX, o.y, o.w, o.h);\r\n    }\r\n\r\n    // Pareja (sticker conjunto)\r\n    drawCouple(ctx, p.x, p.y, p.w, p.h, !p.onGround, p.crouching);\r\n\r\n    // HUD\r\n    drawHUD(ctx, canvas, {\r\n      score: SCORE.current,\r\n      time: TIMELEFT.current,\r\n      status\r\n    });\r\n\r\n    // Banner de momento especial (animado)\r\n    if (STORY.current.bannerAlpha > 0) {\r\n      drawStoryBanner(ctx, canvas, momentText, STORY.current.bannerAlpha);\r\n    }\r\n\r\n    if (status === 'paused') {\r\n      drawOverlay(ctx, canvas, 'Pausa ⏸', 'Pulsa P para continuar');\r\n      return;\r\n    }\r\n\r\n    if (status === 'gameover') {\r\n      drawOverlay(ctx, canvas, '¡Ups! Te has tropezado', 'Pulsa R para volver al menú');\r\n    } else if (status === 'win') {\r\n      drawOverlay(ctx, canvas, '¡Llegaste a tiempo! 💒', `Puntuación: ${Math.floor(SCORE.current)} · Pulsa R para menú`);\r\n    }\r\n  };\r\n\r\n  const toggleMute = () => {\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) { audioEl.muted = !audioEl.muted; setMuted(audioEl.muted); }\r\n    else setMuted((m) => !m);\r\n  };\r\n\r\n  useEffect(() => () => {\r\n    const audioEl = document.getElementById('bg-music');\r\n    if (audioEl) audioEl.pause();\r\n  }, []);\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ maxWidth: 980, margin: '0 auto', padding: '1rem', position: 'relative' }}>\r\n      <h2 style={{ textAlign: 'center', marginBottom: '.5rem' }}>Camino a la iglesia</h2>\r\n\r\n      {status === 'menu' && (\r\n        <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'linear-gradient(135deg, rgba(255,255,255,.95), rgba(238,242,255,.95))', zIndex: 5, borderRadius: 12 }}>\r\n          <div style={{ width: 'min(92%, 620px)', padding: '1.25rem', borderRadius: 12, boxShadow: '0 8px 28px rgba(0,0,0,.18)', background: 'white' }}>\r\n            <h3 style={{ marginTop: 0, textAlign: 'center' }}>¡Acompaña a Ana y Dani!</h3>\r\n            <p style={{ textAlign: 'center', color: '#64748b', marginTop: 4 }}>\r\n              Esquiva obstáculos durante 5 minutos. La historia de la pareja aparecerá como momentos especiales cada 30s.\r\n            </p>\r\n            <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', marginTop: '1rem' }}>\r\n              <button onClick={handlePlayFullscreen} style={primaryBtn}>▶ Jugar en pantalla completa</button>\r\n              <button onClick={() => { resetWorld(); startPlaying(); }} style={secondaryBtn}>▷ Jugar</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div style={{ borderRadius: 12, overflow: 'hidden', boxShadow: '0 6px 24px rgba(0,0,0,.12)', background: 'white', position: 'relative' }}>\r\n        <audio id=\"bg-music\" src=\"/musica-boda.mp3\" loop autoPlay={false} style={{ display: 'none' }} />\r\n        <button onClick={toggleMute} aria-label={muted ? 'Activar sonido' : 'Silenciar sonido'} style={{ position: 'absolute', right: 8, top: 8, zIndex: 8, background: 'rgba(0,0,0,.55)', color: '#fff', border: 0, borderRadius: 999, width: 36, height: 36, cursor: 'pointer' }}>{muted ? '🔇' : '🔊'}</button>\r\n        {(status === 'playing' || status === 'paused') && (\r\n          <button onClick={togglePause} style={{ position: 'absolute', right: 52, top: 8, zIndex: 8, background: 'rgba(0,0,0,.55)', color: '#fff', border: 0, borderRadius: 999, width: 36, height: 36, cursor: 'pointer' }}>{status === 'paused' ? '▶' : '⏸'}</button>\r\n        )}\r\n        {status === 'intro' && (\r\n          <button onClick={startPlaying} style={{ position: 'absolute', right: 8, bottom: 8, zIndex: 8, background: 'rgba(0,0,0,.55)', color: '#fff', border: 0, borderRadius: 8, padding: '.4rem .6rem', cursor: 'pointer' }}>Saltar intro</button>\r\n        )}\r\n        <canvas ref={canvasRef} width={900} height={280} style={{ width: '100%', display: 'block', background: status === 'intro' ? '#000' : 'linear-gradient(#eef2ff, #fff)' }} />\r\n\r\n        {/* Controles táctiles */}\r\n        {status === 'playing' && (\r\n          <div style={{ position: 'absolute', inset: 'auto 0 0 0', display: 'flex', justifyContent: 'space-between', padding: '8px 10px', pointerEvents: 'none' }}>\r\n            <button onMouseDown={jump} onTouchStart={jump} style={touchBtn}>⮝ Saltar</button>\r\n            <button onMouseDown={() => crouch(true)} onMouseUp={() => crouch(false)} onTouchStart={() => crouch(true)} onTouchEnd={() => crouch(false)} style={touchBtn}>⮟ Agachar</button>\r\n          </div>\r\n        )}\r\n\r\n        {(status === 'gameover' || status === 'win') && (\r\n          <div style={{ position: 'absolute', inset: 0, display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 7 }}>\r\n            <div style={{ background: 'rgba(17,24,39,.88)', color: '#fff', padding: '1rem 1.25rem', borderRadius: 12, boxShadow: '0 8px 28px rgba(0,0,0,.35)', textAlign: 'center' }}>\r\n              <div style={{ fontWeight: 700, fontSize: 18, marginBottom: 8 }}>\r\n                {status === 'win' ? '¡Llegaste a tiempo! 💒' : '¡Ups! Te has tropezado'}\r\n              </div>\r\n              <div style={{ fontSize: 14, opacity: .9, marginBottom: 12 }}>\r\n                Puntuación: {Math.floor(SCORE.current)}\r\n              </div>\r\n              <button onClick={handleRetry} style={{ background: '#22c55e', color: '#0b1a0f', border: 0, padding: '.5rem 1rem', borderRadius: 10, fontWeight: 700, cursor: 'pointer' }}>↻ Reintentar</button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Estilos de botones\r\nconst primaryBtn = {\r\n  background: 'linear-gradient(135deg, #6366f1, #8b5cf6)',\r\n  color: 'white', border: 0, padding: '.75rem 1.25rem',\r\n  borderRadius: 10, fontWeight: 700, cursor: 'pointer',\r\n  boxShadow: '0 6px 18px rgba(99,102,241,.35)'\r\n};\r\nconst secondaryBtn = {\r\n  background: '#111827', color: 'white', border: 0,\r\n  padding: '.75rem 1.25rem', borderRadius: 10,\r\n  fontWeight: 700, cursor: 'pointer'\r\n};\r\nconst touchBtn = {\r\n  pointerEvents: 'auto',\r\n  background: 'rgba(0,0,0,.55)', color: '#fff', border: 0,\r\n  borderRadius: 10, padding: '.5rem .75rem', fontWeight: 700\r\n};\r\n\r\n// Utilidades\r\nfunction rectOverlap(ax, ay, aw, ah, bx, by, bw, bh) {\r\n  return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;\r\n}\r\nfunction formatTime(t) {\r\n  const s = Math.max(0, Math.floor(t));\r\n  const mm = String(Math.floor(s / 60)).padStart(2, '0');\r\n  const ss = String(s % 60).padStart(2, '0');\r\n  return `${mm}:${ss}`;\r\n}\r\n\r\nfunction spawnObstacle(w) {\r\n  const type = Math.random() < 0.55 ? 'low' : 'high';\r\n  if (type === 'low') {\r\n    const width = 28 + Math.random() * 18;\r\n    const height = 22 + Math.random() * 22;\r\n    const x = w.worldX + 900 + Math.random() * 120;\r\n    const y = w.groundY - height;\r\n    w.obstacles.push({ type, x, y, w: width, h: height, scored: false, screenX: 0 });\r\n  } else {\r\n    const width = 84 + Math.random() * 70;\r\n    const height = 18;\r\n    const x = w.worldX + 900 + Math.random() * 120;\r\n    const y = w.groundY - (48 + 12);\r\n    w.obstacles.push({ type, x, y, w: width, h: height, scored: false, screenX: 0 });\r\n  }\r\n}\r\n\r\n// Dibujo UI\r\nfunction drawHUD(ctx, canvas, { score, time, status }) {\r\n  ctx.save();\r\n  // Barra superior\r\n  ctx.globalAlpha = 0.9;\r\n  ctx.fillStyle = 'rgba(255,255,255,0.9)';\r\n  roundRect(ctx, 8, 8, canvas.width - 16, 34, 8);\r\n  ctx.fill();\r\n\r\n  // Puntuación\r\n  ctx.fillStyle = '#334155';\r\n  ctx.font = 'bold 12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'left';\r\n  ctx.fillText(`Puntos: ${Math.floor(score)}`, 16, 30);\r\n\r\n  // Tiempo restante + barra\r\n  ctx.textAlign = 'right';\r\n  ctx.fillText(`Tiempo: ${formatTime(time)}`, canvas.width - 16, 30);\r\n  const pct = Math.max(0, Math.min(1, time / 300));\r\n  const barW = (canvas.width - 16) * pct;\r\n  ctx.globalAlpha = 1;\r\n  ctx.fillStyle = '#22c55e';\r\n  roundRect(ctx, 8, 46, barW, 6, 3);\r\n  ctx.fill();\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawIntroBackground(ctx, canvas) {\r\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\r\n  g.addColorStop(0, '#000');\r\n  g.addColorStop(1, '#1f2937');\r\n  ctx.fillStyle = g;\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n}\r\n\r\nfunction drawIntro(ctx, canvas, lines, offset) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#10b981';\r\n  ctx.textAlign = 'center';\r\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  const centerX = canvas.width / 2;\r\n  let y = canvas.height + offset;\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const line = lines[i];\r\n    const scale = 1 - i * 0.05;\r\n    ctx.save();\r\n    ctx.translate(centerX, y);\r\n    ctx.scale(scale, scale);\r\n    ctx.fillText(line, 0, 0);\r\n    ctx.restore();\r\n    y += 36;\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawSkipHint(ctx, canvas, text) {\r\n  ctx.save();\r\n  ctx.fillStyle = 'rgba(255,255,255,0.2)';\r\n  roundRect(ctx, canvas.width - 165, canvas.height - 36, 156, 26, 8);\r\n  ctx.fill();\r\n  ctx.fillStyle = '#e5e7eb';\r\n  ctx.font = '12px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'right';\r\n  ctx.fillText(text, canvas.width - 12, canvas.height - 18);\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawSky(ctx, canvas, shift) {\r\n  const g = ctx.createLinearGradient(0, 0, 0, canvas.height);\r\n  g.addColorStop(0, '#e8f0ff');\r\n  g.addColorStop(1, '#ffffff');\r\n  ctx.fillStyle = g;\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n  // nubes suaves\r\n  ctx.save();\r\n  ctx.globalAlpha = 0.25;\r\n  ctx.fillStyle = '#ffffff';\r\n  for (let i = 0; i < 6; i++) {\r\n    const x = ((i * 180 - (shift * 0.3) % (canvas.width + 200)) + canvas.width + 200) % (canvas.width + 200) - 100;\r\n    ctx.beginPath();\r\n    ctx.ellipse(x, 60 + (i % 2) * 18, 70, 20, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawCity(ctx, canvas, shift) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#c7d2fe';\r\n  const baseY = 180;\r\n  for (let i = 0; i < 14; i++) {\r\n    const w = 40 + (i % 3) * 10;\r\n    const h = 30 + (i % 5) * 18;\r\n    const x = ((i * 90 - (shift % (canvas.width + 200))) + canvas.width + 200) % (canvas.width + 200) - 100;\r\n    roundRect(ctx, x, baseY - h, w, h, 4);\r\n    ctx.fill();\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawHills(ctx, canvas, shift) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#93c5fd';\r\n  for (let i = 0; i < 4; i++) {\r\n    const x = ((i * 260 - (shift % (canvas.width + 300))) + canvas.width + 300) % (canvas.width + 300) - 150;\r\n    ctx.beginPath();\r\n    ctx.ellipse(x, 220, 180, 36, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n  }\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawObstacleLow(ctx, x, y, w, h) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#94a3b8';\r\n  ctx.strokeStyle = '#475569';\r\n  ctx.lineWidth = 2;\r\n  roundRect(ctx, x, y, w, h, 6);\r\n  ctx.fill();\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawObstacleHigh(ctx, x, y, w, h) {\r\n  ctx.save();\r\n  ctx.fillStyle = '#9ca3af';\r\n  roundRect(ctx, x, y + h - 30, 4, 30, 2);\r\n  roundRect(ctx, x + w - 4, y + h - 30, 4, 30, 2);\r\n  ctx.fill();\r\n  ctx.fillStyle = '#22c55e';\r\n  roundRect(ctx, x, y, w, h, 6);\r\n  ctx.fill();\r\n  ctx.restore();\r\n}\r\n\r\n// Sticker conjunto: novio + novia cogidos de la mano\r\nfunction drawCouple(ctx, x, y, w, h, jumping, crouching) {\r\n  ctx.save();\r\n  // Sombra\r\n  if (jumping) {\r\n    ctx.globalAlpha = 0.2;\r\n    ctx.fillStyle = '#000';\r\n    ctx.beginPath();\r\n    ctx.ellipse(x + w * 0.5, y + h + 10, w * 0.7, 5, 0, 0, Math.PI * 2);\r\n    ctx.fill();\r\n    ctx.globalAlpha = 1;\r\n  }\r\n\r\n  // Novia (izquierda)\r\n  const nx = x - 16; const ny = y; const nw = Math.floor(w * 0.48); const nh = h;\r\n  ctx.fillStyle = '#f8fafc';\r\n  roundRect(ctx, nx - 2, ny + nh * 0.35, nw + 4, nh * 0.65, 10); // vestido\r\n  ctx.fill();\r\n  ctx.fillStyle = '#e5e7eb';\r\n  roundRect(ctx, nx, ny, nw, nh * 0.45, 8); // torso\r\n  ctx.fill();\r\n  ctx.fillStyle = '#fde68a';\r\n  ctx.beginPath();\r\n  ctx.arc(nx + nw / 2, crouching ? ny - 4 : ny - 6, 10, 0, Math.PI * 2); // cabeza\r\n  ctx.fill();\r\n  // velo\r\n  ctx.globalAlpha = 0.6; ctx.fillStyle = '#e0f2fe'; roundRect(ctx, nx - 6, ny - 6, nw + 12, 16, 8); ctx.fill(); ctx.globalAlpha = 1;\r\n\r\n  // Novio (derecha)\r\n  const gx = x + nw - 4; const gy = y; const gw = Math.floor(w * 0.52); const gh = h;\r\n  ctx.fillStyle = '#1f2937'; roundRect(ctx, gx, gy, gw, gh, 8); ctx.fill(); // traje\r\n  ctx.fillStyle = '#fde68a'; ctx.beginPath(); ctx.arc(gx + gw / 2, crouching ? gy - 4 : gy - 6, 10, 0, Math.PI * 2); ctx.fill(); // cabeza\r\n  ctx.fillStyle = '#ef4444'; ctx.fillRect(gx + gw / 2 - 3, gy + 10, 6, 10); // corbata\r\n\r\n  // Manos unidas (corazón pequeño)\r\n  ctx.fillStyle = '#ef4444';\r\n  ctx.beginPath();\r\n  const mx = gx - 4; const my = y + h * 0.48;\r\n  ctx.arc(mx - 3, my, 3, 0, Math.PI * 2);\r\n  ctx.arc(mx + 3, my, 3, 0, Math.PI * 2);\r\n  ctx.moveTo(mx - 6, my); ctx.lineTo(mx, my + 6); ctx.lineTo(mx + 6, my);\r\n  ctx.fill();\r\n\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawStoryWatermark(ctx, canvas, momentText) {\r\n  ctx.save();\r\n  ctx.globalAlpha = 0.12;\r\n  const gradient = ctx.createRadialGradient(canvas.width / 2, canvas.height / 2, 0, canvas.width / 2, canvas.height / 2, canvas.width * 0.9);\r\n  gradient.addColorStop(0, '#fbbf24');\r\n  gradient.addColorStop(0.5, '#f59e0b');\r\n  gradient.addColorStop(1, 'transparent');\r\n  ctx.fillStyle = gradient;\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n  // Texto grande sutil\r\n  ctx.globalAlpha = 0.22;\r\n  ctx.fillStyle = '#92400e';\r\n  ctx.font = 'bold 34px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n\r\n  const words = momentText.split(' ');\r\n  let lines = []; let currentLine = '';\r\n  for (const word of words) {\r\n    const test = currentLine + (currentLine ? ' ' : '') + word;\r\n    if (ctx.measureText(test).width > canvas.width * 0.7 && currentLine) { lines.push(currentLine); currentLine = word; }\r\n    else currentLine = test;\r\n  }\r\n  if (currentLine) lines.push(currentLine);\r\n\r\n  const lineHeight = 40;\r\n  const startY = canvas.height / 2 - (lines.length - 1) * lineHeight / 2;\r\n  for (let i = 0; i < lines.length; i++) ctx.fillText(lines[i], canvas.width / 2, startY + i * lineHeight);\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawStoryBanner(ctx, canvas, text, alpha) {\r\n  ctx.save();\r\n  ctx.globalAlpha = Math.max(0, Math.min(1, alpha));\r\n  ctx.fillStyle = 'rgba(251, 191, 36, 0.95)';\r\n  const padding = 12;\r\n  ctx.font = 'bold 14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  const textW = ctx.measureText(text).width;\r\n  const boxW = Math.min(canvas.width - 24, textW + padding * 2 + 40);\r\n  const boxH = 42;\r\n  const boxX = (canvas.width - boxW) / 2;\r\n  const boxY = 6; // elevado\r\n  roundRect(ctx, boxX, boxY, boxW, boxH, 10);\r\n  ctx.fill();\r\n  ctx.strokeStyle = '#d97706'; ctx.lineWidth = 2; ctx.stroke();\r\n  ctx.fillStyle = '#92400e';\r\n  ctx.textAlign = 'center'; ctx.textBaseline = 'middle';\r\n  ctx.fillText('💕 ' + text + ' 💕', canvas.width / 2, boxY + boxH / 2);\r\n  ctx.restore();\r\n}\r\n\r\nfunction drawOverlay(ctx, canvas, title, subtitle) {\r\n  ctx.save();\r\n  ctx.fillStyle = 'rgba(0,0,0,0.45)';\r\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n  ctx.fillStyle = '#fff';\r\n  ctx.font = 'bold 22px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.textAlign = 'center';\r\n  ctx.fillText(title, canvas.width / 2, canvas.height / 2 - 6);\r\n  ctx.font = '14px Inter, system-ui, -apple-system, Segoe UI, Roboto';\r\n  ctx.fillText(subtitle, canvas.width / 2, canvas.height / 2 + 18);\r\n  ctx.restore();\r\n}\r\n\r\nfunction roundRect(ctx, x, y, w, h, r) {\r\n  ctx.beginPath();\r\n  ctx.moveTo(x + r, y);\r\n  ctx.arcTo(x + w, y, x + w, y + h, r);\r\n  ctx.arcTo(x + w, y + h, x, y + h, r);\r\n  ctx.arcTo(x, y + h, x, y, r);\r\n  ctx.arcTo(x, y, x + w, y, r);\r\n  ctx.closePath();\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}